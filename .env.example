# =============================================================================
# CARMEN ERP ENVIRONMENT CONFIGURATION
# =============================================================================
# This file contains all environment variables needed for Carmen ERP.
# Copy this file to .env.local and fill in your actual values.
# 
# üîê SECURITY WARNING: Never commit real environment files to version control!
# =============================================================================

# =============================================================================
# CORE APPLICATION SETTINGS
# =============================================================================
NODE_ENV=development                                 # Environment: development, production, test
PORT=3000                                           # Application port
HOST=localhost                                      # Application host

# =============================================================================
# DATABASE CONFIGURATION (REQUIRED)
# =============================================================================
DATABASE_URL="postgresql://username:password@localhost:5432/carmen_erp"

# Database Connection Pool Settings
DB_CONNECTION_LIMIT=10                               # Maximum number of database connections (default: 10)
DB_POOL_TIMEOUT=10                                   # Connection pool timeout in seconds (default: 10)

# Database Reliability Features (default: enabled in production)
DB_CIRCUIT_BREAKER=true                              # Enable circuit breaker pattern (default: true)
DB_MONITORING=true                                   # Enable connection monitoring (default: true)
DB_TIMEOUTS=true                                     # Enable operation timeouts (default: true)

# Circuit Breaker Configuration
DB_CB_FAILURE_THRESHOLD=5                            # Failures before opening circuit (default: 5)
DB_CB_TIMEOUT=60000                                  # Circuit breaker timeout in ms (default: 60000)

# Monitoring Configuration
DB_HEALTH_CHECK_INTERVAL=30000                       # Health check interval in ms (default: 30000)
DB_ALERT_WEBHOOK_URL=                                # Optional webhook URL for database alerts

# Alert Thresholds
DB_ALERT_HEALTH_SCORE_THRESHOLD=70                   # Minimum health score before alert (default: 70)
DB_ALERT_POOL_UTILIZATION_THRESHOLD=80               # Maximum pool utilization % before alert (default: 80)
DB_ALERT_QUERY_TIME_THRESHOLD=1000                   # Maximum query time in ms before alert (default: 1000)
DB_ALERT_ERROR_RATE_THRESHOLD=5                      # Maximum error rate % before alert (default: 5)
DB_ALERT_CONNECTION_TIMEOUT_THRESHOLD=3              # Maximum connection timeouts before alert (default: 3)

# =============================================================================
# AUTHENTICATION & JWT CONFIGURATION (REQUIRED)
# =============================================================================
# üîë Generate strong secrets with: openssl rand -base64 64
JWT_SECRET=your-256-bit-jwt-secret-key-here          # JWT signing secret (min 64 chars recommended)
JWT_EXPIRES_IN=24h                                   # Access token expiration (e.g., 15m, 1h, 24h)
JWT_REFRESH_SECRET=your-256-bit-refresh-secret-here  # Refresh token secret (must be different from JWT_SECRET)
JWT_REFRESH_EXPIRES_IN=7d                           # Refresh token expiration (e.g., 7d, 30d)

# =============================================================================
# SESSION SECURITY (REQUIRED)
# =============================================================================
# üîë Generate with: openssl rand -base64 32
SESSION_SECRET=your-session-secret-key-here          # Session signing secret (min 32 chars)
SESSION_SECURE=true                                  # Require HTTPS for cookies (set to false in development)
SESSION_HTTP_ONLY=true                              # HTTP-only cookies (recommended: true)
SESSION_SAME_SITE=strict                            # SameSite policy: strict, lax, none

# =============================================================================
# DATA ENCRYPTION (REQUIRED)
# =============================================================================
# üîë Generate with: openssl rand -hex 16 (exactly 32 characters)
ENCRYPTION_KEY=your-32-character-encryption-key     # Encryption key (exactly 32 characters)
ENCRYPTION_ALGORITHM=aes-256-gcm                    # Encryption algorithm

# =============================================================================
# API SECURITY & RATE LIMITING
# =============================================================================
# Rate Limiting Configuration
API_RATE_LIMIT_WINDOW=900                           # Rate limit window in seconds (default: 15 minutes)
API_RATE_LIMIT_MAX_REQUESTS=1000                    # Maximum requests per window (default: 1000)
API_RATE_LIMIT_SKIP_SUCCESSFUL_REQUESTS=false       # Skip successful requests in count (default: false)

# Account Security
FAILED_LOGIN_THRESHOLD=5                            # Failed attempts before account lockout (default: 5)
ACCOUNT_LOCKOUT_DURATION=1800                       # Account lockout duration in seconds (default: 30 minutes)

# =============================================================================
# SECURITY HEADERS & CORS
# =============================================================================
# Security Headers
SECURITY_HEADERS_ENABLED=true                       # Enable comprehensive security headers (default: true)

# CORS Configuration
CORS_ORIGIN=*                                       # Allowed origins (* for development, specific domains for production)
CORS_CREDENTIALS=true                               # Allow credentials in CORS requests (default: true)

# Content Security Policy
CSP_ENABLED=true                                    # Enable Content Security Policy (default: true)
CSP_REPORT_URI=                                     # Optional: CSP violation report endpoint URL

# =============================================================================
# AUDIT LOGGING & MONITORING
# =============================================================================
# Audit Logging
AUDIT_LOG_ENABLED=true                              # Enable security audit logging (default: true)
AUDIT_LOG_LEVEL=info                                # Minimum log level: debug, info, warn, error (default: info)
AUDIT_LOG_RETENTION_DAYS=90                         # Log retention period in days (default: 90)

# Security Monitoring
SECURITY_EVENTS_WEBHOOK_URL=                        # Optional: Webhook URL for security event notifications
                                                    # Example: https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK

# =============================================================================
# APPLICATION LOGGING
# =============================================================================
LOG_LEVEL=info                                      # Application log level: debug, info, warn, error (default: info)
ENABLE_METRICS=false                                # Enable metrics collection (default: false)
METRICS_PORT=                                       # Optional: Metrics server port

# =============================================================================
# NEXTAUTH.JS CONFIGURATION (REQUIRED FOR KEYCLOAK)
# =============================================================================
# üîë Generate with: openssl rand -base64 32
NEXTAUTH_URL=http://localhost:3000                  # Base URL for NextAuth.js callbacks
NEXTAUTH_SECRET=your-nextauth-secret-here           # NextAuth.js secret (required for JWT encoding)

# =============================================================================
# KEYCLOAK INTEGRATION (REQUIRED)
# =============================================================================
# Keycloak Server Configuration
KEYCLOAK_BASE_URL=http://localhost:8080             # Keycloak server base URL
KEYCLOAK_REALM=carmen                               # Keycloak realm name
KEYCLOAK_ISSUER=http://localhost:8080/realms/carmen # Keycloak issuer URL (auto-constructed if not set)

# Client Configuration
KEYCLOAK_CLIENT_ID=carmen-web                       # Keycloak client ID
KEYCLOAK_CLIENT_SECRET=your-client-secret-here      # Keycloak client secret

# Admin API Configuration (for user management)
KEYCLOAK_ADMIN_CLIENT_ID=admin-cli                  # Admin client ID (optional)
KEYCLOAK_ADMIN_CLIENT_SECRET=                       # Admin client secret (optional)
KEYCLOAK_ADMIN_USERNAME=                            # Admin username (alternative to client credentials)
KEYCLOAK_ADMIN_PASSWORD=                            # Admin password (alternative to client credentials)

# Authentication Strategy Configuration
AUTH_STRATEGY=auto                                  # Authentication strategy: keycloak-only, jwt-only, hybrid, auto
AUTH_FALLBACK_JWT=true                              # Allow JWT fallback when using hybrid/auto strategy
AUTH_LOG_ACTIVITY=true                              # Log authentication activity

# =============================================================================
# FILE UPLOAD CONFIGURATION
# =============================================================================
MAX_FILE_SIZE=10485760                              # Maximum file size in bytes (default: 10MB)
ALLOWED_FILE_TYPES=image/jpeg,image/png,image/gif,application/pdf,text/csv,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
UPLOAD_PATH=./uploads                               # Upload directory path (default: ./uploads)

# =============================================================================
# EMAIL CONFIGURATION (OPTIONAL)
# =============================================================================
EMAIL_SERVICE=disabled                              # Email service: smtp, sendgrid, ses, disabled (default: disabled)
EMAIL_HOST=                                         # SMTP host (if using smtp)
EMAIL_PORT=                                         # SMTP port (if using smtp)
EMAIL_USER=                                         # SMTP username (if using smtp)
EMAIL_PASSWORD=                                     # SMTP password (if using smtp)
EMAIL_FROM=                                         # From email address

# =============================================================================
# REDIS CONFIGURATION (RECOMMENDED FOR KEYCLOAK)
# =============================================================================
REDIS_URL=redis://localhost:6379                   # Redis connection URL (recommended for session storage)
REDIS_PASSWORD=redis_password                       # Redis password
REDIS_DB=0                                          # Redis database number (default: 0)

# Session Storage Configuration
SESSION_STORE=memory                               # Session storage: memory, redis, database
SESSION_REDIS_URL=redis://localhost:6379           # Redis URL for session storage (if using redis store)

# =============================================================================
# EXTERNAL API KEYS (OPTIONAL)
# =============================================================================
ANTHROPIC_API_KEY=                                  # Claude AI API key (optional)
PERPLEXITY_API_KEY=                                 # Perplexity AI API key (optional)
OPENAI_API_KEY=                                     # OpenAI API key (optional)
GOOGLE_API_KEY=                                     # Google APIs key (optional)
MISTRAL_API_KEY=                                    # Mistral AI API key (optional)
XAI_API_KEY=                                        # xAI API key (optional)
AZURE_OPENAI_API_KEY=                               # Azure OpenAI API key (optional)

# =============================================================================
# FEATURE FLAGS
# =============================================================================
FEATURE_ADVANCED_ANALYTICS=false                   # Enable advanced analytics features (default: false)
FEATURE_MULTI_CURRENCY=true                        # Enable multi-currency support (default: true)
FEATURE_VENDOR_PORTAL=true                         # Enable vendor portal features (default: true)
FEATURE_MOBILE_APP=false                           # Enable mobile app features (default: false)

# =============================================================================
# DEVELOPMENT/TESTING OVERRIDES
# =============================================================================
# These settings are typically only used in development or testing environments

# Development Security Relaxation (DO NOT USE IN PRODUCTION)
# Uncomment these ONLY for local development:
# SESSION_SECURE=false                              # Allow HTTP cookies in development
# CSP_ENABLED=false                                 # Disable CSP in development
# CORS_ORIGIN=*                                     # Allow all origins in development
# KEYCLOAK_BASE_URL=http://localhost:8080           # Local Keycloak server
# AUTH_STRATEGY=hybrid                              # Allow both JWT and Keycloak in development

# Testing Configuration
# Uncomment these for automated testing:
# JWT_EXPIRES_IN=1m                                 # Short expiration for testing
# AUDIT_LOG_ENABLED=false                           # Disable audit logs in tests
# API_RATE_LIMIT_MAX_REQUESTS=10000                 # High limit for tests

# =============================================================================
# PRODUCTION CHECKLIST
# =============================================================================
# Before deploying to production, ensure:
# ‚úÖ All secrets are strong and unique (use openssl rand -base64 64)
# ‚úÖ CORS_ORIGIN is set to your specific domain(s)
# ‚úÖ SESSION_SECURE=true (requires HTTPS)
# ‚úÖ CSP_ENABLED=true
# ‚úÖ Database URL uses SSL (add ?sslmode=require)
# ‚úÖ Monitoring webhooks are configured
# ‚úÖ All sensitive variables are stored in secure secret management
# ‚úÖ No development overrides are active
# 
# KEYCLOAK PRODUCTION CHECKLIST:
# ‚úÖ KEYCLOAK_BASE_URL uses HTTPS
# ‚úÖ KEYCLOAK_CLIENT_SECRET is secure and rotated regularly
# ‚úÖ Keycloak realm is properly configured with security policies
# ‚úÖ User registration is disabled in Keycloak (registrationAllowed: false)
# ‚úÖ Password policies are enforced in Keycloak
# ‚úÖ Session timeouts are configured appropriately
# ‚úÖ Redis is configured for session storage (not memory)
# ‚úÖ AUTH_STRATEGY is set to 'keycloak-only' for new deployments
# =============================================================================