<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS Mapping Navigation Review - Carmen ERP Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--bg-light);
            color: var(--text-primary);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: var(--bg-white);
            border-right: 1px solid var(--border);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            padding: 2rem 0;
        }

        .sidebar-header {
            padding: 0 1.5rem;
            margin-bottom: 2rem;
        }

        .sidebar-header h1 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .back-link:hover {
            color: var(--primary);
        }

        .sidebar nav {
            padding: 0 1rem;
        }

        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-section h3 {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            padding: 0 0.5rem;
            margin-bottom: 0.5rem;
        }

        .nav-section ul {
            list-style: none;
        }

        .nav-section a {
            display: block;
            padding: 0.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .nav-section a:hover,
        .nav-section a.active {
            background: var(--bg-light);
            color: var(--primary);
        }

        .main-content {
            margin-left: 280px;
            flex: 1;
            padding: 2rem;
            max-width: calc(100% - 280px);
        }

        .breadcrumb {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .breadcrumb a {
            color: var(--primary);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .content-wrapper {
            display: flex;
            gap: 2rem;
        }

        .document-content {
            flex: 1;
            background: var(--bg-white);
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
            min-width: 0;
        }

        .toc-sidebar {
            width: 250px;
            flex-shrink: 0;
        }

        .toc-sticky {
            position: sticky;
            top: 2rem;
            background: var(--bg-white);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
        }

        .toc-title {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .toc-list {
            list-style: none;
        }

        .toc-list a {
            display: block;
            padding: 0.25rem 0;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            transition: color 0.2s;
        }

        .toc-list a:hover {
            color: var(--primary);
        }

        .toc-list .toc-h2 {
            margin-left: 0;
            font-weight: 500;
        }

        .toc-list .toc-h3 {
            margin-left: 1rem;
            font-size: 0.8125rem;
        }

        .toc-list .toc-h4 {
            margin-left: 2rem;
            font-size: 0.75rem;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        h2 {
            font-size: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
            color: var(--text-primary);
        }

        h3 {
            font-size: 1.25rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        h4 {
            font-size: 1.125rem;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        p {
            margin-bottom: 1rem;
        }

        ul, ol {
            margin-bottom: 1rem;
            padding-left: 2rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        code {
            background: var(--bg-light);
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.875rem;
        }

        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        pre code {
            background: transparent;
            padding: 0;
            color: inherit;
        }

        blockquote {
            border-left: 4px solid var(--primary);
            padding-left: 1rem;
            margin: 1rem 0;
            color: var(--text-secondary);
            font-style: italic;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
        }

        th, td {
            border: 1px solid var(--border);
            padding: 0.75rem;
            text-align: left;
        }

        th {
            background: var(--bg-light);
            font-weight: 600;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 2rem 0;
        }

        img {
            max-width: 600px;
            height: auto;
            border-radius: 0.5rem;
            border: 1px solid var(--border);
            margin: 1rem 0;
            display: block;
        }

        .mermaid {
            background: var(--bg-white);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1.5rem 0;
            display: flex;
            justify-content: center;
            border: 1px solid var(--border);
            max-width: 800px;
            overflow-x: auto;
        }

        .mermaid svg {
            max-width: 100%;
            max-height: 500px;
            height: auto;
            transform: scale(0.85);
            transform-origin: top center;
        }

        @media (max-width: 1024px) {
            .sidebar {
                display: none;
            }

            .main-content {
                margin-left: 0;
                max-width: 100%;
            }

            .toc-sidebar {
                display: none;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';

        // Initialize Mermaid with enhanced configuration
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            themeVariables: {
                primaryColor: '#2563eb',
                primaryTextColor: '#0f172a',
                primaryBorderColor: '#1e40af',
                lineColor: '#64748b',
                secondaryColor: '#10b981',
                tertiaryColor: '#f59e0b',
                background: '#ffffff',
                mainBkg: '#f8fafc',
                secondBkg: '#e2e8f0',
                border1: '#cbd5e1',
                border2: '#94a3b8'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true,
                wrap: true
            },
            gantt: {
                useMaxWidth: true
            }
        });

        // Expose mermaid globally and signal it's ready
        window.mermaid = mermaid;
        window.mermaidReady = true;

        // Dispatch event when mermaid is ready
        window.dispatchEvent(new Event('mermaidLoaded'));
    </script>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="index.html" class="back-link">‚Üê All Modules</a>
            <h1>POS-MAPPING-NAVIGATION-REVIEW.MD</h1>
        </div>

        <nav>
            <div class="nav-section">
                <h3>Navigation</h3>
                <ul>
                    <li><a href="index.html">Module Overview</a></li>
                    <li><a href="index.html#features">Features</a></li>
                </ul>
            </div>
        </nav>
    </aside>

    <div class="main-content">
        <div class="breadcrumb"><a href="index.html">Documentation</a></div>

        <div class="content-wrapper">
            <div class="document-content" id="markdown-content"></div>

            <aside class="toc-sidebar">
                <div class="toc-sticky">
                    <div class="toc-title">On This Page</div>
                    <ul class="toc-list" id="toc-list"></ul>
                </div>
            </aside>
        </div>
    </div>

    <script>
        const markdownContent = "# POS Mapping Navigation Review\n\n## Executive Summary\n\nThe POS Mapping module has **incomplete navigation** for edit and view details functionality. While the UI shows action buttons (Edit, Delete, View History, Test Mapping), these actions currently only log to console and do not perform any actual operations.\n\n**Status**: ‚ö†Ô∏è **NEEDS IMPLEMENTATION**\n\n---\n\n## Current State Analysis\n\n### 1. Recipe Mapping (`/mapping/recipes/page.tsx`)\n**Available Actions**: Edit, Delete, View History, Test Mapping\n**Current Implementation**: `console.log` only\n**Missing Components**:\n- ‚ùå Edit Recipe Mapping Modal/Drawer\n- ‚ùå Delete Confirmation Dialog\n- ‚ùå Mapping History Drawer\n- ‚ùå Test Mapping Modal\n\n### 2. Unit Mapping (`/mapping/units/page.tsx`)\n**Available Actions**: Edit, Delete, View History\n**Current Implementation**: `console.log` only\n**Missing Components**:\n- ‚ùå Edit Unit Mapping Modal/Drawer\n- ‚ùå Delete Confirmation Dialog\n- ‚ùå Unit Mapping History Drawer\n\n### 3. Location Mapping (`/mapping/locations/page.tsx`)\n**Available Actions**: Edit, Delete, View History\n**Current Implementation**: `console.log` only\n**Missing Components**:\n- ‚ùå Edit Location Mapping Modal/Drawer\n- ‚ùå Delete Confirmation Dialog\n- ‚ùå Location Mapping History Drawer\n\n### 4. Fractional Variants (`/mapping/recipes/fractional-variants/page.tsx`)\n**Status**: Need to verify implementation\n\n---\n\n## Issues Identified\n\n### Critical Issues ‚ùå\n\n1. **No Edit Functionality**\n   - Users cannot modify existing mappings\n   - Edit button exists but does nothing\n   - No modal or drawer component for editing\n\n2. **No Delete Functionality**\n   - Users cannot remove incorrect mappings\n   - Delete button exists but does nothing\n   - No confirmation dialog\n\n3. **No History View**\n   - Users cannot see mapping change history\n   - History button exists but does nothing\n   - No audit trail display\n\n4. **No Test Functionality** (Recipe Mapping Only)\n   - Users cannot test if mapping works correctly\n   - Test button exists but does nothing\n   - No test result display\n\n### Navigation Issues üîÄ\n\n5. **Inconsistent Patterns**\n   - Transactions have `TransactionDetailDrawer` and `MappingDrawerModal`\n   - Mapping pages lack equivalent components\n   - No standardized pattern for edit/view actions\n\n6. **MappingDrawerModal Location**\n   - Currently in `/transactions/components/`\n   - Should be in `/mapping/components/` for better organization\n   - Only handles NEW mappings, not editing existing ones\n\n---\n\n## Existing Components Analysis\n\n### MappingDrawerModal (transactions/components/)\n**Purpose**: Create NEW POS item to recipe mappings\n**Features**:\n- ‚úÖ Recipe search\n- ‚úÖ Portion size configuration\n- ‚úÖ Unit selection\n- ‚úÖ Inventory impact preview\n- ‚úÖ Cost comparison\n\n**Limitations**:\n- ‚ùå Cannot edit existing mappings\n- ‚ùå No history view\n- ‚ùå No delete functionality\n- ‚ùå Located in wrong folder\n\n### RowActions Component\n**Purpose**: Display action menu for table rows\n**Features**:\n- ‚úÖ Configurable actions (edit, delete, history, link, test)\n- ‚úÖ Icon-based dropdown menu\n- ‚úÖ Disabled state support\n\n**Current Usage**:\n```typescript\n<RowActions\n  onAction={(action) => handleRowAction(action, row.original)}\n  availableActions={[\"edit\", \"delete\", \"history\", \"test\"]}\n/>\n```\n\n**Problem**: `handleRowAction` not implemented\n```typescript\nconst handleRowAction = (action: ActionType, recipe: RecipeMapping) => {\n  console.log(`${action} action on recipe:`, recipe)\n  // Implement action handlers here  ‚Üê TODO comment\n}\n```\n\n---\n\n## Required Components\n\n### 1. RecipeMapping EditDrawer\n**Location**: `/mapping/components/recipe-edit-drawer.tsx`\n**Features Needed**:\n- Pre-populated form with existing mapping data\n- Recipe selection with search\n- Portion size modification\n- Unit conversion\n- Inventory impact recalculation\n- Save/Cancel actions\n- Validation\n\n### 2. UnitMapping EditDrawer\n**Location**: `/mapping/components/unit-edit-drawer.tsx`\n**Features Needed**:\n- Pre-populated unit mapping data\n- Conversion rate modification\n- Unit type selection\n- Base unit selection\n- Save/Cancel actions\n- Validation\n\n### 3. LocationMapping EditDrawer\n**Location**: `/mapping/components/location-edit-drawer.tsx`\n**Features Needed**:\n- Pre-populated location mapping data\n- POS location selection\n- Carmen location mapping\n- Status modification\n- Save/Cancel actions\n\n### 4. MappingHistory Drawer\n**Location**: `/mapping/components/mapping-history-drawer.tsx`\n**Features Needed**:\n- Chronological change history\n- User attribution\n- Before/After comparison\n- Timestamp display\n- Filter by date range\n- Export history\n\n### 5. Delete Confirmation Dialog\n**Location**: `/mapping/components/delete-confirmation-dialog.tsx`\n**Features Needed**:\n- Warning message\n- Impact preview (if any)\n- Reason for deletion (optional)\n- Confirm/Cancel actions\n- Soft delete vs hard delete option\n\n### 6. Test Mapping Modal (Recipe only)\n**Location**: `/mapping/components/test-mapping-modal.tsx`\n**Features Needed**:\n- Input test quantity\n- Show expected inventory deductions\n- Display cost calculations\n- Show any errors or warnings\n- Test result summary\n\n---\n\n## Recommended Implementation Plan\n\n### Phase 1: Core Edit Functionality (Priority: HIGH)\n1. ‚úÖ Create `recipe-edit-drawer.tsx`\n2. ‚úÖ Create `unit-edit-drawer.tsx`\n3. ‚úÖ Create `location-edit-drawer.tsx`\n4. ‚úÖ Implement state management for drawers\n5. ‚úÖ Connect edit actions to drawers\n\n### Phase 2: Delete Functionality (Priority: HIGH)\n1. ‚úÖ Create `delete-confirmation-dialog.tsx`\n2. ‚úÖ Implement soft delete vs hard delete\n3. ‚úÖ Add impact analysis\n4. ‚úÖ Connect delete actions to dialog\n\n### Phase 3: History & Audit (Priority: MEDIUM)\n1. ‚úÖ Create `mapping-history-drawer.tsx`\n2. ‚úÖ Design history data structure\n3. ‚úÖ Implement history tracking\n4. ‚úÖ Add filter and export features\n\n### Phase 4: Testing & Validation (Priority: MEDIUM)\n1. ‚úÖ Create `test-mapping-modal.tsx`\n2. ‚úÖ Implement test logic\n3. ‚úÖ Add validation rules\n4. ‚úÖ Display test results\n\n### Phase 5: Component Reorganization (Priority: LOW)\n1. ‚úÖ Move `MappingDrawerModal` to `/mapping/components/`\n2. ‚úÖ Update imports across codebase\n3. ‚úÖ Standardize component naming\n4. ‚úÖ Update navigation map documentation\n\n---\n\n## Navigation Flow Improvements\n\n### Current Flow (Broken)\n```\nUser clicks Edit ‚Üí Console.log ‚Üí Nothing happens\nUser clicks Delete ‚Üí Console.log ‚Üí Nothing happens\nUser clicks History ‚Üí Console.log ‚Üí Nothing happens\n```\n\n### Proposed Flow\n```\nRecipe Mapping:\nUser clicks Edit ‚Üí RecipeEditDrawer opens ‚Üí User modifies ‚Üí Save ‚Üí Drawer closes ‚Üí Table refreshes\nUser clicks Delete ‚Üí DeleteConfirmationDialog opens ‚Üí User confirms ‚Üí Delete ‚Üí Dialog closes ‚Üí Table refreshes\nUser clicks History ‚Üí MappingHistoryDrawer opens ‚Üí Show audit trail ‚Üí User closes drawer\nUser clicks Test ‚Üí TestMappingModal opens ‚Üí User tests ‚Üí View results ‚Üí User closes modal\n\nUnit Mapping:\nUser clicks Edit ‚Üí UnitEditDrawer opens ‚Üí User modifies ‚Üí Save ‚Üí Drawer closes ‚Üí Table refreshes\nUser clicks Delete ‚Üí DeleteConfirmationDialog opens ‚Üí User confirms ‚Üí Delete ‚Üí Dialog closes ‚Üí Table refreshes\nUser clicks History ‚Üí MappingHistoryDrawer opens ‚Üí Show audit trail ‚Üí User closes drawer\n\nLocation Mapping:\nUser clicks Edit ‚Üí LocationEditDrawer opens ‚Üí User modifies ‚Üí Save ‚Üí Drawer closes ‚Üí Table refreshes\nUser clicks Delete ‚Üí DeleteConfirmationDialog opens ‚Üí User confirms ‚Üí Delete ‚Üí Dialog closes ‚Üí Table refreshes\nUser clicks History ‚Üí MappingHistoryDrawer opens ‚Üí Show audit trail ‚Üí User closes drawer\n```\n\n---\n\n## Code Examples\n\n### Example: Implementing Edit Action\n\n**Before** (Current - Broken):\n```typescript\nconst handleRowAction = (action: ActionType, recipe: RecipeMapping) => {\n  console.log(`${action} action on recipe:`, recipe)\n  // Implement action handlers here\n}\n```\n\n**After** (Proposed - Working):\n```typescript\nconst [editDrawerOpen, setEditDrawerOpen] = useState(false)\nconst [selectedRecipe, setSelectedRecipe] = useState<RecipeMapping | null>(null)\nconst [deleteDialogOpen, setDeleteDialogOpen] = useState(false)\nconst [historyDrawerOpen, setHistoryDrawerOpen] = useState(false)\nconst [testModalOpen, setTestModalOpen] = useState(false)\n\nconst handleRowAction = (action: ActionType, recipe: RecipeMapping) => {\n  setSelectedRecipe(recipe)\n\n  switch(action) {\n    case \"edit\":\n      setEditDrawerOpen(true)\n      break\n    case \"delete\":\n      setDeleteDialogOpen(true)\n      break\n    case \"history\":\n      setHistoryDrawerOpen(true)\n      break\n    case \"test\":\n      setTestModalOpen(true)\n      break\n  }\n}\n\n// In JSX:\n<RecipeEditDrawer\n  open={editDrawerOpen}\n  onOpenChange={setEditDrawerOpen}\n  recipe={selectedRecipe}\n  onSave={handleSaveMapping}\n/>\n\n<DeleteConfirmationDialog\n  open={deleteDialogOpen}\n  onOpenChange={setDeleteDialogOpen}\n  mapping={selectedRecipe}\n  onConfirm={handleDeleteMapping}\n/>\n\n<MappingHistoryDrawer\n  open={historyDrawerOpen}\n  onOpenChange={setHistoryDrawerOpen}\n  mappingId={selectedRecipe?.id}\n/>\n\n<TestMappingModal\n  open={testModalOpen}\n  onOpenChange={setTestModalOpen}\n  mapping={selectedRecipe}\n/>\n```\n\n---\n\n## Testing Requirements\n\n### Manual Testing Checklist\n- [ ] Edit recipe mapping and verify save\n- [ ] Edit unit mapping and verify save\n- [ ] Edit location mapping and verify save\n- [ ] Delete mapping with confirmation\n- [ ] Cancel delete operation\n- [ ] View mapping history\n- [ ] Test recipe mapping\n- [ ] Verify table refreshes after save/delete\n- [ ] Test validation on all forms\n- [ ] Test error handling\n\n### Accessibility Testing\n- [ ] Keyboard navigation for all modals\n- [ ] Screen reader announcements\n- [ ] Focus management on open/close\n- [ ] Escape key closes modals\n- [ ] Tab trapping in dialogs\n\n---\n\n## Impact Assessment\n\n### User Impact\n**Before**: Users cannot edit, delete, or view history of mappings\n**After**: Full CRUD operations available for all mapping types\n\n### Business Impact\n- ‚úÖ Reduces support tickets (users can fix mappings themselves)\n- ‚úÖ Improves data quality (easier to maintain accurate mappings)\n- ‚úÖ Increases user confidence (full control over their data)\n- ‚úÖ Provides audit trail (compliance and troubleshooting)\n\n### Technical Debt\n**Current**: High - Core functionality missing\n**After Implementation**: Low - Complete feature set with proper patterns\n\n---\n\n## Conclusion\n\nThe POS Mapping module requires significant implementation work to complete the edit/view/delete functionality. All UI elements are in place, but the actual functionality is missing.\n\n**Recommendation**: Prioritize Phase 1 (Core Edit Functionality) and Phase 2 (Delete Functionality) as these are critical user features. History and testing features can be implemented in subsequent releases.\n\n**Estimated Effort**:\n- Phase 1: 8-12 hours\n- Phase 2: 4-6 hours\n- Phase 3: 6-8 hours\n- Phase 4: 6-8 hours\n- Phase 5: 2-4 hours\n- **Total**: 26-38 hours\n\n**Priority**: **HIGH** - Users cannot manage mappings without this functionality.\n";

        // Configure marked
        marked.setOptions({
            highlight: function(code, lang) {
                return code;
            },
            breaks: true,
            gfm: true
        });

        // Render markdown
        const contentDiv = document.getElementById('markdown-content');
        contentDiv.innerHTML = marked.parse(markdownContent);

        // Function to render Mermaid diagrams
        function renderMermaidDiagrams() {
            if (!window.mermaid) {
                console.log('Mermaid not loaded yet, waiting...');
                return;
            }

            // Find all code blocks with mermaid language
            const mermaidBlocks = contentDiv.querySelectorAll('pre code.language-mermaid, pre code[class*="mermaid"]');

            if (mermaidBlocks.length === 0) {
                console.log('No mermaid blocks found');
                return;
            }

            console.log('Found', mermaidBlocks.length, 'mermaid blocks');

            mermaidBlocks.forEach((block, index) => {
                const mermaidCode = block.textContent;
                const pre = block.parentElement;

                // Create a div for mermaid diagram
                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.textContent = mermaidCode;
                mermaidDiv.id = 'mermaid-diagram-' + index;

                // Replace the pre block with mermaid div
                pre.replaceWith(mermaidDiv);
            });

            // Run mermaid rendering
            window.mermaid.run({
                querySelector: '.mermaid'
            }).then(() => {
                console.log('Mermaid diagrams rendered successfully');
            }).catch(err => {
                console.error('Mermaid rendering error:', err);
            });
        }

        // Wait for mermaid to load before rendering
        if (window.mermaidReady) {
            renderMermaidDiagrams();
        } else {
            window.addEventListener('mermaidLoaded', renderMermaidDiagrams);
            // Fallback timeout
            setTimeout(renderMermaidDiagrams, 1000);
        }

        // Generate TOC from headings
        const tocList = document.getElementById('toc-list');
        const headings = contentDiv.querySelectorAll('h2, h3, h4');

        headings.forEach((heading, index) => {
            const id = 'heading-' + index;
            heading.id = id;

            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + id;
            a.textContent = heading.textContent;
            a.className = 'toc-' + heading.tagName.toLowerCase();

            li.appendChild(a);
            tocList.appendChild(li);
        });

        // Highlight active TOC item on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.id;
                    tocList.querySelectorAll('a').forEach(a => {
                        a.style.color = a.getAttribute('href') === '#' + id ? 'var(--primary)' : 'var(--text-secondary)';
                        a.style.fontWeight = a.getAttribute('href') === '#' + id ? '600' : '400';
                    });
                }
            });
        }, { threshold: 1.0 });

        headings.forEach(heading => observer.observe(heading));
    </script>
</body>
</html>