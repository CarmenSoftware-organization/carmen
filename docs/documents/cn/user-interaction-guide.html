<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Note Module - User Interaction Guide - Carmen ERP Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--bg-light);
            color: var(--text-primary);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: var(--bg-white);
            border-right: 1px solid var(--border);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            padding: 2rem 0;
        }

        .sidebar-header {
            padding: 0 1.5rem;
            margin-bottom: 2rem;
        }

        .sidebar-header h1 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .back-link:hover {
            color: var(--primary);
        }

        .sidebar nav {
            padding: 0 1rem;
        }

        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-section h3 {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            padding: 0 0.5rem;
            margin-bottom: 0.5rem;
        }

        .nav-section ul {
            list-style: none;
        }

        .nav-section a {
            display: block;
            padding: 0.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .nav-section a:hover,
        .nav-section a.active {
            background: var(--bg-light);
            color: var(--primary);
        }

        .main-content {
            margin-left: 280px;
            flex: 1;
            padding: 2rem;
            max-width: calc(100% - 280px);
        }

        .breadcrumb {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .breadcrumb a {
            color: var(--primary);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .content-wrapper {
            display: flex;
            gap: 2rem;
        }

        .document-content {
            flex: 1;
            background: var(--bg-white);
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
            min-width: 0;
        }

        .toc-sidebar {
            width: 250px;
            flex-shrink: 0;
        }

        .toc-sticky {
            position: sticky;
            top: 2rem;
            background: var(--bg-white);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
        }

        .toc-title {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .toc-list {
            list-style: none;
        }

        .toc-list a {
            display: block;
            padding: 0.25rem 0;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            transition: color 0.2s;
        }

        .toc-list a:hover {
            color: var(--primary);
        }

        .toc-list .toc-h2 {
            margin-left: 0;
            font-weight: 500;
        }

        .toc-list .toc-h3 {
            margin-left: 1rem;
            font-size: 0.8125rem;
        }

        .toc-list .toc-h4 {
            margin-left: 2rem;
            font-size: 0.75rem;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        h2 {
            font-size: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
            color: var(--text-primary);
        }

        h3 {
            font-size: 1.25rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        h4 {
            font-size: 1.125rem;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        p {
            margin-bottom: 1rem;
        }

        ul, ol {
            margin-bottom: 1rem;
            padding-left: 2rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        code {
            background: var(--bg-light);
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.875rem;
        }

        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        pre code {
            background: transparent;
            padding: 0;
            color: inherit;
        }

        blockquote {
            border-left: 4px solid var(--primary);
            padding-left: 1rem;
            margin: 1rem 0;
            color: var(--text-secondary);
            font-style: italic;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
        }

        th, td {
            border: 1px solid var(--border);
            padding: 0.75rem;
            text-align: left;
        }

        th {
            background: var(--bg-light);
            font-weight: 600;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 2rem 0;
        }

        img {
            max-width: 600px;
            height: auto;
            border-radius: 0.5rem;
            border: 1px solid var(--border);
            margin: 1rem 0;
            display: block;
        }

        .mermaid {
            background: var(--bg-white);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1.5rem 0;
            display: flex;
            justify-content: center;
            border: 1px solid var(--border);
            max-width: 800px;
            overflow-x: auto;
        }

        .mermaid svg {
            max-width: 100%;
            max-height: 500px;
            height: auto;
            transform: scale(0.85);
            transform-origin: top center;
        }

        @media (max-width: 1024px) {
            .sidebar {
                display: none;
            }

            .main-content {
                margin-left: 0;
                max-width: 100%;
            }

            .toc-sidebar {
                display: none;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';

        // Initialize Mermaid with enhanced configuration
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            themeVariables: {
                primaryColor: '#2563eb',
                primaryTextColor: '#0f172a',
                primaryBorderColor: '#1e40af',
                lineColor: '#64748b',
                secondaryColor: '#10b981',
                tertiaryColor: '#f59e0b',
                background: '#ffffff',
                mainBkg: '#f8fafc',
                secondBkg: '#e2e8f0',
                border1: '#cbd5e1',
                border2: '#94a3b8'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true,
                wrap: true
            },
            gantt: {
                useMaxWidth: true
            }
        });

        // Expose mermaid globally and signal it's ready
        window.mermaid = mermaid;
        window.mermaidReady = true;

        // Dispatch event when mermaid is ready
        window.dispatchEvent(new Event('mermaidLoaded'));
    </script>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="back-link">← All Modules</a>
            <h1>Credit Notes</h1>
        </div>

        <nav>
            <div class="nav-section">
                <h3>Navigation</h3>
                <ul>
                    <li><a href="../index.html">Module Overview</a></li>
                    <li><a href="../index.html#features">Features</a></li>
                </ul>
            </div>
        </nav>
    </aside>

    <div class="main-content">
        <div class="breadcrumb"><a href="../index.html">Documentation</a> / <a href="../index.html">CN</a></div>

        <div class="content-wrapper">
            <div class="document-content" id="markdown-content"></div>

            <aside class="toc-sidebar">
                <div class="toc-sticky">
                    <div class="toc-title">On This Page</div>
                    <ul class="toc-list" id="toc-list"></ul>
                </div>
            </aside>
        </div>
    </div>

    <script>
        const markdownContent = "# Credit Note Module - User Interaction Guide\n\n## Table of Contents\n1. [Navigation & Entry Points](#navigation--entry-points)\n2. [Primary User Workflows](#primary-user-workflows)\n3. [Dialog Interactions](#dialog-interactions)\n4. [Form Interactions](#form-interactions)\n5. [Data Management](#data-management)\n6. [Advanced Features](#advanced-features)\n\n## Navigation & Entry Points\n\n### Main Navigation\n- **Primary Access:** Procurement → Credit Note (sidebar menu)\n- **Breadcrumb:** Dashboard → Procurement → Credit Note\n- **URL Pattern:** `/procurement/credit-note`\n\n### Direct Links\n- **Specific Credit Note:** `/procurement/credit-note/[CN-ID]`\n- **Create from GRN:** `/procurement/credit-note/new/vendor-selection`\n- **Create Manual:** `/procurement/credit-note/new-[UUID]?mode=confirm`\n- **Edit Mode:** `/procurement/credit-note/[CN-ID]?mode=edit`\n\n## Primary User Workflows\n\n### 1. Create Credit Note from GRN\n\n**Step-by-Step Process:**\n\n1. **Navigate to Credit Note List**\n   - Click \"Procurement\" in sidebar\n   - Select \"Credit Note\"\n\n![Credit Note List Page](./screenshots/cn-list-page.png)\n\n2. **Initiate GRN-based Creation**\n   - Click \"New Credit Note\" dropdown button\n   - Select \"Create from GRN\"\n\n![New Credit Note Type Selection Dialog](./screenshots/cn-new-type-selection-dialog.png)\n\n\n3. **Select Vendor**\n   - Use search to find vendor by name or registration number\n   - Click \"Select\" button for desired vendor\n   - System stores vendor selection and navigates to GRN selection\n\n4. **Choose GRNs**\n   - Review GRNs from selected vendor\n   - Select single or multiple GRNs for credit note creation\n   - Preview total amounts and item counts\n   - Click \"Continue\" to proceed\n\n5. **Select Items and Quantities**\n   - Choose specific items to credit from selected GRNs\n   - Enter credit quantities for each item\n   - Select appropriate reason codes (return, damage, quality issue)\n   - Add lot numbers if applicable\n   - Review real-time amount calculations\n   - Click \"Next: Confirm Credit Note\" to proceed\n\n6. **Review Auto-populated Data**\n   - Verify vendor information is correct\n   - Check auto-populated items from selected GRNs\n   - Review calculated totals and currency information\n   - Modify quantities if partial credit\n\n![Credit Note Detail Page - Items Tab](./screenshots/cn-detail-page-items-tab.png)\n\n![Credit Note Detail Page - Stock Movement Tab](./screenshots/cn-detail-page-stock-movement-tab.png)\n\n7. **Complete Header Information**\n   - Set credit note date (defaults to today)\n   - Enter credit note reference number (auto-generated)\n   - Select credit note type (Quantity Return or Amount Discount)\n   - Add reason for credit note\n   - Choose appropriate cash book\n   - Add description and remarks\n\n8. **Configure Credit Note Type**\n   - Select \"Quantity Return\" for returned goods\n   - Select \"Amount Discount\" for price adjustments\n   - Configure approval requirements if applicable\n\n9. **Confirm and Save**\n   - Review all details in confirm mode\n   - Use \"Edit Further\" if changes needed\n   - Click \"Confirm & Save\" to finalize credit note\n   - System generates final credit note number and saves\n\n**Screenshot References:**\n- Credit Note List Page (Card and Table Views)\n- New Credit Note Type Selection Dialog\n- Credit Note Detail Page (Items and Stock Movement Tabs)\n\n### 2. Create Credit Note Manually\n\n**Step-by-Step Process:**\n\n1. **Access Manual Creation**\n   - From Credit Note List page\n   - Click \"New Credit Note\" → \"Create Manually\"\n\n2. **Auto-navigation to Confirm Mode**\n   - System creates temporary credit note with placeholder data\n   - Navigates directly to credit note detail in confirm mode\n   - All fields empty for manual entry\n\n3. **Enter Header Information**\n   - Set credit note date\n   - Select vendor from dropdown\n   - Choose credit note type\n   - Enter reference details manually\n   - Choose cash book\n   - Add description and reason\n\n4. **Add Items Manually**\n   - Navigate to Items tab\n   - Click \"Add Item\" button\n   - Search and select products\n   - Enter quantities and pricing\n   - Configure reason codes\n   - Add lot numbers if applicable\n\n5. **Review Financial Summary**\n   - Check calculated totals\n   - Verify currency amounts\n   - Confirm calculations\n\n6. **Finalize Credit Note**\n   - Return to confirm mode view\n   - Review all entered data\n   - Click \"Confirm & Save\" to create credit note\n\n### 3. Edit Existing Credit Note\n\n**Edit Workflow:**\n\n1. **Access Credit Note for Editing**\n   - Open specific credit note from list\n   - Click \"Edit\" button in form footer\n   - System switches to edit mode\n\n2. **Modify Credit Note Data**\n   - Update header information as needed\n   - Modify item quantities and pricing\n   - Add or remove items\n   - Update reason codes\n\n3. **Review Changes**\n   - Monitor \"unsaved changes\" indicator\n   - Preview impact on financial totals\n   - Validate all modifications\n\n4. **Save or Cancel**\n   - Click \"Save\" to commit changes\n   - Or \"Cancel\" to discard modifications\n   - System returns to view mode after save\n\n### 4. Process Credit Note Approval\n\n**Approval Workflow:**\n\n1. **Access Credit Note for Review**\n   - Open credit note in pending approval status\n   - Review all credit note details\n   - Check supporting documentation\n\n2. **Review Credit Note Details**\n   - Verify vendor information\n   - Check item details and quantities\n   - Review reason codes and justifications\n   - Validate financial calculations\n\n3. **Make Approval Decision**\n   - Click \"Approve\" to approve credit note\n   - Click \"Reject\" to reject with comments\n   - Add approval comments if required\n\n4. **Process Approved Credit Note**\n   - System updates status to \"Approved\"\n   - Generates necessary accounting entries\n   - Updates vendor balance\n   - Sends notifications to relevant parties\n\n### 5. Manage Credit Note Items\n\n**Item Management Workflow:**\n\n1. **Access Items Tab**\n   - Open credit note detail page\n   - Click on \"Items\" tab\n\n2. **Review Item Details**\n   - Check credited quantities\n   - Monitor reason codes\n   - Identify item-specific issues\n\n3. **Update Item Information**\n   - Click edit icon for item\n   - Modify credited quantity\n   - Update reason codes\n   - Add item-specific notes\n\n4. **Handle Item Variations**\n   - Use \"Split Line\" function for partial credits\n   - Create separate line items for tracking\n   - Track multiple reason codes per item\n\n5. **Bulk Operations**\n   - Select multiple items using checkboxes\n   - Choose bulk action from dropdown\n   - Apply changes to selected items\n\n6. **Finalize Items**\n   - Mark items as \"Processed\"\n   - Close line items when complete\n   - Update credit note status when all items complete\n\n## Dialog Interactions\n\n### 1. New Credit Note Creation Dialog\n\n**Interface Elements:**\n- **Process Type Selection**: Cards for GRN-based vs Manual creation\n- **Visual Indicators**: Icons and descriptions for each option\n- **Action Buttons**: Clear selection and navigation\n\n**User Actions:**\n- **Select Process Type**: Click on preferred creation method\n- **Automatic Navigation**: System routes to appropriate next step\n- **No Confirmation**: Selection immediately proceeds to workflow\n\n### 2. Vendor Selection Dialog\n\n**Interface Elements:**\n- **Search Bar**: Filter vendors by name or registration\n- **Vendor Table**: Business registration number, company name, action button\n- **Loading States**: Progress indicators during data fetch\n\n**User Actions:**\n- **Search**: Type vendor name or registration number\n- **Filter**: Real-time filtering as user types\n- **Select**: Click \"Select\" button for desired vendor\n- **Validation**: Only active vendors selectable\n\n### 3. Item Add/Edit Dialogs\n\n**Add Item Dialog:**\n- **Product Search**: Searchable product catalog\n- **Quantity Fields**: Available and credit quantities\n- **Reason Code Selection**: Dropdown with predefined codes\n- **Lot Number Entry**: Optional lot tracking\n- **Validation**: Required fields and business rules\n\n**Edit Item Dialog:**\n- **Pre-populated Fields**: Current item values\n- **Change Tracking**: Visual indicators for modifications\n- **Impact Preview**: Updated totals before saving\n- **Validation**: Quantity and reason code constraints\n\n**User Actions:**\n- **Product Selection**: Search and choose from catalog\n- **Quantity Entry**: Enter credit amounts with validation\n- **Reason Code Setup**: Select appropriate reason codes\n- **Save/Cancel**: Commit changes or discard modifications\n\n### 4. Approval Confirmation Dialog\n\n**Dialog Triggers:**\n- **Approval Action**: Credit note submitted for approval\n- **Rejection Action**: Credit note rejected with comments\n\n**Interface Elements:**\n- **Action Summary**: Description of approval decision\n- **Impact Information**: Financial and inventory impacts\n- **Comment Field**: Required for rejections, optional for approvals\n- **Confirmation Buttons**: Proceed or Cancel options\n\n**User Actions:**\n- **Review Details**: Verify credit note information\n- **Add Comments**: Provide approval/rejection reasoning\n- **Confirm Decision**: Proceed with approval action\n- **Cancel**: Abort operation and return to credit note\n\n### 5. Bulk Actions Confirmation\n\n**Dialog Triggers:**\n- **Item Selection**: Multiple credit notes selected in list\n- **Bulk Action**: Action chosen from bulk actions menu\n\n**Interface Elements:**\n- **Action Summary**: Description of operation to be performed\n- **Item Count**: Number of credit notes affected\n- **Confirmation Buttons**: Proceed or Cancel options\n- **Warning Messages**: For irreversible operations\n\n**User Actions:**\n- **Review Selection**: Verify credit notes and action\n- **Confirm Operation**: Proceed with bulk action\n- **Cancel**: Abort operation and return to list\n\n## Form Interactions\n\n### 1. Header Information Form\n\n**Field Types and Validation:**\n\n**Date Fields:**\n- **Credit Note Date**: HTML5 date picker, defaults to today\n- **GRN Date**: Read-only, populated from selected GRN\n- **Due Date**: Optional, for payment terms\n\n**Selection Fields:**\n- **Vendor**: Dropdown with search capability\n- **Credit Note Type**: Radio buttons (Quantity Return, Amount Discount)\n- **Currency**: Multi-currency support with exchange rates\n- **Cash Book**: Account selection for financial posting\n\n**Text Fields:**\n- **Reference Number**: Auto-generated or manual entry\n- **Description**: Multi-line text area for details\n- **Reason**: Required explanation for credit note\n- **Remarks**: Additional comments and notes\n\n**Validation Rules:**\n- **Required Fields**: Date, vendor, type, reason marked with indicators\n- **Date Logic**: Credit note date ≤ current date\n- **Currency Consistency**: Must match GRN currency if from GRN\n- **Character Limits**: Text fields have maximum length validation\n\n### 2. Items Tab Interactions\n\n**Item Selection:**\n- **Individual Selection**: Checkbox per item row\n- **Bulk Selection**: Master checkbox for all items\n- **Range Selection**: Shift+click for contiguous ranges\n- **Visual Feedback**: Selected items highlighted\n\n**Quantity Management:**\n- **Available Quantity**: Read-only (from GRN or manual entry)\n- **Credit Quantity**: Editable field with validation\n- **Unit Display**: Order unit and base unit with conversion\n\n**Reason Code Management:**\n- **Reason Code**: Dropdown with predefined codes\n- **Custom Reason**: Text field for specific explanations\n- **Category Grouping**: Codes grouped by category (quality, damage, return)\n\n**Lot Management:**\n- **Lot Number**: Text field for lot tracking\n- **Expiry Date**: Date picker for perishable items\n- **Batch Information**: Additional batch details\n\n**Item Actions:**\n- **Add New**: Button opens item creation dialog\n- **Edit**: Pencil icon for item modification\n- **Delete**: Trash icon with confirmation\n- **Split**: Divide quantities for partial credits\n\n### 3. Documents Tab Interactions\n\n**Document Management:**\n- **Upload**: Drag-and-drop or click to upload\n- **Preview**: Click to view document content\n- **Download**: Download original document\n- **Delete**: Remove document with confirmation\n\n**Document Types:**\n- **Supporting Documents**: Invoices, delivery notes\n- **Quality Reports**: Inspection reports, quality issues\n- **Photos**: Product condition, damage evidence\n- **Correspondence**: Email chains, vendor communication\n\n**Document Validation:**\n- **File Size**: Maximum file size limits\n- **File Type**: Allowed formats (PDF, images, documents)\n- **Virus Scanning**: Automatic security scanning\n- **Access Control**: Permission-based access\n\n## Data Management\n\n### 1. Search and Filtering\n\n**Quick Filters:**\n- **Status-based Filtering**: Draft, Pending Approval, Approved, Processed\n- **Date Range Selection**: From/To date pickers\n- **Vendor Filtering**: Multi-select vendor dropdown\n- **Amount Range**: Min/Max amount filters\n- **Type Filtering**: Quantity Return vs Amount Discount\n\n**Advanced Search:**\n- **Credit Note Reference**: Exact or partial match\n- **GRN Reference**: Cross-reference search\n- **Item Description**: Search within credit note items\n- **Reason Codes**: Search by reason categories\n- **Multi-criteria**: Combine multiple search terms\n\n**Search Features:**\n- **Auto-complete**: Suggestions based on existing data\n- **Search History**: Recently used search terms\n- **Saved Searches**: Store frequently used filters\n- **Clear Filters**: Reset all search criteria\n\n### 2. Bulk Operations\n\n**Selection Methods:**\n- **Individual Selection**: Click checkboxes for specific credit notes\n- **Page Selection**: Select all credit notes on current page\n- **Filter-based Selection**: Select all matching filter criteria\n- **Manual Range**: Shift+click for range selection\n\n**Bulk Actions:**\n- **Status Updates**: Change status for multiple credit notes\n- **Export Operations**: Generate reports for selected credit notes\n- **Print Batches**: Print multiple credit note documents\n- **Delete Operations**: Remove multiple credit notes (with confirmation)\n- **Approval Processing**: Bulk approve/reject operations\n\n**Progress Tracking:**\n- **Operation Progress**: Progress bars for bulk operations\n- **Success/Failure Count**: Results summary with details\n- **Error Reporting**: Detailed error information for failures\n- **Rollback**: Undo operations if supported\n\n### 3. Data Export and Import\n\n**Export Options:**\n- **PDF Reports**: Formatted credit note documents\n- **Excel Spreadsheets**: Detailed data for analysis\n- **CSV Files**: Data export for other systems\n- **Financial Reports**: Accounting-focused exports\n\n**Export Configuration:**\n- **Date Range**: Specify export period\n- **Field Selection**: Choose columns to include\n- **Format Options**: Layout and styling preferences\n- **Delivery Method**: Download or email delivery\n\n**Import Capabilities:**\n- **Bulk Credit Note Creation**: CSV import for multiple credit notes\n- **Item Data**: Import item information from spreadsheets\n- **Vendor Updates**: Bulk vendor information updates\n- **Validation**: Data validation before import\n\n## Advanced Features\n\n### 1. Multi-Currency Handling\n\n**Currency Operations:**\n- **Real-time Exchange Rates**: Automatic rate retrieval\n- **Historical Rates**: Date-specific exchange rates\n- **Manual Rate Override**: Custom exchange rate entry\n- **Currency Conversion**: Auto-conversion to base currency\n\n**Multi-Currency Display:**\n- **Primary Currency**: Credit note transaction currency\n- **Base Currency**: Company reporting currency\n- **Dual Display**: Side-by-side currency amounts\n- **Conversion Calculations**: Transparent rate application\n\n### 2. Workflow Integration\n\n**GRN Integration:**\n- **Seamless GRN to Credit Note**: Direct creation from GRNs\n- **Three-way Matching**: GRN-Credit Note-Payment matching\n- **Status Synchronization**: Update GRN status on credit note creation\n- **Quantity Tracking**: Monitor credited vs received\n\n**Inventory Integration:**\n- **Stock Updates**: Automatic inventory adjustments\n- **Location Tracking**: Multi-location stock management\n- **Cost Updates**: Weighted average cost calculations\n- **Availability Check**: Stock level validation\n\n**Financial Integration:**\n- **Journal Entries**: Automatic accounting entries\n- **Vendor Balance Updates**: Real-time balance adjustments\n- **Budget Integration**: Budget vs actual tracking\n- **Payment Processing**: Integration with accounts payable\n\n### 3. Approval Workflows\n\n**Approval Routing:**\n- **Amount-based Approval**: Different limits for different roles\n- **Department Approval**: Route based on requesting department\n- **Vendor Approval**: Special handling for new vendors\n- **Exception Handling**: Escalation for unusual transactions\n\n**Notification System:**\n- **Email Notifications**: Automatic notifications to approvers\n- **In-app Notifications**: Dashboard notification center\n- **Mobile Notifications**: Push notifications for mobile users\n- **Reminder System**: Automated follow-up reminders\n\n### 4. Integration Features\n\n**Vendor Portal Integration:**\n- **Vendor Access**: Portal for vendors to view credit notes\n- **Status Updates**: Real-time status communication\n- **Document Sharing**: Secure document exchange\n- **Payment Status**: Automated payment-credit note matching\n\n**Quality Management:**\n- **Quality Issues**: Integration with quality control\n- **Inspection Results**: Link QC results to credit notes\n- **Compliance Tracking**: Regulatory compliance monitoring\n- **Certificate Management**: Track vendor certifications\n\n**Reporting Integration:**\n- **Financial Reporting**: Integration with financial reports\n- **Operational Reports**: Credit note performance metrics\n- **Compliance Reports**: Regulatory reporting support\n- **Analytics**: Business intelligence integration\n\n### 5. Document Management\n\n**Document Lifecycle:**\n- **Creation**: Automatic document generation\n- **Review**: Multi-level document review process\n- **Approval**: Electronic signature support\n- **Archive**: Long-term document storage\n\n**Document Security:**\n- **Access Control**: Role-based document access\n- **Audit Trail**: Complete document access logging\n- **Version Control**: Document version management\n- **Encryption**: Document encryption at rest and in transit\n\n**Document Automation:**\n- **Template Management**: Customizable document templates\n- **Auto-generation**: Automatic document creation\n- **Email Integration**: Automatic document distribution\n- **Print Queue**: Batch printing capabilities\n\n---\n\n*Generated on: 2025-09-23*\n*User Interaction Guide Version: 1.0*";

        // Configure marked
        marked.setOptions({
            highlight: function(code, lang) {
                return code;
            },
            breaks: true,
            gfm: true
        });

        // Render markdown
        const contentDiv = document.getElementById('markdown-content');
        contentDiv.innerHTML = marked.parse(markdownContent);

        // Function to render Mermaid diagrams
        function renderMermaidDiagrams() {
            if (!window.mermaid) {
                console.log('Mermaid not loaded yet, waiting...');
                return;
            }

            // Find all code blocks with mermaid language
            const mermaidBlocks = contentDiv.querySelectorAll('pre code.language-mermaid, pre code[class*="mermaid"]');

            if (mermaidBlocks.length === 0) {
                console.log('No mermaid blocks found');
                return;
            }

            console.log('Found', mermaidBlocks.length, 'mermaid blocks');

            mermaidBlocks.forEach((block, index) => {
                const mermaidCode = block.textContent;
                const pre = block.parentElement;

                // Create a div for mermaid diagram
                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.textContent = mermaidCode;
                mermaidDiv.id = 'mermaid-diagram-' + index;

                // Replace the pre block with mermaid div
                pre.replaceWith(mermaidDiv);
            });

            // Run mermaid rendering
            window.mermaid.run({
                querySelector: '.mermaid'
            }).then(() => {
                console.log('Mermaid diagrams rendered successfully');
            }).catch(err => {
                console.error('Mermaid rendering error:', err);
            });
        }

        // Wait for mermaid to load before rendering
        if (window.mermaidReady) {
            renderMermaidDiagrams();
        } else {
            window.addEventListener('mermaidLoaded', renderMermaidDiagrams);
            // Fallback timeout
            setTimeout(renderMermaidDiagrams, 1000);
        }

        // Generate TOC from headings
        const tocList = document.getElementById('toc-list');
        const headings = contentDiv.querySelectorAll('h2, h3, h4');

        headings.forEach((heading, index) => {
            const id = 'heading-' + index;
            heading.id = id;

            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + id;
            a.textContent = heading.textContent;
            a.className = 'toc-' + heading.tagName.toLowerCase();

            li.appendChild(a);
            tocList.appendChild(li);
        });

        // Highlight active TOC item on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.id;
                    tocList.querySelectorAll('a').forEach(a => {
                        a.style.color = a.getAttribute('href') === '#' + id ? 'var(--primary)' : 'var(--text-secondary)';
                        a.style.fontWeight = a.getAttribute('href') === '#' + id ? '600' : '400';
                    });
                }
            });
        }, { threshold: 1.0 });

        headings.forEach(heading => observer.observe(heading));
    </script>
</body>
</html>