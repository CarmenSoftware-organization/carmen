<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Management - Carmen ERP Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--bg-light);
            color: var(--text-primary);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: var(--bg-white);
            border-right: 1px solid var(--border);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            padding: 2rem 0;
        }

        .sidebar-header {
            padding: 0 1.5rem;
            margin-bottom: 2rem;
        }

        .sidebar-header h1 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .back-link:hover {
            color: var(--primary);
        }

        .sidebar nav {
            padding: 0 1rem;
        }

        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-section h3 {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            padding: 0 0.5rem;
            margin-bottom: 0.5rem;
        }

        .nav-section ul {
            list-style: none;
        }

        .nav-section a {
            display: block;
            padding: 0.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .nav-section a:hover,
        .nav-section a.active {
            background: var(--bg-light);
            color: var(--primary);
        }

        .main-content {
            margin-left: 280px;
            flex: 1;
            padding: 2rem;
            max-width: calc(100% - 280px);
        }

        .breadcrumb {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .breadcrumb a {
            color: var(--primary);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .content-wrapper {
            display: flex;
            gap: 2rem;
        }

        .document-content {
            flex: 1;
            background: var(--bg-white);
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
            min-width: 0;
        }

        .toc-sidebar {
            width: 250px;
            flex-shrink: 0;
        }

        .toc-sticky {
            position: sticky;
            top: 2rem;
            background: var(--bg-white);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
        }

        .toc-title {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .toc-list {
            list-style: none;
        }

        .toc-list a {
            display: block;
            padding: 0.25rem 0;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            transition: color 0.2s;
        }

        .toc-list a:hover {
            color: var(--primary);
        }

        .toc-list .toc-h2 {
            margin-left: 0;
            font-weight: 500;
        }

        .toc-list .toc-h3 {
            margin-left: 1rem;
            font-size: 0.8125rem;
        }

        .toc-list .toc-h4 {
            margin-left: 2rem;
            font-size: 0.75rem;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        h2 {
            font-size: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
            color: var(--text-primary);
        }

        h3 {
            font-size: 1.25rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        h4 {
            font-size: 1.125rem;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        p {
            margin-bottom: 1rem;
        }

        ul, ol {
            margin-bottom: 1rem;
            padding-left: 2rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        code {
            background: var(--bg-light);
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.875rem;
        }

        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        pre code {
            background: transparent;
            padding: 0;
            color: inherit;
        }

        blockquote {
            border-left: 4px solid var(--primary);
            padding-left: 1rem;
            margin: 1rem 0;
            color: var(--text-secondary);
            font-style: italic;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
        }

        th, td {
            border: 1px solid var(--border);
            padding: 0.75rem;
            text-align: left;
        }

        th {
            background: var(--bg-light);
            font-weight: 600;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 2rem 0;
        }

        img {
            max-width: 600px;
            height: auto;
            border-radius: 0.5rem;
            border: 1px solid var(--border);
            margin: 1rem 0;
            display: block;
        }

        .mermaid {
            background: var(--bg-white);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1.5rem 0;
            display: flex;
            justify-content: center;
            border: 1px solid var(--border);
            max-width: 800px;
            overflow-x: auto;
        }

        .mermaid svg {
            max-width: 100%;
            max-height: 500px;
            height: auto;
            transform: scale(0.85);
            transform-origin: top center;
        }

        @media (max-width: 1024px) {
            .sidebar {
                display: none;
            }

            .main-content {
                margin-left: 0;
                max-width: 100%;
            }

            .toc-sidebar {
                display: none;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';

        // Initialize Mermaid with enhanced configuration
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            themeVariables: {
                primaryColor: '#2563eb',
                primaryTextColor: '#0f172a',
                primaryBorderColor: '#1e40af',
                lineColor: '#64748b',
                secondaryColor: '#10b981',
                tertiaryColor: '#f59e0b',
                background: '#ffffff',
                mainBkg: '#f8fafc',
                secondBkg: '#e2e8f0',
                border1: '#cbd5e1',
                border2: '#94a3b8'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true,
                wrap: true
            },
            gantt: {
                useMaxWidth: true
            }
        });

        // Expose mermaid globally and signal it's ready
        window.mermaid = mermaid;
        window.mermaidReady = true;

        // Dispatch event when mermaid is ready
        window.dispatchEvent(new Event('mermaidLoaded'));
    </script>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="../../../index.html" class="back-link">← All Modules</a>
            <h1>System Administration</h1>
        </div>

        <nav>
            <div class="nav-section">
                <h3>Navigation</h3>
                <ul>
                    <li><a href="../../../index.html">Module Overview</a></li>
                    <li><a href="../../../index.html#features">Features</a></li>
                </ul>
            </div>
        </nav>
    </aside>

    <div class="main-content">
        <div class="breadcrumb"><a href="../../../index.html">Documentation</a> / <a href="../../../index.html">SA</a> / Features / Location Management</div>

        <div class="content-wrapper">
            <div class="document-content" id="markdown-content"></div>

            <aside class="toc-sidebar">
                <div class="toc-sticky">
                    <div class="toc-title">On This Page</div>
                    <ul class="toc-list" id="toc-list"></ul>
                </div>
            </aside>
        </div>
    </div>

    <script>
        const markdownContent = "# Location Management\n\n> **Feature:** System Administration > Location Management\n> **Pages:** 4\n> **Status:** ✅ Production Ready\n\n---\n\n## Overview\n\nLocation Management provides centralized control over all physical business locations in the Carmen ERP system. This feature enables organizations to define, configure, and maintain locations including warehouses, restaurants, central kitchens, delivery points, and end-of-period (EOP) locations.\n\n### Key Features\n\n1. **Location CRUD** - Create, view, edit, and delete locations\n2. **Dual View Modes** - Toggle between table and card views\n3. **Advanced Filtering** - Filter by status, type, and search\n4. **Hierarchical Organization** - Support for location hierarchies\n5. **Configuration Management** - Manage location-specific settings\n6. **Status Tracking** - Active/inactive status management\n\n---\n\n## Page Structure\n\n### 1. Location List Page\n**Route:** `/system-administration/location-management`\n\n#### Features:\n- **Search Bar**: Search by name, code, or type\n- **Quick Filters**:\n  - Status (All, Active, Inactive)\n  - Type (All, Warehouse, Restaurant, Kitchen, etc.)\n- **View Toggle**: Switch between table and card views\n- **Create Button**: Add new location\n- **Print Button**: Generate location reports\n\n#### Table View Columns:\n- Code\n- Name\n- Type\n- EOP (End of Period)\n- Delivery Point\n- Status (badge)\n- Actions (View, Edit, Delete)\n\n#### Card View:\n- Location name and code\n- Status badge\n- Type and EOP information\n- Delivery point\n- Quick action buttons\n\n### 2. Create Location Page\n**Route:** `/system-administration/location-management/new`\n\n#### Form Sections:\n\n**Basic Information**\n- Location Code (required, unique)\n- Location Name (required)\n- Location Type (dropdown: Warehouse, Restaurant, Central Kitchen, Store, Delivery Point)\n- Status (Active/Inactive toggle)\n\n**Address Details**\n- Address Line 1\n- Address Line 2\n- City\n- State/Province\n- Postal Code\n- Country\n\n**Configuration**\n- Is EOP Location (End of Period)\n- Is Delivery Point\n- Parent Location (for hierarchical structure)\n- Default Department\n- Timezone\n\n**Contact Information**\n- Phone Number\n- Email\n- Manager Name\n- Emergency Contact\n\n**Advanced Settings**\n- Allow Inventory\n- Allow Transfers\n- Allow Purchases\n- Allow Production\n- Cost Center Code\n- Tax Identifier\n\n### 3. View Location Page\n**Route:** `/system-administration/location-management/[id]/view`\n\n#### Sections:\n\n**Location Header**\n- Location name and code\n- Status badge\n- Edit button\n\n**Details Cards**\n- Basic Information\n- Address\n- Contact Details\n- Configuration Settings\n\n**Statistics**\n- Active Users\n- Inventory Items\n- Pending Transfers\n- Monthly Transactions\n\n**Recent Activity**\n- Recent inventory movements\n- Recent transfers\n- Recent purchases\n- Recent production\n\n### 4. Edit Location Page\n**Route:** `/system-administration/location-management/[id]/edit`\n\nSame form as Create Location, pre-populated with existing data.\n\n---\n\n## Data Model\n\n```typescript\ninterface Location {\n  // Identity\n  id: string;\n  code: string;\n  name: string;\n  type: LocationType;\n\n  // Address\n  address: {\n    line1: string;\n    line2?: string;\n    city: string;\n    state: string;\n    postalCode: string;\n    country: string;\n  };\n\n  // Configuration\n  isEOP: boolean; // End of Period location\n  isDeliveryPoint: boolean;\n  parentLocationId?: string;\n  defaultDepartment?: string;\n  timezone: string;\n\n  // Contact\n  phone?: string;\n  email?: string;\n  manager?: string;\n  emergencyContact?: string;\n\n  // Permissions\n  allowInventory: boolean;\n  allowTransfers: boolean;\n  allowPurchases: boolean;\n  allowProduction: boolean;\n\n  // Financial\n  costCenter?: string;\n  taxId?: string;\n\n  // Status\n  isActive: boolean;\n\n  // Audit\n  createdBy: string;\n  createdAt: Date;\n  updatedBy: string;\n  updatedAt: Date;\n}\n\nenum LocationType {\n  WAREHOUSE = 'Warehouse',\n  RESTAURANT = 'Restaurant',\n  CENTRAL_KITCHEN = 'Central Kitchen',\n  STORE = 'Store',\n  DELIVERY_POINT = 'Delivery Point',\n  OFFICE = 'Office',\n  FRANCHISE = 'Franchise'\n}\n```\n\n---\n\n## API Endpoints\n\n```http\nGET /api/locations\nPOST /api/locations\nGET /api/locations/:id\nPUT /api/locations/:id\nDELETE /api/locations/:id\nGET /api/locations/:id/statistics\nGET /api/locations/:id/activity\n```\n\n---\n\n## Business Rules\n\n1. **Unique Code**: Location codes must be unique within organization\n2. **Active Location Required**: At least one active location required\n3. **Hierarchy Validation**: Parent location must exist and be active\n4. **Circular Prevention**: Cannot create circular parent-child relationships\n5. **Deletion Rules**: Cannot delete location with active inventory or pending transactions\n\n---\n\n## User Guide\n\n### Creating a Location\n\n1. Navigate to Location Management\n2. Click \"Create Location\"\n3. Fill required fields (code, name, type)\n4. Add address details\n5. Configure settings\n6. Save location\n\n### Editing a Location\n\n1. Find location in list\n2. Click Edit button\n3. Modify fields as needed\n4. Save changes\n\n---\n\n**Last Updated:** 2025-01-17\n**Version:** 1.0.0\n";

        // Configure marked
        marked.setOptions({
            highlight: function(code, lang) {
                return code;
            },
            breaks: true,
            gfm: true
        });

        // Render markdown
        const contentDiv = document.getElementById('markdown-content');
        contentDiv.innerHTML = marked.parse(markdownContent);

        // Function to render Mermaid diagrams
        function renderMermaidDiagrams() {
            if (!window.mermaid) {
                console.log('Mermaid not loaded yet, waiting...');
                return;
            }

            // Find all code blocks with mermaid language
            const mermaidBlocks = contentDiv.querySelectorAll('pre code.language-mermaid, pre code[class*="mermaid"]');

            if (mermaidBlocks.length === 0) {
                console.log('No mermaid blocks found');
                return;
            }

            console.log('Found', mermaidBlocks.length, 'mermaid blocks');

            mermaidBlocks.forEach((block, index) => {
                const mermaidCode = block.textContent;
                const pre = block.parentElement;

                // Create a div for mermaid diagram
                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.textContent = mermaidCode;
                mermaidDiv.id = 'mermaid-diagram-' + index;

                // Replace the pre block with mermaid div
                pre.replaceWith(mermaidDiv);
            });

            // Run mermaid rendering
            window.mermaid.run({
                querySelector: '.mermaid'
            }).then(() => {
                console.log('Mermaid diagrams rendered successfully');
            }).catch(err => {
                console.error('Mermaid rendering error:', err);
            });
        }

        // Wait for mermaid to load before rendering
        if (window.mermaidReady) {
            renderMermaidDiagrams();
        } else {
            window.addEventListener('mermaidLoaded', renderMermaidDiagrams);
            // Fallback timeout
            setTimeout(renderMermaidDiagrams, 1000);
        }

        // Generate TOC from headings
        const tocList = document.getElementById('toc-list');
        const headings = contentDiv.querySelectorAll('h2, h3, h4');

        headings.forEach((heading, index) => {
            const id = 'heading-' + index;
            heading.id = id;

            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + id;
            a.textContent = heading.textContent;
            a.className = 'toc-' + heading.tagName.toLowerCase();

            li.appendChild(a);
            tocList.appendChild(li);
        });

        // Highlight active TOC item on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.id;
                    tocList.querySelectorAll('a').forEach(a => {
                        a.style.color = a.getAttribute('href') === '#' + id ? 'var(--primary)' : 'var(--text-secondary)';
                        a.style.fontWeight = a.getAttribute('href') === '#' + id ? '600' : '400';
                    });
                }
            });
        }, { threshold: 1.0 });

        headings.forEach(heading => observer.observe(heading));
    </script>
</body>
</html>