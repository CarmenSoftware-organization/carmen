<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Permission Management - Carmen ERP Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--bg-light);
            color: var(--text-primary);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: var(--bg-white);
            border-right: 1px solid var(--border);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            padding: 2rem 0;
        }

        .sidebar-header {
            padding: 0 1.5rem;
            margin-bottom: 2rem;
        }

        .sidebar-header h1 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .back-link:hover {
            color: var(--primary);
        }

        .sidebar nav {
            padding: 0 1rem;
        }

        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-section h3 {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            padding: 0 0.5rem;
            margin-bottom: 0.5rem;
        }

        .nav-section ul {
            list-style: none;
        }

        .nav-section a {
            display: block;
            padding: 0.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .nav-section a:hover,
        .nav-section a.active {
            background: var(--bg-light);
            color: var(--primary);
        }

        .main-content {
            margin-left: 280px;
            flex: 1;
            padding: 2rem;
            max-width: calc(100% - 280px);
        }

        .breadcrumb {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .breadcrumb a {
            color: var(--primary);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .content-wrapper {
            display: flex;
            gap: 2rem;
        }

        .document-content {
            flex: 1;
            background: var(--bg-white);
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
            min-width: 0;
        }

        .toc-sidebar {
            width: 250px;
            flex-shrink: 0;
        }

        .toc-sticky {
            position: sticky;
            top: 2rem;
            background: var(--bg-white);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
        }

        .toc-title {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .toc-list {
            list-style: none;
        }

        .toc-list a {
            display: block;
            padding: 0.25rem 0;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            transition: color 0.2s;
        }

        .toc-list a:hover {
            color: var(--primary);
        }

        .toc-list .toc-h2 {
            margin-left: 0;
            font-weight: 500;
        }

        .toc-list .toc-h3 {
            margin-left: 1rem;
            font-size: 0.8125rem;
        }

        .toc-list .toc-h4 {
            margin-left: 2rem;
            font-size: 0.75rem;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        h2 {
            font-size: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
            color: var(--text-primary);
        }

        h3 {
            font-size: 1.25rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        h4 {
            font-size: 1.125rem;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        p {
            margin-bottom: 1rem;
        }

        ul, ol {
            margin-bottom: 1rem;
            padding-left: 2rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        code {
            background: var(--bg-light);
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.875rem;
        }

        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        pre code {
            background: transparent;
            padding: 0;
            color: inherit;
        }

        blockquote {
            border-left: 4px solid var(--primary);
            padding-left: 1rem;
            margin: 1rem 0;
            color: var(--text-secondary);
            font-style: italic;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
        }

        th, td {
            border: 1px solid var(--border);
            padding: 0.75rem;
            text-align: left;
        }

        th {
            background: var(--bg-light);
            font-weight: 600;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 2rem 0;
        }

        img {
            max-width: 600px;
            height: auto;
            border-radius: 0.5rem;
            border: 1px solid var(--border);
            margin: 1rem 0;
            display: block;
        }

        .mermaid {
            background: var(--bg-white);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1.5rem 0;
            display: flex;
            justify-content: center;
            border: 1px solid var(--border);
            max-width: 800px;
            overflow-x: auto;
        }

        .mermaid svg {
            max-width: 100%;
            max-height: 500px;
            height: auto;
            transform: scale(0.85);
            transform-origin: top center;
        }

        @media (max-width: 1024px) {
            .sidebar {
                display: none;
            }

            .main-content {
                margin-left: 0;
                max-width: 100%;
            }

            .toc-sidebar {
                display: none;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';

        // Initialize Mermaid with enhanced configuration
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            themeVariables: {
                primaryColor: '#2563eb',
                primaryTextColor: '#0f172a',
                primaryBorderColor: '#1e40af',
                lineColor: '#64748b',
                secondaryColor: '#10b981',
                tertiaryColor: '#f59e0b',
                background: '#ffffff',
                mainBkg: '#f8fafc',
                secondBkg: '#e2e8f0',
                border1: '#cbd5e1',
                border2: '#94a3b8'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true,
                wrap: true
            },
            gantt: {
                useMaxWidth: true
            }
        });

        // Expose mermaid globally and signal it's ready
        window.mermaid = mermaid;
        window.mermaidReady = true;

        // Dispatch event when mermaid is ready
        window.dispatchEvent(new Event('mermaidLoaded'));
    </script>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="../../../index.html" class="back-link">‚Üê All Modules</a>
            <h1>System Administration</h1>
        </div>

        <nav>
            <div class="nav-section">
                <h3>Navigation</h3>
                <ul>
                    <li><a href="../../../index.html">Module Overview</a></li>
                    <li><a href="../../../index.html#features">Features</a></li>
                </ul>
            </div>
        </nav>
    </aside>

    <div class="main-content">
        <div class="breadcrumb"><a href="../../../index.html">Documentation</a> / <a href="../../../index.html">SA</a> / Features / Permission Management</div>

        <div class="content-wrapper">
            <div class="document-content" id="markdown-content"></div>

            <aside class="toc-sidebar">
                <div class="toc-sticky">
                    <div class="toc-title">On This Page</div>
                    <ul class="toc-list" id="toc-list"></ul>
                </div>
            </aside>
        </div>
    </div>

    <script>
        const markdownContent = "# Permission Management\n\n> **Status:** ‚úÖ Production Ready\n> **Module:** System Administration\n> **Pages:** 12\n> **Last Updated:** 2025-01-17\n\n---\n\n## Overview\n\nThe Permission Management feature provides a comprehensive access control system for Carmen ERP using a hybrid approach combining **Role-Based Access Control (RBAC)** and **Attribute-Based Access Control (ABAC)**. This dual-strategy system offers both simplicity and granular control for managing user permissions across all ERP modules.\n\n### Key Capabilities\n\n1. **Advanced Policy Management** - Create fine-grained access policies using ABAC\n2. **Role Management** - Define and manage user roles with hierarchical structures\n3. **Subscription Management** - Control feature access through subscription tiers\n4. **Visual Policy Builder** - User-friendly wizard for creating complex policies\n5. **Real-time Enforcement** - Immediate policy evaluation and access control\n6. **Audit Trail** - Comprehensive logging of all permission changes\n\n### Who Uses This Feature\n\n- **System Administrators**: Configure and manage the entire permission system\n- **Security Officers**: Define security policies and monitor access\n- **Department Managers**: Manage roles and permissions within their departments\n- **Compliance Officers**: Monitor and enforce access control policies\n\n---\n\n## Feature Architecture\n\n### System Components\n\n```\nPermission Management\n‚îú‚îÄ‚îÄ Policies (ABAC)\n‚îÇ   ‚îú‚îÄ‚îÄ Policy List\n‚îÇ   ‚îú‚îÄ‚îÄ Policy Builder (Visual Wizard)\n‚îÇ   ‚îú‚îÄ‚îÄ Policy Editor (Advanced)\n‚îÇ   ‚îú‚îÄ‚îÄ Policy Testing\n‚îÇ   ‚îî‚îÄ‚îÄ Simple Policy Creator\n‚îú‚îÄ‚îÄ Roles (RBAC)\n‚îÇ   ‚îú‚îÄ‚îÄ Role List\n‚îÇ   ‚îú‚îÄ‚îÄ Role Form (Create/Edit)\n‚îÇ   ‚îú‚îÄ‚îÄ Role Detail View\n‚îÇ   ‚îî‚îÄ‚îÄ User Assignment\n‚îî‚îÄ‚îÄ Subscriptions\n    ‚îú‚îÄ‚îÄ Package Selection\n    ‚îú‚îÄ‚îÄ Resource Activation\n    ‚îú‚îÄ‚îÄ Billing & Payment\n    ‚îî‚îÄ‚îÄ Usage Analytics\n```\n\n### Navigation Hierarchy\n\n**Main Route:** `/system-administration/permission-management`\n\n#### Sub-Routes:\n- **Policies**: `/permission-management/policies`\n  - List View: `/policies`\n  - Simple Creator: `/policies/simple`\n  - Advanced Builder: `/policies/builder`\n  - Policy Demo: `/policies/demo`\n  - Policy Detail: `/policies/[id]`\n  - Policy Edit: `/policies/[id]/edit`\n\n- **Roles**: `/permission-management/roles`\n  - List View: `/roles`\n  - Create Role: `/roles/new`\n  - Role Detail: `/roles/[id]`\n  - Role Edit: `/roles/edit/[id]`\n\n- **Subscriptions**: `/permission-management/subscription`\n  - Package View: `/subscription` (default)\n  - Multiple Subscriptions: `/subscriptions`\n\n---\n\n## Core Functionality\n\n### 1. Policy Management (ABAC)\n\n**Purpose**: Fine-grained access control using attributes and conditions\n\n#### Features:\n- **Visual Policy Builder**: Step-by-step wizard for creating complex policies\n- **Policy Types**: Support for both RBAC-based and attribute-based policies\n- **Priority System**: Policies evaluated based on configurable priority levels (0-1000)\n- **Effect Types**: `Permit`, `Deny`, `Conditional Permit`\n- **Resource Targeting**: Policies can target specific resources, actions, and conditions\n- **Advanced Filters**: Filter by effect, status, resource type, priority, and date range\n\n#### Policy Components:\n```typescript\ninterface Policy {\n  id: string;\n  name: string;\n  description: string;\n  effect: 'permit' | 'deny';\n  enabled: boolean;\n  priority: number;\n  resources: ResourceSelector[];\n  actions: string[];\n  conditions?: PolicyCondition[];\n  createdAt: Date;\n  updatedAt: Date;\n}\n```\n\n#### User Workflows:\n1. **Create Policy**: Policies ‚Üí New Policy ‚Üí Policy Builder Wizard ‚Üí Review ‚Üí Save\n2. **Edit Policy**: Policies ‚Üí Select Policy ‚Üí Edit ‚Üí Modify ‚Üí Save\n3. **Test Policy**: Policies ‚Üí Select Policy ‚Üí Test ‚Üí Enter Test Parameters ‚Üí View Results\n4. **Clone Policy**: Policies ‚Üí Select Policy ‚Üí Clone ‚Üí Modify ‚Üí Save\n5. **Toggle Status**: Policies ‚Üí Select Policy ‚Üí Enable/Disable\n\n### 2. Role Management (RBAC)\n\n**Purpose**: Organize permissions into reusable role templates\n\n#### Features:\n- **Hierarchical Roles**: Parent-child role relationships with permission inheritance\n- **Permission Assignment**: Attach multiple permissions to a single role\n- **User Assignment**: Assign roles to users individually or in bulk\n- **Role Templates**: Pre-defined role templates for common positions\n- **Bulk Operations**: Export, import, and bulk delete roles\n- **View Modes**: Toggle between table and card views\n\n#### Role Components:\n```typescript\ninterface Role {\n  id: string;\n  name: string;\n  description: string;\n  hierarchy: number;\n  permissions: string[];\n  parentRoles?: string[];\n  isSystemRole: boolean;\n  userCount: number;\n  createdAt: Date;\n  updatedAt: Date;\n}\n```\n\n#### User Workflows:\n1. **Create Role**: Roles ‚Üí Create Role ‚Üí Fill Form ‚Üí Add Permissions ‚Üí Save\n2. **Edit Role**: Roles ‚Üí Select Role ‚Üí Edit ‚Üí Modify ‚Üí Save\n3. **View Role**: Roles ‚Üí Select Role ‚Üí View Details\n4. **Assign Users**: Roles ‚Üí Select Role ‚Üí Assign Users ‚Üí Select Users ‚Üí Save\n5. **Duplicate Role**: Roles ‚Üí Select Role ‚Üí Duplicate ‚Üí Modify ‚Üí Save\n\n### 3. Subscription Management\n\n**Purpose**: Control feature access based on subscription tiers\n\n#### Features:\n- **Package Selector**: Browse and compare subscription packages\n- **Resource Activation**: Enable/disable specific features within subscription limits\n- **Billing Management**: Manage payment methods and billing information\n- **Usage Analytics**: Monitor resource usage and quota consumption\n- **Package Comparison**: Side-by-side comparison of subscription tiers\n\n#### Subscription Components:\n```typescript\ninterface Subscription {\n  id: string;\n  packageType: 'starter' | 'professional' | 'enterprise';\n  status: 'active' | 'suspended' | 'cancelled';\n  billingCycle: 'monthly' | 'annual';\n  resources: ResourceLimits;\n  usage: ResourceUsage;\n  billingInfo: BillingInformation;\n  startDate: Date;\n  renewalDate: Date;\n}\n```\n\n#### User Workflows:\n1. **Select Package**: Subscription ‚Üí Packages ‚Üí Compare ‚Üí Select ‚Üí Confirm\n2. **Manage Resources**: Subscription ‚Üí Resources ‚Üí Toggle Features ‚Üí Set Limits ‚Üí Save\n3. **Update Billing**: Subscription ‚Üí Billing ‚Üí Update Payment Method ‚Üí Save\n4. **View Analytics**: Subscription ‚Üí Analytics ‚Üí Select Date Range ‚Üí Export Data\n\n---\n\n## User Interface\n\n### Main Landing Page\n\n**Route:** `/system-administration/permission-management`\n\n#### Components:\n- **Page Header**: Title, description, and icon\n- **Tab Navigation**: Three main tabs (Policies, Roles, Subscription)\n- **Tab Content**: Dynamic content based on active tab\n\n#### Layout:\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ üõ°Ô∏è Permission Management                            ‚îÇ\n‚îÇ Comprehensive access control system...              ‚îÇ\n‚îÇ                                                     ‚îÇ\n‚îÇ [Policies] [Roles] [Subscription]                  ‚îÇ\n‚îÇ                                                     ‚îÇ\n‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ\n‚îÇ ‚îÇ                                             ‚îÇ   ‚îÇ\n‚îÇ ‚îÇ         Active Tab Content                  ‚îÇ   ‚îÇ\n‚îÇ ‚îÇ                                             ‚îÇ   ‚îÇ\n‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n### Policy Management View\n\n#### Features:\n- **Search & Filter Bar**: Quick search with advanced filtering\n- **Policy Type Toggle**: Switch between RBAC and ABAC policies\n- **Action Buttons**: New Policy (Simple/Advanced), Filters\n- **Policy List**: Table view with columns for name, effect, status, priority\n- **Policy Cards**: Visual cards with key information and quick actions\n\n#### Actions:\n- View Policy Details\n- Edit Policy\n- Test Policy\n- Clone Policy\n- Toggle Enable/Disable\n- Delete Policy\n\n### Role Management View\n\n#### Features:\n- **View Mode Toggle**: Switch between table and card views\n- **Search & Sort**: Search roles by name, sort by hierarchy\n- **Action Buttons**: Create Role, Settings\n- **Role List/Cards**: Display roles with key metrics\n- **Quick Actions**: View, Edit, Assign Users, Duplicate, Delete\n\n#### Data Display:\n- Role Name & Description\n- Hierarchy Level\n- Permission Count\n- User Count\n- Creation Date\n- Status Badge\n\n### Subscription Management View\n\n#### Tabs:\n1. **Packages**: Compare and select subscription packages\n2. **Resources**: Activate/deactivate features and set limits\n3. **Billing**: Manage payment methods and view invoices\n4. **Analytics**: View usage statistics and trends\n\n#### Features:\n- Package Comparison Cards\n- Resource Toggle Switches\n- Usage Progress Bars\n- Billing Information Forms\n- Usage Charts & Graphs\n\n---\n\n## Technical Details\n\n### Components Used\n\n#### UI Components:\n- `Card`, `CardHeader`, `CardTitle`, `CardDescription`, `CardContent`\n- `Button`, `Badge`, `Tabs`, `TabsList`, `TabsTrigger`, `TabsContent`\n- `Dialog`, `DialogContent`, `Sheet`, `SheetContent`\n- `Table`, `TableHeader`, `TableBody`, `TableRow`, `TableCell`\n- `Form`, `FormField`, `FormItem`, `FormLabel`, `FormControl`\n- `Input`, `Textarea`, `Select`, `Checkbox`, `Switch`\n\n#### Custom Components:\n- `PolicyList` - Displays list of policies with filtering\n- `PolicyFiltersComponent` - Advanced filtering interface\n- `PolicyBuilderWizard` - Visual policy creation wizard\n- `RoleList` - Displays role list/cards with actions\n- `RoleForm` - Create/edit role form with validation\n- `RoleDataTable` - Table view for roles\n- `RoleCardView` - Card view for roles\n- `PackageSelector` - Subscription package selection\n- `ResourceActivation` - Feature activation interface\n- `BillingPaymentInfo` - Billing management\n- `UsageAnalytics` - Usage statistics and charts\n\n### State Management\n\n#### Zustand Stores:\n- `useRoleStore`: Manages role data and operations\n  - `roles`: Array of roles\n  - `addRole(data)`: Create new role\n  - `updateRole(id, data)`: Update existing role\n  - `getRole(id)`: Retrieve role by ID\n  - `deleteRole(id)`: Delete role\n\n#### Local State:\n- `useState` for component-level state\n- View mode toggles (table/card)\n- Dialog open/close states\n- Filter states\n- Selected items\n\n### Data Models\n\n#### Policy Type:\n```typescript\ninterface Policy {\n  id: string;\n  name: string;\n  description: string;\n  effect: 'permit' | 'deny';\n  enabled: boolean;\n  priority: number;\n  resources: ResourceSelector[];\n  actions: string[];\n  conditions?: PolicyCondition[];\n  createdAt: Date;\n  updatedAt: Date;\n}\n```\n\n#### Role Type:\n```typescript\ninterface Role {\n  id: string;\n  name: string;\n  description: string;\n  hierarchy: number;\n  permissions: string[];\n  parentRoles?: string[];\n  isSystemRole: boolean;\n  userCount: number;\n  createdAt: Date;\n  updatedAt: Date;\n}\n```\n\n#### Subscription Type:\n```typescript\ninterface Subscription {\n  id: string;\n  packageType: 'starter' | 'professional' | 'enterprise';\n  status: 'active' | 'suspended' | 'cancelled';\n  billingCycle: 'monthly' | 'annual';\n  resources: ResourceLimits;\n  usage: ResourceUsage;\n  billingInfo: BillingInformation;\n  startDate: Date;\n  renewalDate: Date;\n}\n```\n\n### API Endpoints\n\n#### Policies:\n- `GET /api/policies` - List all policies\n- `POST /api/policies` - Create new policy\n- `GET /api/policies/:id` - Get policy details\n- `PUT /api/policies/:id` - Update policy\n- `DELETE /api/policies/:id` - Delete policy\n- `POST /api/policies/:id/test` - Test policy evaluation\n\n#### Roles:\n- `GET /api/roles` - List all roles\n- `POST /api/roles` - Create new role\n- `GET /api/roles/:id` - Get role details\n- `PUT /api/roles/:id` - Update role\n- `DELETE /api/roles/:id` - Delete role\n- `POST /api/roles/:id/assign` - Assign users to role\n\n#### Subscriptions:\n- `GET /api/subscriptions` - Get subscription details\n- `PUT /api/subscriptions/package` - Update package\n- `POST /api/subscriptions/resources` - Toggle resource\n- `PUT /api/subscriptions/billing` - Update billing info\n\n---\n\n## Business Rules\n\n### Policy Evaluation\n\n1. **Priority-Based Evaluation**: Policies evaluated in order of priority (highest first)\n2. **Default Deny**: If no policy matches, access is denied by default\n3. **Explicit Deny Wins**: Deny policies override permit policies of equal priority\n4. **Condition Evaluation**: All conditions must be true for policy to apply\n5. **Resource Matching**: Supports wildcards and pattern matching for resource targeting\n\n### Role Hierarchy\n\n1. **Inheritance**: Child roles inherit all permissions from parent roles\n2. **Hierarchy Levels**: Higher hierarchy can manage lower hierarchy roles\n3. **System Roles**: Cannot be deleted or modified (read-only)\n4. **Permission Aggregation**: Users receive combined permissions from all assigned roles\n\n### Subscription Limits\n\n1. **Feature Gating**: Features disabled when subscription limits exceeded\n2. **Soft Limits**: Warning notifications when approaching limits\n3. **Hard Limits**: Features automatically disabled when limits reached\n4. **Grace Period**: 7-day grace period for billing failures before suspension\n\n---\n\n## Security Considerations\n\n### Authentication & Authorization\n\n- All permission management operations require `manage_permissions` permission\n- Policy testing requires `test_policies` permission\n- Role assignment requires `assign_roles` permission\n- Subscription management requires `manage_subscriptions` permission\n\n### Audit Logging\n\nAll permission changes are logged with:\n- User who made the change\n- Timestamp of change\n- Old value vs. new value\n- Reason for change (optional)\n- IP address of requester\n\n### Data Validation\n\n- Policy names must be unique\n- Role hierarchy must not create circular dependencies\n- Permission strings must match defined resource patterns\n- Subscription changes validated against billing status\n\n---\n\n## User Guide\n\n### Creating a Policy\n\n**Step 1**: Navigate to Permission Management ‚Üí Policies\n\n**Step 2**: Click \"New Policy\" ‚Üí Select creation method:\n- **Simple Creator**: For basic allow/deny rules\n- **Advanced Builder**: For complex attribute-based policies\n\n**Step 3**: Fill in policy details:\n- Name (required)\n- Description (optional)\n- Effect (Permit/Deny)\n- Priority (0-1000)\n\n**Step 4**: Define resource targeting:\n- Select resource types\n- Specify resource IDs or patterns\n- Add conditions (optional)\n\n**Step 5**: Review and save\n\n### Managing Roles\n\n**Creating a Role**:\n1. Navigate to Roles ‚Üí Create Role\n2. Enter role name and description\n3. Set hierarchy level\n4. Select permissions from list\n5. Choose parent roles (optional)\n6. Save role\n\n**Assigning Users**:\n1. Navigate to Roles\n2. Select role ‚Üí Assign Users\n3. Search and select users\n4. Confirm assignment\n\n### Managing Subscriptions\n\n**Upgrading Package**:\n1. Navigate to Subscription ‚Üí Packages\n2. Compare available packages\n3. Select desired package\n4. Review changes and costs\n5. Confirm upgrade\n\n**Managing Resources**:\n1. Navigate to Subscription ‚Üí Resources\n2. Toggle features on/off\n3. Adjust resource limits\n4. Save changes\n\n---\n\n## Screenshots\n\nSee [screenshots directory](./screenshots/) for visual examples of:\n- Permission Management dashboard\n- Policy list view\n- Policy builder wizard\n- Role management interface\n- Subscription package comparison\n- Usage analytics dashboard\n\n---\n\n## Related Documentation\n\n- [Roles Management](./sub-features/roles/README.md) - Detailed role management guide\n- [Policies Management](./sub-features/policies/README.md) - ABAC policy creation guide\n- [Subscriptions Management](./sub-features/subscriptions/README.md) - Subscription management guide\n- [Permission Management API](../../api/permission-api.md) - API reference\n- [Security Best Practices](../../technical/security.md) - Security guidelines\n\n---\n\n## Troubleshooting\n\n### Common Issues\n\n**Issue**: Policy not applying\n- **Solution**: Check policy priority and ensure it's enabled\n- **Check**: Verify conditions are being met\n- **Test**: Use policy testing feature to simulate evaluation\n\n**Issue**: Role permissions not taking effect\n- **Solution**: Clear user session and re-login\n- **Check**: Verify role is assigned to user\n- **Test**: Check role hierarchy for conflicts\n\n**Issue**: Subscription features not activating\n- **Solution**: Verify billing status is active\n- **Check**: Ensure subscription renewal date is valid\n- **Test**: Check usage limits haven't been exceeded\n\n---\n\n**Last Updated:** 2025-01-17\n**Version:** 1.0.0\n**Status:** Production Ready\n";

        // Configure marked
        marked.setOptions({
            highlight: function(code, lang) {
                return code;
            },
            breaks: true,
            gfm: true
        });

        // Render markdown
        const contentDiv = document.getElementById('markdown-content');
        contentDiv.innerHTML = marked.parse(markdownContent);

        // Function to render Mermaid diagrams
        function renderMermaidDiagrams() {
            if (!window.mermaid) {
                console.log('Mermaid not loaded yet, waiting...');
                return;
            }

            // Find all code blocks with mermaid language
            const mermaidBlocks = contentDiv.querySelectorAll('pre code.language-mermaid, pre code[class*="mermaid"]');

            if (mermaidBlocks.length === 0) {
                console.log('No mermaid blocks found');
                return;
            }

            console.log('Found', mermaidBlocks.length, 'mermaid blocks');

            mermaidBlocks.forEach((block, index) => {
                const mermaidCode = block.textContent;
                const pre = block.parentElement;

                // Create a div for mermaid diagram
                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.textContent = mermaidCode;
                mermaidDiv.id = 'mermaid-diagram-' + index;

                // Replace the pre block with mermaid div
                pre.replaceWith(mermaidDiv);
            });

            // Run mermaid rendering
            window.mermaid.run({
                querySelector: '.mermaid'
            }).then(() => {
                console.log('Mermaid diagrams rendered successfully');
            }).catch(err => {
                console.error('Mermaid rendering error:', err);
            });
        }

        // Wait for mermaid to load before rendering
        if (window.mermaidReady) {
            renderMermaidDiagrams();
        } else {
            window.addEventListener('mermaidLoaded', renderMermaidDiagrams);
            // Fallback timeout
            setTimeout(renderMermaidDiagrams, 1000);
        }

        // Generate TOC from headings
        const tocList = document.getElementById('toc-list');
        const headings = contentDiv.querySelectorAll('h2, h3, h4');

        headings.forEach((heading, index) => {
            const id = 'heading-' + index;
            heading.id = id;

            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + id;
            a.textContent = heading.textContent;
            a.className = 'toc-' + heading.tagName.toLowerCase();

            li.appendChild(a);
            tocList.appendChild(li);
        });

        // Highlight active TOC item on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.id;
                    tocList.querySelectorAll('a').forEach(a => {
                        a.style.color = a.getAttribute('href') === '#' + id ? 'var(--primary)' : 'var(--text-secondary)';
                        a.style.fontWeight = a.getAttribute('href') === '#' + id ? '600' : '400';
                    });
                }
            });
        }, { threshold: 1.0 });

        headings.forEach(heading => observer.observe(heading));
    </script>
</body>
</html>