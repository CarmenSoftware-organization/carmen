<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goods Received Note Module - API Specification - Carmen ERP Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--bg-light);
            color: var(--text-primary);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: var(--bg-white);
            border-right: 1px solid var(--border);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            padding: 2rem 0;
        }

        .sidebar-header {
            padding: 0 1.5rem;
            margin-bottom: 2rem;
        }

        .sidebar-header h1 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .back-link:hover {
            color: var(--primary);
        }

        .sidebar nav {
            padding: 0 1rem;
        }

        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-section h3 {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            padding: 0 0.5rem;
            margin-bottom: 0.5rem;
        }

        .nav-section ul {
            list-style: none;
        }

        .nav-section a {
            display: block;
            padding: 0.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .nav-section a:hover,
        .nav-section a.active {
            background: var(--bg-light);
            color: var(--primary);
        }

        .main-content {
            margin-left: 280px;
            flex: 1;
            padding: 2rem;
            max-width: calc(100% - 280px);
        }

        .breadcrumb {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .breadcrumb a {
            color: var(--primary);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .content-wrapper {
            display: flex;
            gap: 2rem;
        }

        .document-content {
            flex: 1;
            background: var(--bg-white);
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
            min-width: 0;
        }

        .toc-sidebar {
            width: 250px;
            flex-shrink: 0;
        }

        .toc-sticky {
            position: sticky;
            top: 2rem;
            background: var(--bg-white);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
        }

        .toc-title {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .toc-list {
            list-style: none;
        }

        .toc-list a {
            display: block;
            padding: 0.25rem 0;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            transition: color 0.2s;
        }

        .toc-list a:hover {
            color: var(--primary);
        }

        .toc-list .toc-h2 {
            margin-left: 0;
            font-weight: 500;
        }

        .toc-list .toc-h3 {
            margin-left: 1rem;
            font-size: 0.8125rem;
        }

        .toc-list .toc-h4 {
            margin-left: 2rem;
            font-size: 0.75rem;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        h2 {
            font-size: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
            color: var(--text-primary);
        }

        h3 {
            font-size: 1.25rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        h4 {
            font-size: 1.125rem;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        p {
            margin-bottom: 1rem;
        }

        ul, ol {
            margin-bottom: 1rem;
            padding-left: 2rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        code {
            background: var(--bg-light);
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.875rem;
        }

        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        pre code {
            background: transparent;
            padding: 0;
            color: inherit;
        }

        blockquote {
            border-left: 4px solid var(--primary);
            padding-left: 1rem;
            margin: 1rem 0;
            color: var(--text-secondary);
            font-style: italic;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
        }

        th, td {
            border: 1px solid var(--border);
            padding: 0.75rem;
            text-align: left;
        }

        th {
            background: var(--bg-light);
            font-weight: 600;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 2rem 0;
        }

        img {
            max-width: 600px;
            height: auto;
            border-radius: 0.5rem;
            border: 1px solid var(--border);
            margin: 1rem 0;
            display: block;
        }

        .mermaid {
            background: var(--bg-white);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1.5rem 0;
            display: flex;
            justify-content: center;
            border: 1px solid var(--border);
            max-width: 800px;
            overflow-x: auto;
        }

        .mermaid svg {
            max-width: 100%;
            max-height: 500px;
            height: auto;
            transform: scale(0.85);
            transform-origin: top center;
        }

        @media (max-width: 1024px) {
            .sidebar {
                display: none;
            }

            .main-content {
                margin-left: 0;
                max-width: 100%;
            }

            .toc-sidebar {
                display: none;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';

        // Initialize Mermaid with enhanced configuration
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            themeVariables: {
                primaryColor: '#2563eb',
                primaryTextColor: '#0f172a',
                primaryBorderColor: '#1e40af',
                lineColor: '#64748b',
                secondaryColor: '#10b981',
                tertiaryColor: '#f59e0b',
                background: '#ffffff',
                mainBkg: '#f8fafc',
                secondBkg: '#e2e8f0',
                border1: '#cbd5e1',
                border2: '#94a3b8'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true,
                wrap: true
            },
            gantt: {
                useMaxWidth: true
            }
        });

        // Expose mermaid globally and signal it's ready
        window.mermaid = mermaid;
        window.mermaidReady = true;

        // Dispatch event when mermaid is ready
        window.dispatchEvent(new Event('mermaidLoaded'));
    </script>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="back-link">‚Üê All Modules</a>
            <h1>Goods Received Notes</h1>
        </div>

        <nav>
            <div class="nav-section">
                <h3>Navigation</h3>
                <ul>
                    <li><a href="../index.html">Module Overview</a></li>
                    <li><a href="../index.html#features">Features</a></li>
                </ul>
            </div>
        </nav>
    </aside>

    <div class="main-content">
        <div class="breadcrumb"><a href="../index.html">Documentation</a> / <a href="../index.html">GRN</a></div>

        <div class="content-wrapper">
            <div class="document-content" id="markdown-content"></div>

            <aside class="toc-sidebar">
                <div class="toc-sticky">
                    <div class="toc-title">On This Page</div>
                    <ul class="toc-list" id="toc-list"></ul>
                </div>
            </aside>
        </div>
    </div>

    <script>
        const markdownContent = "# Goods Received Note Module - API Specification\n\n## Table of Contents\n1. [Overview](#overview)\n2. [Authentication](#authentication)\n3. [Core Endpoints](#core-endpoints)\n4. [Data Models](#data-models)\n5. [Error Handling](#error-handling)\n6. [Rate Limiting](#rate-limiting)\n7. [Webhooks](#webhooks)\n\n## Overview\n\nThe Goods Received Note API provides comprehensive functionality for managing goods receipt within the Carmen Hospitality ERP system. This RESTful API supports the complete GRN lifecycle from creation to financial posting, with integration to Purchase Orders and inventory management.\n\n**Base URL:** `https://api.carmen-erp.com/v1`\n\n**API Version:** v1.0\n\n**Content Type:** `application/json`\n\n## Authentication\n\nAll API requests require authentication using JWT tokens.\n\n**Header:**\n```\nAuthorization: Bearer <jwt_token>\n```\n\n**Token Structure:**\n```json\n{\n  \"user_id\": \"12345\",\n  \"role\": \"warehouse_manager\",\n  \"permissions\": [\"grn:read\", \"grn:write\", \"grn:delete\"],\n  \"business_unit\": \"BU001\",\n  \"exp\": 1640995200\n}\n```\n\n## Core Endpoints\n\n### Goods Received Notes\n\n#### List Goods Received Notes\n```http\nGET /goods-received-notes\n```\n\n**Query Parameters:**\n- `page` (integer): Page number (default: 1)\n- `limit` (integer): Items per page (default: 50, max: 100)\n- `status` (string): Filter by status\n- `vendor_id` (integer): Filter by vendor\n- `start_date` (string): Filter from date (YYYY-MM-DD)\n- `end_date` (string): Filter to date (YYYY-MM-DD)\n- `currency` (string): Filter by currency code\n- `search` (string): Search in GRN ref, vendor name, invoice number\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"id\": \"grn-uuid-123\",\n      \"ref\": \"GRN-2023-001\",\n      \"vendor_id\": \"vendor-uuid-456\",\n      \"vendor_name\": \"Global Foods Inc.\",\n      \"date\": \"2023-06-15\",\n      \"invoice_number\": \"INV-789\",\n      \"invoice_date\": \"2023-06-14\",\n      \"status\": \"Received\",\n      \"currency\": \"USD\",\n      \"total_amount\": 1250.00,\n      \"item_count\": 5,\n      \"created_at\": \"2023-06-15T10:30:00Z\",\n      \"updated_at\": \"2023-06-15T15:45:00Z\"\n    }\n  ],\n  \"pagination\": {\n    \"current_page\": 1,\n    \"per_page\": 50,\n    \"total\": 150,\n    \"total_pages\": 3\n  }\n}\n```\n\n#### Get Goods Received Note\n```http\nGET /goods-received-notes/{grn_id}\n```\n\n**Response:**\n```json\n{\n  \"id\": \"grn-uuid-123\",\n  \"ref\": \"GRN-2023-001\",\n  \"vendor_id\": \"vendor-uuid-456\",\n  \"vendor\": {\n    \"id\": \"vendor-uuid-456\",\n    \"company_name\": \"Global Foods Inc.\",\n    \"business_registration_number\": \"BRN001\",\n    \"contact_email\": \"orders@globalfoods.com\"\n  },\n  \"receiver_id\": \"user-uuid-789\",\n  \"receiver_name\": \"John Warehouse\",\n  \"date\": \"2023-06-15\",\n  \"invoice_number\": \"INV-789\",\n  \"invoice_date\": \"2023-06-14\",\n  \"tax_invoice_number\": \"TAX-INV-789\",\n  \"tax_invoice_date\": \"2023-06-14\",\n  \"description\": \"Monthly food supplies delivery\",\n  \"currency\": \"USD\",\n  \"exchange_rate\": 1.0000,\n  \"base_currency\": \"USD\",\n  \"status\": \"Received\",\n  \"cash_book_id\": \"cb-uuid-101\",\n  \"is_consignment\": false,\n  \"is_cash\": false,\n  \"items\": [\n    {\n      \"id\": \"grn-item-uuid-001\",\n      \"product_id\": \"product-uuid-202\",\n      \"product_name\": \"Premium Rice 25kg\",\n      \"description\": \"Long grain premium rice\",\n      \"ordered_quantity\": 10.000,\n      \"received_quantity\": 10.000,\n      \"remaining_quantity\": 0.000,\n      \"order_unit\": \"bags\",\n      \"base_unit\": \"kg\",\n      \"conversion_factor\": 25.0000,\n      \"unit_price\": 45.50,\n      \"sub_total_price\": 455.00,\n      \"discount_rate\": 5.00,\n      \"discount_amount\": 22.75,\n      \"net_amount\": 432.25,\n      \"tax_rate\": 7.00,\n      \"tax_amount\": 30.26,\n      \"total_amount\": 462.51,\n      \"status\": \"FullyReceived\",\n      \"po_reference\": \"PO-2023-001\",\n      \"po_item_id\": \"po-item-uuid-303\"\n    }\n  ],\n  \"extra_costs\": [\n    {\n      \"id\": \"extra-cost-uuid-001\",\n      \"description\": \"Freight charges\",\n      \"amount\": 75.00,\n      \"currency\": \"USD\",\n      \"allocation_type\": \"even\",\n      \"allocation\": [\n        {\n          \"item_id\": \"grn-item-uuid-001\",\n          \"allocated_amount\": 15.00\n        }\n      ]\n    }\n  ],\n  \"financial_summary\": {\n    \"sub_total_price\": 1150.00,\n    \"discount_amount\": 57.50,\n    \"net_amount\": 1092.50,\n    \"tax_amount\": 76.48,\n    \"extra_costs_total\": 75.00,\n    \"total_amount\": 1243.98,\n    \"base_currency\": \"USD\",\n    \"base_total_amount\": 1243.98\n  },\n  \"stock_movements\": [\n    {\n      \"id\": \"movement-uuid-001\",\n      \"item_id\": \"grn-item-uuid-001\",\n      \"product_id\": \"product-uuid-202\",\n      \"movement_type\": \"IN\",\n      \"quantity\": 250.000,\n      \"to_location\": \"main-warehouse\",\n      \"unit_cost\": 1.73,\n      \"total_cost\": 432.25,\n      \"movement_date\": \"2023-06-15\",\n      \"status\": \"Processed\"\n    }\n  ],\n  \"activity_log\": [\n    {\n      \"id\": \"log-uuid-001\",\n      \"action\": \"Created\",\n      \"user_id\": \"user-uuid-789\",\n      \"user_name\": \"John Warehouse\",\n      \"activity_type\": \"Creation\",\n      \"description\": \"GRN created from PO-2023-001\",\n      \"timestamp\": \"2023-06-15T10:30:00Z\"\n    }\n  ]\n}\n```\n\n#### Create Goods Received Note\n```http\nPOST /goods-received-notes\n```\n\n**Request Body:**\n```json\n{\n  \"vendor_id\": \"vendor-uuid-456\",\n  \"receiver_id\": \"user-uuid-789\",\n  \"date\": \"2023-06-15\",\n  \"invoice_number\": \"INV-789\",\n  \"invoice_date\": \"2023-06-14\",\n  \"tax_invoice_number\": \"TAX-INV-789\",\n  \"tax_invoice_date\": \"2023-06-14\",\n  \"description\": \"Monthly food supplies delivery\",\n  \"currency\": \"USD\",\n  \"exchange_rate\": 1.0000,\n  \"cash_book_id\": \"cb-uuid-101\",\n  \"is_consignment\": false,\n  \"is_cash\": false,\n  \"source_po_ids\": [\"po-uuid-123\", \"po-uuid-124\"],\n  \"items\": [\n    {\n      \"product_id\": \"product-uuid-202\",\n      \"ordered_quantity\": 10.000,\n      \"received_quantity\": 10.000,\n      \"order_unit\": \"bags\",\n      \"unit_price\": 45.50,\n      \"discount_rate\": 5.00,\n      \"tax_rate\": 7.00,\n      \"po_item_id\": \"po-item-uuid-303\"\n    }\n  ],\n  \"extra_costs\": [\n    {\n      \"description\": \"Freight charges\",\n      \"amount\": 75.00,\n      \"currency\": \"USD\",\n      \"allocation_type\": \"even\"\n    }\n  ]\n}\n```\n\n**Response:**\n```json\n{\n  \"id\": \"grn-uuid-123\",\n  \"ref\": \"GRN-2023-001\",\n  \"status\": \"Draft\",\n  \"created_at\": \"2023-06-15T10:30:00Z\",\n  \"message\": \"Goods Received Note created successfully\"\n}\n```\n\n#### Update Goods Received Note\n```http\nPUT /goods-received-notes/{grn_id}\n```\n\n**Request Body:** (Same as create, with optional fields)\n\n**Response:**\n```json\n{\n  \"id\": \"grn-uuid-123\",\n  \"ref\": \"GRN-2023-001\",\n  \"updated_at\": \"2023-06-15T15:45:00Z\",\n  \"message\": \"Goods Received Note updated successfully\"\n}\n```\n\n#### Delete Goods Received Note\n```http\nDELETE /goods-received-notes/{grn_id}\n```\n\n**Response:**\n```json\n{\n  \"message\": \"Goods Received Note deleted successfully\",\n  \"deleted_at\": \"2023-06-15T16:00:00Z\"\n}\n```\n\n#### Update GRN Status\n```http\nPATCH /goods-received-notes/{grn_id}/status\n```\n\n**Request Body:**\n```json\n{\n  \"status\": \"Verified\",\n  \"reason\": \"Quality check completed, all items verified\"\n}\n```\n\n**Response:**\n```json\n{\n  \"id\": \"grn-uuid-123\",\n  \"ref\": \"GRN-2023-001\",\n  \"old_status\": \"Received\",\n  \"new_status\": \"Verified\",\n  \"updated_at\": \"2023-06-15T15:45:00Z\",\n  \"message\": \"Status updated successfully\"\n}\n```\n\n### GRN Items Management\n\n#### Add Item to GRN\n```http\nPOST /goods-received-notes/{grn_id}/items\n```\n\n**Request Body:**\n```json\n{\n  \"product_id\": \"product-uuid-203\",\n  \"ordered_quantity\": 5.000,\n  \"received_quantity\": 5.000,\n  \"order_unit\": \"boxes\",\n  \"unit_price\": 25.75,\n  \"discount_rate\": 0.00,\n  \"tax_rate\": 7.00\n}\n```\n\n#### Update GRN Item\n```http\nPUT /goods-received-notes/{grn_id}/items/{item_id}\n```\n\n**Request Body:**\n```json\n{\n  \"received_quantity\": 4.500,\n  \"unit_price\": 26.00,\n  \"discount_rate\": 2.50\n}\n```\n\n#### Delete GRN Item\n```http\nDELETE /goods-received-notes/{grn_id}/items/{item_id}\n```\n\n#### Bulk Item Operations\n```http\nPOST /goods-received-notes/{grn_id}/items/bulk\n```\n\n**Request Body:**\n```json\n{\n  \"action\": \"update_status\",\n  \"item_ids\": [\"item-uuid-001\", \"item-uuid-002\"],\n  \"data\": {\n    \"status\": \"FullyReceived\"\n  }\n}\n```\n\n### Extra Costs Management\n\n#### Add Extra Cost\n```http\nPOST /goods-received-notes/{grn_id}/extra-costs\n```\n\n**Request Body:**\n```json\n{\n  \"description\": \"Insurance charges\",\n  \"amount\": 50.00,\n  \"currency\": \"USD\",\n  \"allocation_type\": \"weighted\"\n}\n```\n\n#### Update Extra Cost\n```http\nPUT /goods-received-notes/{grn_id}/extra-costs/{cost_id}\n```\n\n#### Delete Extra Cost\n```http\nDELETE /goods-received-notes/{grn_id}/extra-costs/{cost_id}\n```\n\n### Document Operations\n\n#### Export GRN\n```http\nGET /goods-received-notes/{grn_id}/export\n```\n\n**Query Parameters:**\n- `format` (string): pdf|excel|csv\n- `sections` (array): header,items,financial,vendor,comments\n\n**Response:**\n```json\n{\n  \"download_url\": \"https://files.carmen-erp.com/exports/grn-2023-001.pdf\",\n  \"expires_at\": \"2023-06-15T18:00:00Z\"\n}\n```\n\n#### Print GRN\n```http\nPOST /goods-received-notes/{grn_id}/print\n```\n\n**Request Body:**\n```json\n{\n  \"template\": \"standard\",\n  \"copies\": 2,\n  \"include_items\": true,\n  \"include_financial\": true\n}\n```\n\n### Integration Endpoints\n\n#### Get Available Purchase Orders\n```http\nGET /goods-received-notes/available-pos\n```\n\n**Query Parameters:**\n- `vendor_id` (string): Filter POs by vendor\n\n**Response:**\n```json\n{\n  \"data\": [\n    {\n      \"po_id\": \"po-uuid-123\",\n      \"po_number\": \"PO-2023-001\",\n      \"vendor_name\": \"Global Foods Inc.\",\n      \"order_date\": \"2023-06-10\",\n      \"delivery_date\": \"2023-06-15\",\n      \"currency\": \"USD\",\n      \"total_amount\": 1250.00,\n      \"status\": \"Sent\",\n      \"items_count\": 5,\n      \"pending_receipt\": true\n    }\n  ]\n}\n```\n\n#### Process Stock Movements\n```http\nPOST /goods-received-notes/{grn_id}/stock-movements\n```\n\n**Request Body:**\n```json\n{\n  \"auto_process\": true,\n  \"target_location\": \"main-warehouse\",\n  \"movement_date\": \"2023-06-15\"\n}\n```\n\n#### Generate Financial Entries\n```http\nPOST /goods-received-notes/{grn_id}/financial-entries\n```\n\n**Request Body:**\n```json\n{\n  \"posting_date\": \"2023-06-15\",\n  \"cost_center\": \"kitchen-operations\",\n  \"auto_post\": false\n}\n```\n\n## Data Models\n\n### Goods Received Note\n```typescript\ninterface GoodsReceiveNote {\n  id: string\n  ref: string\n  vendor_id: string\n  vendor?: Vendor\n  receiver_id: string\n  receiver_name: string\n  date: string\n  invoice_number?: string\n  invoice_date?: string\n  tax_invoice_number?: string\n  tax_invoice_date?: string\n  description?: string\n  currency: string\n  exchange_rate: number\n  base_currency: string\n  status: GRNStatus\n  cash_book_id?: string\n  is_consignment: boolean\n  is_cash: boolean\n\n  // Financial totals\n  sub_total_price: number\n  discount_amount: number\n  net_amount: number\n  tax_amount: number\n  total_amount: number\n  base_total_amount: number\n\n  items: GRNItem[]\n  extra_costs: ExtraCost[]\n  stock_movements: StockMovement[]\n  activity_log: ActivityLogEntry[]\n\n  source_po_ids?: string[]\n  created_by: string\n  created_at: string\n  updated_at: string\n}\n```\n\n### GRN Item\n```typescript\ninterface GRNItem {\n  id: string\n  grn_id: string\n  product_id: string\n  product_name: string\n  description?: string\n  ordered_quantity: number\n  received_quantity: number\n  remaining_quantity: number\n  order_unit: string\n  base_unit: string\n  conversion_factor: number\n  unit_price: number\n  sub_total_price: number\n  discount_rate: number\n  discount_amount: number\n  net_amount: number\n  tax_rate: number\n  tax_amount: number\n  total_amount: number\n  status: ItemStatus\n  po_reference?: string\n  po_item_id?: string\n}\n```\n\n### Extra Cost\n```typescript\ninterface ExtraCost {\n  id: string\n  grn_id: string\n  description: string\n  amount: number\n  currency: string\n  allocation_type: 'even' | 'weighted' | 'manual'\n  allocation: ExtraCostAllocation[]\n}\n\ninterface ExtraCostAllocation {\n  item_id: string\n  allocated_amount: number\n  allocation_percentage: number\n}\n```\n\n### Stock Movement\n```typescript\ninterface StockMovement {\n  id: string\n  grn_id: string\n  item_id: string\n  product_id: string\n  movement_type: 'IN' | 'OUT' | 'TRANSFER'\n  quantity: number\n  from_location?: string\n  to_location: string\n  unit_cost: number\n  total_cost: number\n  movement_date: string\n  status: 'Pending' | 'Processed' | 'Cancelled'\n}\n```\n\n### Activity Log Entry\n```typescript\ninterface ActivityLogEntry {\n  id: string\n  grn_id: string\n  user_id: string\n  user_name: string\n  action: string\n  activity_type: ActivityType\n  description: string\n  timestamp: string\n  metadata?: object\n}\n```\n\n### Enums\n\n#### GRN Status\n```typescript\nenum GRNStatus {\n  Draft = \"Draft\",\n  Received = \"Received\",\n  Verified = \"Verified\",\n  Posted = \"Posted\",\n  Cancelled = \"Cancelled\"\n}\n```\n\n#### Item Status\n```typescript\nenum ItemStatus {\n  Open = \"Open\",\n  PartiallyReceived = \"PartiallyReceived\",\n  FullyReceived = \"FullyReceived\",\n  Cancelled = \"Cancelled\",\n  Closed = \"Closed\"\n}\n```\n\n#### Activity Type\n```typescript\nenum ActivityType {\n  Creation = \"Creation\",\n  StatusChange = \"StatusChange\",\n  ItemModification = \"ItemModification\",\n  DocumentGeneration = \"DocumentGeneration\",\n  Communication = \"Communication\",\n  SystemEvent = \"SystemEvent\"\n}\n```\n\n## Error Handling\n\n### Standard Error Response\n```json\n{\n  \"error\": {\n    \"code\": \"VALIDATION_ERROR\",\n    \"message\": \"Invalid request data\",\n    \"details\": [\n      {\n        \"field\": \"vendor_id\",\n        \"message\": \"Vendor ID is required\"\n      },\n      {\n        \"field\": \"date\",\n        \"message\": \"Date must be in YYYY-MM-DD format\"\n      }\n    ],\n    \"request_id\": \"req_123456789\"\n  }\n}\n```\n\n### Error Codes\n\n| Code | Status | Description |\n|------|--------|-------------|\n| VALIDATION_ERROR | 400 | Invalid request data |\n| UNAUTHORIZED | 401 | Invalid or missing authentication |\n| FORBIDDEN | 403 | Insufficient permissions |\n| NOT_FOUND | 404 | Resource not found |\n| CONFLICT | 409 | Resource conflict |\n| RATE_LIMITED | 429 | Too many requests |\n| INTERNAL_ERROR | 500 | Server error |\n\n### Business Logic Errors\n\n| Code | Description |\n|------|-------------|\n| GRN_ALREADY_POSTED | Cannot modify posted GRN |\n| INVALID_STATUS_TRANSITION | Invalid status change |\n| INSUFFICIENT_PERMISSIONS | User lacks required permissions |\n| VENDOR_INACTIVE | Selected vendor is inactive |\n| CURRENCY_MISMATCH | Currency doesn't match PO currency |\n| QUANTITY_EXCEEDED | Received quantity exceeds ordered |\n| PO_ALREADY_COMPLETED | Purchase order is already fully received |\n\n## Rate Limiting\n\n**Standard Limits:**\n- 1000 requests per hour per user\n- 100 requests per minute per user\n- 20 bulk operations per hour per user\n\n**Headers:**\n```\nX-RateLimit-Limit: 1000\nX-RateLimit-Remaining: 999\nX-RateLimit-Reset: 1640995200\n```\n\n## Webhooks\n\n### Available Events\n\n| Event | Description |\n|-------|-------------|\n| grn.created | GRN created |\n| grn.updated | GRN updated |\n| grn.status_changed | Status changed |\n| grn.item_added | Item added to GRN |\n| grn.item_updated | Item updated |\n| grn.received | Goods received |\n| grn.verified | Quality verification completed |\n| grn.posted | Financial posting completed |\n| grn.cancelled | GRN cancelled |\n\n### Webhook Payload\n```json\n{\n  \"event\": \"grn.status_changed\",\n  \"timestamp\": \"2023-06-15T15:45:00Z\",\n  \"data\": {\n    \"grn_id\": \"grn-uuid-123\",\n    \"ref\": \"GRN-2023-001\",\n    \"old_status\": \"Received\",\n    \"new_status\": \"Verified\",\n    \"user_id\": \"user-uuid-789\",\n    \"vendor_id\": \"vendor-uuid-456\"\n  }\n}\n```\n\n### Webhook Configuration\n```http\nPOST /webhooks\n```\n\n**Request Body:**\n```json\n{\n  \"url\": \"https://your-app.com/webhooks/grn\",\n  \"events\": [\"grn.created\", \"grn.status_changed\"],\n  \"secret\": \"your_webhook_secret\"\n}\n```\n\n---\n\n*API Documentation Version: 1.0*\n*Last Updated: Latest*";

        // Configure marked
        marked.setOptions({
            highlight: function(code, lang) {
                return code;
            },
            breaks: true,
            gfm: true
        });

        // Render markdown
        const contentDiv = document.getElementById('markdown-content');
        contentDiv.innerHTML = marked.parse(markdownContent);

        // Function to render Mermaid diagrams
        function renderMermaidDiagrams() {
            if (!window.mermaid) {
                console.log('Mermaid not loaded yet, waiting...');
                return;
            }

            // Find all code blocks with mermaid language
            const mermaidBlocks = contentDiv.querySelectorAll('pre code.language-mermaid, pre code[class*="mermaid"]');

            if (mermaidBlocks.length === 0) {
                console.log('No mermaid blocks found');
                return;
            }

            console.log('Found', mermaidBlocks.length, 'mermaid blocks');

            mermaidBlocks.forEach((block, index) => {
                const mermaidCode = block.textContent;
                const pre = block.parentElement;

                // Create a div for mermaid diagram
                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.textContent = mermaidCode;
                mermaidDiv.id = 'mermaid-diagram-' + index;

                // Replace the pre block with mermaid div
                pre.replaceWith(mermaidDiv);
            });

            // Run mermaid rendering
            window.mermaid.run({
                querySelector: '.mermaid'
            }).then(() => {
                console.log('Mermaid diagrams rendered successfully');
            }).catch(err => {
                console.error('Mermaid rendering error:', err);
            });
        }

        // Wait for mermaid to load before rendering
        if (window.mermaidReady) {
            renderMermaidDiagrams();
        } else {
            window.addEventListener('mermaidLoaded', renderMermaidDiagrams);
            // Fallback timeout
            setTimeout(renderMermaidDiagrams, 1000);
        }

        // Generate TOC from headings
        const tocList = document.getElementById('toc-list');
        const headings = contentDiv.querySelectorAll('h2, h3, h4');

        headings.forEach((heading, index) => {
            const id = 'heading-' + index;
            heading.id = id;

            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + id;
            a.textContent = heading.textContent;
            a.className = 'toc-' + heading.tagName.toLowerCase();

            li.appendChild(a);
            tocList.appendChild(li);
        });

        // Highlight active TOC item on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.id;
                    tocList.querySelectorAll('a').forEach(a => {
                        a.style.color = a.getAttribute('href') === '#' + id ? 'var(--primary)' : 'var(--text-secondary)';
                        a.style.fontWeight = a.getAttribute('href') === '#' + id ? '600' : '400';
                    });
                }
            });
        }, { threshold: 1.0 });

        headings.forEach(heading => observer.observe(heading));
    </script>
</body>
</html>