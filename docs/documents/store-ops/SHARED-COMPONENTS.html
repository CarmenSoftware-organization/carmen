<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shared Components - Carmen ERP Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--bg-light);
            color: var(--text-primary);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: var(--bg-white);
            border-right: 1px solid var(--border);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            padding: 2rem 0;
        }

        .sidebar-header {
            padding: 0 1.5rem;
            margin-bottom: 2rem;
        }

        .sidebar-header h1 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .back-link:hover {
            color: var(--primary);
        }

        .sidebar nav {
            padding: 0 1rem;
        }

        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-section h3 {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            padding: 0 0.5rem;
            margin-bottom: 0.5rem;
        }

        .nav-section ul {
            list-style: none;
        }

        .nav-section a {
            display: block;
            padding: 0.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .nav-section a:hover,
        .nav-section a.active {
            background: var(--bg-light);
            color: var(--primary);
        }

        .main-content {
            margin-left: 280px;
            flex: 1;
            padding: 2rem;
            max-width: calc(100% - 280px);
        }

        .breadcrumb {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .breadcrumb a {
            color: var(--primary);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .content-wrapper {
            display: flex;
            gap: 2rem;
        }

        .document-content {
            flex: 1;
            background: var(--bg-white);
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
            min-width: 0;
        }

        .toc-sidebar {
            width: 250px;
            flex-shrink: 0;
        }

        .toc-sticky {
            position: sticky;
            top: 2rem;
            background: var(--bg-white);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
        }

        .toc-title {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .toc-list {
            list-style: none;
        }

        .toc-list a {
            display: block;
            padding: 0.25rem 0;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            transition: color 0.2s;
        }

        .toc-list a:hover {
            color: var(--primary);
        }

        .toc-list .toc-h2 {
            margin-left: 0;
            font-weight: 500;
        }

        .toc-list .toc-h3 {
            margin-left: 1rem;
            font-size: 0.8125rem;
        }

        .toc-list .toc-h4 {
            margin-left: 2rem;
            font-size: 0.75rem;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        h2 {
            font-size: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
            color: var(--text-primary);
        }

        h3 {
            font-size: 1.25rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        h4 {
            font-size: 1.125rem;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        p {
            margin-bottom: 1rem;
        }

        ul, ol {
            margin-bottom: 1rem;
            padding-left: 2rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        code {
            background: var(--bg-light);
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.875rem;
        }

        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        pre code {
            background: transparent;
            padding: 0;
            color: inherit;
        }

        blockquote {
            border-left: 4px solid var(--primary);
            padding-left: 1rem;
            margin: 1rem 0;
            color: var(--text-secondary);
            font-style: italic;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
        }

        th, td {
            border: 1px solid var(--border);
            padding: 0.75rem;
            text-align: left;
        }

        th {
            background: var(--bg-light);
            font-weight: 600;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 2rem 0;
        }

        img {
            max-width: 600px;
            height: auto;
            border-radius: 0.5rem;
            border: 1px solid var(--border);
            margin: 1rem 0;
            display: block;
        }

        .mermaid {
            background: var(--bg-white);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1.5rem 0;
            display: flex;
            justify-content: center;
            border: 1px solid var(--border);
            max-width: 800px;
            overflow-x: auto;
        }

        .mermaid svg {
            max-width: 100%;
            max-height: 500px;
            height: auto;
            transform: scale(0.85);
            transform-origin: top center;
        }

        @media (max-width: 1024px) {
            .sidebar {
                display: none;
            }

            .main-content {
                margin-left: 0;
                max-width: 100%;
            }

            .toc-sidebar {
                display: none;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';

        // Initialize Mermaid with enhanced configuration
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            themeVariables: {
                primaryColor: '#2563eb',
                primaryTextColor: '#0f172a',
                primaryBorderColor: '#1e40af',
                lineColor: '#64748b',
                secondaryColor: '#10b981',
                tertiaryColor: '#f59e0b',
                background: '#ffffff',
                mainBkg: '#f8fafc',
                secondBkg: '#e2e8f0',
                border1: '#cbd5e1',
                border2: '#94a3b8'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true,
                wrap: true
            },
            gantt: {
                useMaxWidth: true
            }
        });

        // Expose mermaid globally and signal it's ready
        window.mermaid = mermaid;
        window.mermaidReady = true;

        // Dispatch event when mermaid is ready
        window.dispatchEvent(new Event('mermaidLoaded'));
    </script>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="back-link">‚Üê All Modules</a>
            <h1>Store Operations</h1>
        </div>

        <nav>
            <div class="nav-section">
                <h3>Navigation</h3>
                <ul>
                    <li><a href="../index.html">Module Overview</a></li>
                    <li><a href="../index.html#features">Features</a></li>
                </ul>
            </div>
        </nav>
    </aside>

    <div class="main-content">
        <div class="breadcrumb"><a href="../index.html">Documentation</a> / <a href="../index.html">STORE-OPS</a></div>

        <div class="content-wrapper">
            <div class="document-content" id="markdown-content"></div>

            <aside class="toc-sidebar">
                <div class="toc-sticky">
                    <div class="toc-title">On This Page</div>
                    <ul class="toc-list" id="toc-list"></ul>
                </div>
            </aside>
        </div>
    </div>

    <script>
        const markdownContent = "# Shared Components\n\n**Module**: Store Operations\n**Last Updated**: 2025-10-02\n\n## Table of Contents\n\n1. [Modals and Dialogues](#modals-and-dialogues)\n2. [Dropdown Components](#dropdown-components)\n3. [Form Components](#form-components)\n4. [Display Components](#display-components)\n5. [Navigation Components](#navigation-components)\n\n---\n\n## Modals and Dialogues\n\n### 1. Filter Builder Dialog\n\n**Component**: `FilterBuilder` inside `Dialog`\n**Used In**: Store Requisitions List\n**Trigger**: Click \"Add Filters\" button\n\n**Features**:\n- Dynamic filter condition rows\n- Add/remove conditions\n- Field, operator, and value selection\n- Apply filters action\n\n**Fields**:\n- Date\n- Requisition (Ref No)\n- Request To\n- To Location\n- Store Name\n- Description\n- Status\n- Workflow Stage\n- Process Status\n\n**Operators**:\n- Equals\n- Contains\n- Greater than\n- Less than\n\n**Action Flow**:\n```mermaid\nflowchart LR\n    Open[\"Open Dialog\"] --> Add[\"Add Filter Condition\"]\n    Add --> Select[\"Select Field, Operator, Value\"]\n    Select --> More{\"Add More?\"}\n    More -->|Yes| Add\n    More -->|No| Apply[\"Click Apply Filters\"]\n    Apply --> Filter[\"Apply to List\"]\n    Filter --> Close[\"Close Dialog\"]\n```\n\n---\n\n### 2. Approval Log Dialog\n\n**Component**: `ApprovalLogDialog`\n**Used In**: Store Requisition Detail - Approval Workflow\n**Trigger**: Click \"View Log\" button\n\n**Purpose**: Display complete approval history for a requisition\n\n**Content**:\n- Chronological approval steps\n- Approver information\n- Action taken (Approved/Rejected/Requested Changes)\n- Comments\n- Timestamps\n- Approval status\n\n**Fields Displayed**:\n- Stage Level\n- Approver Name\n- Approver Role\n- Action\n- Comments\n- Timestamp\n\n**Action Flow**:\n```mermaid\nflowchart LR\n    Click[\"Click View Log\"] --> Load[\"Load Approval History\"]\n    Load --> Display[\"Display in Dialog\"]\n    Display --> Close[\"Close Dialog\"]\n```\n\n---\n\n### 3. Item Info Popover\n\n**Component**: Custom Popover/Tooltip\n**Used In**: Store Requisition Detail - Items Tab\n**Trigger**: Hover on item name or info icon\n\n**Content**:\n- Item Name\n- Location and Location Code\n- Category\n- Sub-category\n- Item Group\n- Barcode\n- Location Type\n\n**Action Flow**:\n```mermaid\nflowchart LR\n    Hover[\"Hover on Item\"] --> Show[\"Show Popover\"]\n    Show --> Display[\"Display Item Info\"]\n    Leave[\"Mouse Leave\"] --> Hide[\"Hide Popover\"]\n```\n\n---\n\n### 4. Inventory Info Popover\n\n**Component**: Custom Popover/Tooltip\n**Used In**: Store Requisition Detail - Items Tab (Expanded Row)\n**Trigger**: Hover on inventory icon\n\n**Content**:\n- On Hand Quantity\n- On Order Quantity\n- Last Purchase Price\n- Last Vendor\n\n**Action Flow**:\n```mermaid\nflowchart LR\n    Hover[\"Hover on Icon\"] --> Show[\"Show Popover\"]\n    Show --> Display[\"Display Inventory Details\"]\n    Leave[\"Mouse Leave\"] --> Hide[\"Hide Popover\"]\n```\n\n---\n\n## Dropdown Components\n\n### 1. Status Filter Dropdown\n\n**Component**: `Select`\n**Used In**: Store Requisitions List, Wastage Reporting\n**Type**: Single Select\n\n**Options**:\n- All Status (default)\n- Draft\n- In Process\n- Complete\n- Reject\n- Void\n\n**Action Flow**:\n```mermaid\nflowchart LR\n    Click[\"Click Dropdown\"] --> Open[\"Open Options\"]\n    Open --> Select[\"Select Status\"]\n    Select --> Apply[\"Apply Filter\"]\n    Apply --> Close[\"Close Dropdown\"]\n```\n\n---\n\n### 2. Location Filter Dropdown\n\n**Component**: `Select`\n**Used In**: Stock Replenishment, Wastage Reporting\n**Type**: Single Select\n\n**Options**: Dynamic list of locations\n- All Locations (default)\n- Central Kitchen (CK-001)\n- Roastery Store (RS-001)\n- Main Warehouse (MW-001)\n- [Additional locations...]\n\n**Action Flow**:\n```mermaid\nflowchart LR\n    Click[\"Click Dropdown\"] --> Load[\"Load Locations\"]\n    Load --> Select[\"Select Location\"]\n    Select --> Filter[\"Filter Items\"]\n```\n\n---\n\n### 3. Reason Filter Dropdown\n\n**Component**: `Select`\n**Used In**: Wastage Reporting\n**Type**: Single Select\n\n**Options**:\n- All Reasons (default)\n- Expiration\n- Damage\n- Quality Issues\n- Other\n\n**Action Flow**:\n```mermaid\nflowchart LR\n    Click[\"Click Dropdown\"] --> Open[\"Open Options\"]\n    Open --> Select[\"Select Reason\"]\n    Select --> Filter[\"Filter Wastage Records\"]\n```\n\n---\n\n### 4. Actions Dropdown Menu\n\n**Component**: `DropdownMenu`\n**Used In**: All list pages, detail pages\n**Trigger**: Click actions icon (‚ãÆ or ‚ãØ)\n\n**Variants**:\n\n**Store Requisitions List**:\n- View\n- Edit\n- Export\n- Delete\n\n**Store Requisition Detail**:\n- Edit Requisition\n- Print\n- Void\n- Copy\n- Delete\n- Export\n\n**Action Flow**:\n```mermaid\nflowchart LR\n    Click[\"Click Actions Icon\"] --> Open[\"Open Menu\"]\n    Open --> Select[\"Select Action\"]\n    Select --> Execute[\"Execute Action\"]\n    Execute --> Close[\"Close Menu\"]\n```\n\n---\n\n### 5. Filter Field Dropdown\n\n**Component**: `Select`\n**Used In**: Filter Builder Dialog\n**Type**: Single Select\n\n**Options**:\n- Date\n- Requisition\n- Request To\n- To Location\n- Store Name\n- Description\n- Status\n- Workflow Stage\n- Process Status\n\n---\n\n### 6. Filter Operator Dropdown\n\n**Component**: `Select`\n**Used In**: Filter Builder Dialog\n**Type**: Single Select\n\n**Options**:\n- Equals\n- Contains\n- Greater than\n- Less than\n\n---\n\n## Form Components\n\n### 1. Search Input\n\n**Component**: `Input` with search icon\n**Used In**: All list pages\n\n**Features**:\n- Left-aligned search icon\n- Placeholder text\n- Real-time filtering\n- Clear button (optional)\n\n**Variants**:\n- Store Requisitions: \"Search requisitions...\"\n- Stock Replenishment: \"Search items...\"\n- Wastage Reporting: \"Search wastage records...\"\n\n**Action Flow**:\n```mermaid\nflowchart LR\n    Type[\"Type Search\"] --> Debounce[\"Debounce Input\"]\n    Debounce --> Filter[\"Filter Results\"]\n    Filter --> Update[\"Update Display\"]\n```\n\n---\n\n### 2. Pagination Controls\n\n**Component**: `Pagination`\n**Used In**: Store Requisitions List\n\n**Features**:\n- First page button (hidden on mobile)\n- Previous page button\n- Page number display\n- Go to page input\n- Next page button\n- Last page button (hidden on mobile)\n- Responsive design\n\n**Action Flow**:\n```mermaid\nflowchart LR\n    Click[\"Click Control\"] --> Validate[\"Validate Page Number\"]\n    Validate --> Load[\"Load Page Data\"]\n    Load --> Update[\"Update Display\"]\n```\n\n---\n\n### 3. View Toggle\n\n**Component**: Button group\n**Used In**: Store Requisitions List\n\n**Options**:\n- Table View (List icon)\n- Card View (Grid icon)\n\n**Action Flow**:\n```mermaid\nflowchart LR\n    Click[\"Click View Toggle\"] --> Switch[\"Switch View Mode\"]\n    Switch --> Render[\"Re-render Layout\"]\n```\n\n---\n\n### 4. Date Range Picker\n\n**Component**: `DateRangePicker` (future)\n**Used In**: Wastage Reporting, Reports\n\n**Features**:\n- Start date selection\n- End date selection\n- Preset ranges (This Week, This Month, Last Month, etc.)\n- Calendar picker\n\n---\n\n## Display Components\n\n### 1. Status Badge\n\n**Component**: `StatusBadge` or `Badge`\n**Used In**: All modules\n\n**Variants**:\n\n**Store Requisitions**:\n- Draft (Gray)\n- In Process (Blue)\n- Complete (Green)\n- Reject (Red)\n- Void (Gray strikethrough)\n\n**Wastage**:\n- Pending Review (Orange)\n- Approved (Green)\n- Rejected (Red)\n- Void (Gray)\n\n**Stock Status**:\n- Low (Red)\n- Critical (Dark Red)\n- Normal (Green)\n- High (Blue)\n- Overstock (Orange)\n\n**Props**:\n```typescript\ninterface StatusBadgeProps {\n  status: string\n  variant?: 'default' | 'outline' | 'secondary'\n}\n```\n\n---\n\n### 2. Workflow Stage Badge\n\n**Component**: Custom badge with tooltip\n**Used In**: Store Requisitions\n\n**Features**:\n- Colored dot indicator\n- Stage name text\n- Hover tooltip with description\n- Color-coded by stage type\n\n**Stages**:\n- Submission (Blue)\n- HOD Approval (Purple)\n- Store Manager Approval (Amber)\n- Complete (Green)\n- Rejected (Red)\n\n**Props**:\n```typescript\ninterface WorkflowStageBadgeProps {\n  stage: string\n  tooltip: string\n}\n```\n\n---\n\n### 3. Stat Card\n\n**Component**: `Card` with statistics\n**Used In**: All dashboard pages\n\n**Structure**:\n- Title text\n- Large value display\n- Icon (optional)\n- Trend indicator (optional)\n- Comparison text (optional)\n\n**Variants**:\n- Numeric (e.g., \"1,234\")\n- Currency (e.g., \"$45,678\")\n- Percentage (e.g., \"45%\")\n- Count with trend (e.g., \"28 items +8%\")\n\n**Props**:\n```typescript\ninterface StatCardProps {\n  title: string\n  value: string | number\n  icon?: React.ReactNode\n  trend?: 'up' | 'down' | 'neutral'\n  trendValue?: string\n  trendLabel?: string\n}\n```\n\n---\n\n### 4. Data Table\n\n**Component**: `Table` from shadcn/ui\n**Used In**: All list views\n\n**Features**:\n- Sticky header\n- Sortable columns\n- Row hover effects\n- Responsive design\n- Horizontal scroll on mobile\n- Minimum column widths\n\n**Props**:\n```typescript\ninterface DataTableProps<T> {\n  columns: ColumnDef<T>[]\n  data: T[]\n  sorting?: SortingState\n  onSortingChange?: (sorting: SortingState) => void\n}\n```\n\n---\n\n### 5. Card View Item\n\n**Component**: Custom card component\n**Used In**: Store Requisitions Card View\n\n**Structure**:\n- Header with reference and status\n- Description\n- Key details in grid\n- Footer with metadata\n- Actions menu\n\n**Features**:\n- Responsive grid layout\n- Truncated text with ellipsis\n- Hover shadow effect\n- Conditional field display\n\n---\n\n### 6. Chart Components\n\n**Components**: Recharts library\n**Used In**: All dashboard pages\n\n**Chart Types**:\n\n**Line Chart**:\n- Stock level trends\n- Monthly wastage trends\n- Purpose: Time series visualization\n\n**Pie/Donut Chart**:\n- Wastage by reason\n- Stock distribution by location\n- Purpose: Proportion visualization\n\n**Bar Chart**:\n- Top stores by requisitions\n- Items by category\n- Purpose: Comparison visualization\n\n**Common Props**:\n```typescript\ninterface ChartProps {\n  data: any[]\n  width?: number | string\n  height?: number | string\n  responsive?: boolean\n}\n```\n\n---\n\n## Navigation Components\n\n### 1. Back Button\n\n**Component**: Button with ChevronLeft icon\n**Used In**: Detail pages\n\n**Action Flow**:\n```mermaid\nflowchart LR\n    Click[\"Click Back\"] --> Navigate[\"Navigate to List Page\"]\n```\n\n---\n\n### 2. Tab Navigation\n\n**Component**: `Tabs` from shadcn/ui\n**Used In**: Store Requisition Detail\n\n**Tabs**:\n- Items\n- Stock Movements\n- Journal Entries\n- Approval Workflow\n\n**Action Flow**:\n```mermaid\nflowchart LR\n    Click[\"Click Tab\"] --> Switch[\"Switch Tab Content\"]\n    Switch --> Load[\"Load Tab Data\"]\n    Load --> Display[\"Display Content\"]\n```\n\n---\n\n### 3. Breadcrumbs\n\n**Component**: Breadcrumb navigation (future)\n**Used In**: All pages\n\n**Structure**:\n```\nStore Operations > Store Requisitions > SR-2024-001\n```\n\n---\n\n## Component Patterns\n\n### Button Patterns\n\n**Primary Actions**:\n- Solid background\n- High contrast\n- CTA (Call to Action)\n- Examples: \"New Request\", \"Create Requisition\", \"Report Wastage\"\n\n**Secondary Actions**:\n- Outline style\n- Medium contrast\n- Supporting actions\n- Examples: \"Export\", \"Saved Filters\"\n\n**Destructive Actions**:\n- Red color scheme\n- Warning indicators\n- Confirmation required\n- Examples: \"Delete\", \"Void\"\n\n**Icon Buttons**:\n- Ghost/minimal style\n- Icon only\n- Tooltip on hover\n- Examples: Actions menu (‚ãÆ), View toggle\n\n---\n\n### Loading States\n\n**Skeleton Loaders**:\n- Pulsing animation\n- Matches component structure\n- Used during data fetch\n\n**Spinners**:\n- Centered in container\n- Used for quick operations\n\n**Progressive Loading**:\n- Load critical content first\n- Lazy load secondary data\n\n---\n\n### Error States\n\n**Empty States**:\n- Icon\n- Message\n- Call to action\n- Example: \"No requisitions found. Try adjusting your filters.\"\n\n**Error Messages**:\n- Red alert banner\n- Error icon\n- Descriptive message\n- Retry action\n\n---\n\n### Responsive Patterns\n\n**Mobile Optimizations**:\n- Hide non-essential columns\n- Switch to card view\n- Simplified navigation\n- Touch-friendly targets (44x44px minimum)\n\n**Tablet Optimizations**:\n- Adaptive grid layouts\n- Collapsible sidebars\n- Optimized table columns\n\n**Desktop Optimizations**:\n- Full table display\n- Multi-column layouts\n- Hover states\n- Keyboard shortcuts\n\n---\n\n**Last Updated**: 2025-10-02\n**Module**: Store Operations\n**Status**: ‚úÖ Production (Store Requisitions), üöß Prototype (Others)\n";

        // Configure marked
        marked.setOptions({
            highlight: function(code, lang) {
                return code;
            },
            breaks: true,
            gfm: true
        });

        // Render markdown
        const contentDiv = document.getElementById('markdown-content');
        contentDiv.innerHTML = marked.parse(markdownContent);

        // Function to render Mermaid diagrams
        function renderMermaidDiagrams() {
            if (!window.mermaid) {
                console.log('Mermaid not loaded yet, waiting...');
                return;
            }

            // Find all code blocks with mermaid language
            const mermaidBlocks = contentDiv.querySelectorAll('pre code.language-mermaid, pre code[class*="mermaid"]');

            if (mermaidBlocks.length === 0) {
                console.log('No mermaid blocks found');
                return;
            }

            console.log('Found', mermaidBlocks.length, 'mermaid blocks');

            mermaidBlocks.forEach((block, index) => {
                const mermaidCode = block.textContent;
                const pre = block.parentElement;

                // Create a div for mermaid diagram
                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.textContent = mermaidCode;
                mermaidDiv.id = 'mermaid-diagram-' + index;

                // Replace the pre block with mermaid div
                pre.replaceWith(mermaidDiv);
            });

            // Run mermaid rendering
            window.mermaid.run({
                querySelector: '.mermaid'
            }).then(() => {
                console.log('Mermaid diagrams rendered successfully');
            }).catch(err => {
                console.error('Mermaid rendering error:', err);
            });
        }

        // Wait for mermaid to load before rendering
        if (window.mermaidReady) {
            renderMermaidDiagrams();
        } else {
            window.addEventListener('mermaidLoaded', renderMermaidDiagrams);
            // Fallback timeout
            setTimeout(renderMermaidDiagrams, 1000);
        }

        // Generate TOC from headings
        const tocList = document.getElementById('toc-list');
        const headings = contentDiv.querySelectorAll('h2, h3, h4');

        headings.forEach((heading, index) => {
            const id = 'heading-' + index;
            heading.id = id;

            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + id;
            a.textContent = heading.textContent;
            a.className = 'toc-' + heading.tagName.toLowerCase();

            li.appendChild(a);
            tocList.appendChild(li);
        });

        // Highlight active TOC item on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.id;
                    tocList.querySelectorAll('a').forEach(a => {
                        a.style.color = a.getAttribute('href') === '#' + id ? 'var(--primary)' : 'var(--text-secondary)';
                        a.style.fontWeight = a.getAttribute('href') === '#' + id ? '600' : '400';
                    });
                }
            });
        }, { threshold: 1.0 });

        headings.forEach(heading => observer.observe(heading));
    </script>
</body>
</html>