<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Engineering - Carmen ERP Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--bg-light);
            color: var(--text-primary);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: var(--bg-white);
            border-right: 1px solid var(--border);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            padding: 2rem 0;
        }

        .sidebar-header {
            padding: 0 1.5rem;
            margin-bottom: 2rem;
        }

        .sidebar-header h1 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .back-link:hover {
            color: var(--primary);
        }

        .sidebar nav {
            padding: 0 1rem;
        }

        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-section h3 {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            padding: 0 0.5rem;
            margin-bottom: 0.5rem;
        }

        .nav-section ul {
            list-style: none;
        }

        .nav-section a {
            display: block;
            padding: 0.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .nav-section a:hover,
        .nav-section a.active {
            background: var(--bg-light);
            color: var(--primary);
        }

        .main-content {
            margin-left: 280px;
            flex: 1;
            padding: 2rem;
            max-width: calc(100% - 280px);
        }

        .breadcrumb {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .breadcrumb a {
            color: var(--primary);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .content-wrapper {
            display: flex;
            gap: 2rem;
        }

        .document-content {
            flex: 1;
            background: var(--bg-white);
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
            min-width: 0;
        }

        .toc-sidebar {
            width: 250px;
            flex-shrink: 0;
        }

        .toc-sticky {
            position: sticky;
            top: 2rem;
            background: var(--bg-white);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
        }

        .toc-title {
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .toc-list {
            list-style: none;
        }

        .toc-list a {
            display: block;
            padding: 0.25rem 0;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            transition: color 0.2s;
        }

        .toc-list a:hover {
            color: var(--primary);
        }

        .toc-list .toc-h2 {
            margin-left: 0;
            font-weight: 500;
        }

        .toc-list .toc-h3 {
            margin-left: 1rem;
            font-size: 0.8125rem;
        }

        .toc-list .toc-h4 {
            margin-left: 2rem;
            font-size: 0.75rem;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        h2 {
            font-size: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
            color: var(--text-primary);
        }

        h3 {
            font-size: 1.25rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        h4 {
            font-size: 1.125rem;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        p {
            margin-bottom: 1rem;
        }

        ul, ol {
            margin-bottom: 1rem;
            padding-left: 2rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        code {
            background: var(--bg-light);
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.875rem;
        }

        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        pre code {
            background: transparent;
            padding: 0;
            color: inherit;
        }

        blockquote {
            border-left: 4px solid var(--primary);
            padding-left: 1rem;
            margin: 1rem 0;
            color: var(--text-secondary);
            font-style: italic;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
        }

        th, td {
            border: 1px solid var(--border);
            padding: 0.75rem;
            text-align: left;
        }

        th {
            background: var(--bg-light);
            font-weight: 600;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 2rem 0;
        }

        img {
            max-width: 600px;
            height: auto;
            border-radius: 0.5rem;
            border: 1px solid var(--border);
            margin: 1rem 0;
            display: block;
        }

        .mermaid {
            background: var(--bg-white);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1.5rem 0;
            display: flex;
            justify-content: center;
            border: 1px solid var(--border);
            max-width: 800px;
            overflow-x: auto;
        }

        .mermaid svg {
            max-width: 100%;
            max-height: 500px;
            height: auto;
            transform: scale(0.85);
            transform-origin: top center;
        }

        @media (max-width: 1024px) {
            .sidebar {
                display: none;
            }

            .main-content {
                margin-left: 0;
                max-width: 100%;
            }

            .toc-sidebar {
                display: none;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';

        // Initialize Mermaid with enhanced configuration
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            themeVariables: {
                primaryColor: '#2563eb',
                primaryTextColor: '#0f172a',
                primaryBorderColor: '#1e40af',
                lineColor: '#64748b',
                secondaryColor: '#10b981',
                tertiaryColor: '#f59e0b',
                background: '#ffffff',
                mainBkg: '#f8fafc',
                secondBkg: '#e2e8f0',
                border1: '#cbd5e1',
                border2: '#94a3b8'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true,
                wrap: true
            },
            gantt: {
                useMaxWidth: true
            }
        });

        // Expose mermaid globally and signal it's ready
        window.mermaid = mermaid;
        window.mermaidReady = true;

        // Dispatch event when mermaid is ready
        window.dispatchEvent(new Event('mermaidLoaded'));
    </script>
</head>
<body>
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="../../../index.html" class="back-link">‚Üê All Modules</a>
            <h1>Operational Planning</h1>
        </div>

        <nav>
            <div class="nav-section">
                <h3>Navigation</h3>
                <ul>
                    <li><a href="../../../index.html">Module Overview</a></li>
                    <li><a href="../../../index.html#features">Features</a></li>
                </ul>
            </div>
        </nav>
    </aside>

    <div class="main-content">
        <div class="breadcrumb"><a href="../../../index.html">Documentation</a> / <a href="../../../index.html">OP</a> / Features / Menu Engineering</div>

        <div class="content-wrapper">
            <div class="document-content" id="markdown-content"></div>

            <aside class="toc-sidebar">
                <div class="toc-sticky">
                    <div class="toc-title">On This Page</div>
                    <ul class="toc-list" id="toc-list"></ul>
                </div>
            </aside>
        </div>
    </div>

    <script>
        const markdownContent = "# Menu Engineering\n\n> **Feature:** Operational Planning > Menu Engineering\n> **Pages:** 4\n> **Status:** ‚úÖ Production Ready\n\n---\n\n## Overview\n\nMenu Engineering is a strategic analysis tool that classifies menu items based on their popularity and profitability using the classic menu engineering matrix. This feature enables data-driven menu optimization decisions by categorizing items into Stars, Plow Horses, Puzzles, and Dogs, with actionable recommendations for each category.\n\n### Key Capabilities\n\n1. **Performance Matrix** - Interactive scatter plot of popularity vs profitability\n2. **Portfolio Analysis** - Menu composition breakdown and top performers\n3. **Cost Alerts** - Automated monitoring and threshold management\n4. **Sales Data Import** - POS integration and manual data upload\n5. **Recipe Metrics** - Individual recipe performance deep-dive\n6. **Classification System** - Automated categorization with visual indicators\n\n---\n\n## Page Structure\n\n### Main Route\n**Route:** `/operational-planning/menu-engineering`\n\n### Tab Navigation\n\n#### 1. Performance Matrix Tab\nInteractive scatter chart plotting menu items by popularity (x-axis) vs profitability (y-axis).\n\n**Features:**\n- **Quadrant Classification**:\n  - **Stars** (Upper Right): High popularity + High profitability\n  - **Plow Horses** (Upper Left): High popularity + Low profitability\n  - **Puzzles** (Lower Right): Low popularity + High profitability\n  - **Dogs** (Lower Left): Low popularity + Low profitability\n\n- **Interactive Elements**:\n  - Click on data points to view recipe details\n  - Tooltip shows recipe name, category, metrics\n  - Color-coded by classification\n  - Visual quadrant dividers\n\n- **Filters**:\n  - Date range selector (calendar picker)\n  - Category filter dropdown\n  - Location filter dropdown\n  - Quick action buttons\n\n- **Key Metrics Cards**:\n  - Total menu items count\n  - Total revenue with trend\n  - Average contribution margin\n  - Active alerts count\n  - Portfolio health score (0-100%)\n\n#### 2. Portfolio Analysis Tab\nComprehensive breakdown of menu composition and performance.\n\n**Features:**\n- **Portfolio Composition**:\n  - Pie chart showing distribution by classification\n  - Percentage and count per category\n  - Visual legend with color coding\n\n- **Top Performers**:\n  - Ranked list of highest contribution items\n  - Unit contribution amounts\n  - Classification badges\n  - Click-through to recipe details\n\n- **Distribution Insights**:\n  - Ideal portfolio balance recommendations\n  - Current vs target composition\n  - Action items for rebalancing\n\n#### 3. Recipe Details Tab\nDetailed performance metrics for individual recipes.\n\n**Features:**\n- Recipe performance over time\n- Sales trend charts\n- Profit trend analysis\n- Comparison to category averages\n- Historical performance data\n- Seasonality analysis\n\n**Component:** `RecipePerformanceMetrics`\n\n#### 4. Cost Alerts Tab\nProactive cost monitoring and alert management.\n\n**Features:**\n- Alert configuration\n- Threshold setting\n- Alert history\n- Critical alerts highlighting\n- Bulk alert actions\n- Alert statistics dashboard\n\n**Component:** `CostAlertManagement`\n\n#### 5. Data Import Tab\nSales data integration and upload interface.\n\n**Features:**\n- POS data import\n- Manual CSV/Excel upload\n- Field mapping interface\n- Data validation\n- Import history\n- Error reporting\n\n**Component:** `SalesDataImport`\n\n---\n\n## Data Model\n\n```typescript\ninterface MenuItemPerformance {\n  // Identity\n  recipeId: string;\n  recipeName: string;\n  category: string;\n\n  // Sales Metrics\n  totalSales: number; // Units sold\n  totalRevenue: Money;\n  grossProfit: Money;\n  grossMarginPercentage: number;\n\n  // Performance Scores\n  popularityScore: number; // 0-100, relative to all items\n  profitabilityScore: number; // 0-100, relative to average margin\n\n  // Classification\n  classification: 'star' | 'plow_horse' | 'puzzle' | 'dog';\n\n  // Trends\n  salesTrend: number; // Percentage change\n  profitTrend: number; // Percentage change\n\n  // Contribution\n  unitContribution: Money; // Profit per unit sold\n}\n\ninterface MenuEngineeringClassification {\n  // Classification Thresholds\n  popularityThreshold: number; // Default: 50% (median)\n  profitabilityThreshold: number; // Default: 50% (median)\n\n  // Portfolio Targets\n  targetStarPercentage: number; // Recommended: 25%\n  targetPlowHorsePercentage: number; // Recommended: 25%\n  targetPuzzlePercentage: number; // Recommended: 25%\n  targetDogPercentage: number; // Recommended: 25%\n}\n\ninterface CostAlert {\n  id: string;\n  recipeId: string;\n  recipeName: string;\n  alertType: 'ingredient_price_increase' | 'margin_below_target' | 'cost_variance' | 'wastage_high';\n  severity: 'critical' | 'high' | 'medium' | 'low';\n  status: 'active' | 'resolved' | 'dismissed';\n  threshold: number;\n  currentValue: number;\n  message: string;\n  createdAt: string;\n  resolvedAt?: string;\n  actions: string[]; // Recommended actions\n}\n\ninterface SalesDataImport {\n  id: string;\n  importDate: string;\n  source: 'pos' | 'manual' | 'api';\n  fileName?: string;\n  recordCount: number;\n  dateRange: {\n    from: Date;\n    to: Date;\n  };\n  status: 'pending' | 'processing' | 'completed' | 'failed';\n  validationErrors: string[];\n  mappings: FieldMapping[];\n}\n\ninterface FieldMapping {\n  sourceField: string;\n  targetField: string;\n  transformation?: string;\n}\n```\n\n---\n\n## Menu Engineering Methodology\n\n### Classification Algorithm\n\n#### Step 1: Calculate Popularity Score\n```typescript\nfunction calculatePopularityScore(item: MenuItem, allItems: MenuItem[]): number {\n  const totalSales = allItems.reduce((sum, i) => sum + i.totalSales, 0);\n  const itemPopularity = (item.totalSales / totalSales) * 100;\n\n  // Score relative to median (50th percentile)\n  const allPopularities = allItems.map(i => (i.totalSales / totalSales) * 100);\n  const median = calculateMedian(allPopularities);\n\n  return (itemPopularity / median) * 50; // Normalized to 0-100 scale\n}\n```\n\n#### Step 2: Calculate Profitability Score\n```typescript\nfunction calculateProfitabilityScore(item: MenuItem, allItems: MenuItem[]): number {\n  const averageMargin = allItems.reduce((sum, i) =>\n    sum + i.grossMarginPercentage, 0) / allItems.length;\n\n  // Score relative to average\n  return (item.grossMarginPercentage / averageMargin) * 50; // Normalized to 0-100 scale\n}\n```\n\n#### Step 3: Classify Item\n```typescript\nfunction classifyMenuItem(\n  popularityScore: number,\n  profitabilityScore: number\n): Classification {\n  const popularityThreshold = 50;\n  const profitabilityThreshold = 50;\n\n  if (popularityScore >= popularityThreshold &&\n      profitabilityScore >= profitabilityThreshold) {\n    return 'star'; // High-High\n  } else if (popularityScore >= popularityThreshold &&\n             profitabilityScore < profitabilityThreshold) {\n    return 'plow_horse'; // High-Low\n  } else if (popularityScore < popularityThreshold &&\n             profitabilityScore >= profitabilityThreshold) {\n    return 'puzzle'; // Low-High\n  } else {\n    return 'dog'; // Low-Low\n  }\n}\n```\n\n### Portfolio Health Score\n```typescript\nfunction calculatePortfolioHealth(items: MenuItem[]): number {\n  const distribution = calculateDistribution(items);\n  const ideal = { star: 0.25, plow_horse: 0.25, puzzle: 0.25, dog: 0.25 };\n\n  // Calculate deviation from ideal\n  let totalDeviation = 0;\n  for (const category in ideal) {\n    const deviation = Math.abs(distribution[category] - ideal[category]);\n    totalDeviation += deviation;\n  }\n\n  // Convert to 0-100 score (lower deviation = higher score)\n  return Math.max(0, 100 - (totalDeviation * 100));\n}\n```\n\n---\n\n## Strategic Recommendations\n\n### Classification Matrix & Actions\n\n| Classification | Characteristics | Strategic Actions | Priority |\n|---------------|----------------|-------------------|----------|\n| **Stars** üåü | High popularity + High profitability | ‚Ä¢ Maintain quality<br>‚Ä¢ Promote prominently<br>‚Ä¢ Monitor carefully<br>‚Ä¢ Keep recipe consistent | **Critical** |\n| **Plow Horses** üê¥ | High popularity + Low profitability | ‚Ä¢ Increase price gradually<br>‚Ä¢ Reduce portion size<br>‚Ä¢ Substitute cheaper ingredients<br>‚Ä¢ Reposition menu placement | **High** |\n| **Puzzles** üß© | Low popularity + High profitability | ‚Ä¢ Increase marketing<br>‚Ä¢ Reduce price<br>‚Ä¢ Reposition on menu<br>‚Ä¢ Enhance presentation | **Medium** |\n| **Dogs** üêï | Low popularity + Low profitability | ‚Ä¢ Remove from menu<br>‚Ä¢ Reformulate recipe<br>‚Ä¢ Replace entirely<br>‚Ä¢ Offer as special only | **Low** |\n\n### Ideal Portfolio Composition\n\n**Target Distribution:**\n- **25% Stars**: Core menu drivers\n- **25% Plow Horses**: Volume generators\n- **25% Puzzles**: Profit opportunities\n- **25% Dogs**: Candidates for removal\n\n**Warning Thresholds:**\n- Stars < 15%: Menu lacks strong performers\n- Plow Horses > 40%: Profitability issues\n- Puzzles > 35%: Low customer appeal\n- Dogs > 30%: Menu needs cleanup\n\n---\n\n## Cost Alert System\n\n### Alert Types\n\n#### 1. Ingredient Price Increase\n**Trigger:** Supplier cost increase >10%\n**Severity:** Medium to Critical (based on %)\n**Actions:**\n- Review supplier alternatives\n- Adjust recipe pricing\n- Substitute ingredients\n- Negotiate with supplier\n\n#### 2. Margin Below Target\n**Trigger:** Gross margin <25%\n**Severity:** High\n**Actions:**\n- Increase selling price\n- Reduce portion size\n- Optimize ingredient usage\n- Review labor costs\n\n#### 3. Cost Variance\n**Trigger:** Actual cost vs theoretical >5%\n**Severity:** Medium to High\n**Actions:**\n- Investigate wastage\n- Audit inventory\n- Check recipe adherence\n- Train kitchen staff\n\n#### 4. High Wastage\n**Trigger:** Wastage rate >expected by 20%\n**Severity:** Medium\n**Actions:**\n- Review prep procedures\n- Adjust par levels\n- Improve storage\n- Update forecasting\n\n### Alert Configuration\n\n```typescript\ninterface AlertThreshold {\n  alertType: AlertType;\n  threshold: number;\n  severity: 'critical' | 'high' | 'medium' | 'low';\n  notificationChannels: ('email' | 'sms' | 'dashboard' | 'mobile')[];\n  assignees: string[]; // User IDs\n  autoResolve: boolean;\n  escalationRules: EscalationRule[];\n}\n```\n\n---\n\n## Sales Data Integration\n\n### POS Integration Flow\n\n1. **Connect POS System**\n   - API configuration\n   - Authentication setup\n   - Sync schedule\n\n2. **Data Mapping**\n   - Map POS menu items to recipes\n   - Configure field mappings\n   - Set transformation rules\n\n3. **Automatic Sync**\n   - Scheduled imports (hourly/daily)\n   - Real-time sync (if supported)\n   - Error handling and retry\n\n4. **Validation**\n   - Data quality checks\n   - Missing field detection\n   - Duplicate prevention\n\n5. **Processing**\n   - Calculate metrics\n   - Update performance scores\n   - Generate alerts\n\n### Manual Import Process\n\n1. **Upload File**\n   - Supported formats: CSV, Excel, JSON\n   - Template download available\n   - Drag-and-drop interface\n\n2. **Map Fields**\n   - Recipe ID/Name mapping\n   - Sales quantity field\n   - Revenue field\n   - Date field\n   - Category field (optional)\n\n3. **Validate Data**\n   - Required field check\n   - Data type validation\n   - Range validation\n   - Duplicate detection\n\n4. **Review & Import**\n   - Preview mapped data\n   - Validation summary\n   - Confirm import\n\n5. **Process Results**\n   - Import success/failure notification\n   - Error report download\n   - Data integration confirmation\n\n### Required Fields\n\n```typescript\ninterface SalesDataRow {\n  // Required\n  recipeId: string; // OR recipeName\n  salesQuantity: number;\n  revenue: number;\n  saleDate: string; // ISO format\n\n  // Optional\n  cost?: number;\n  category?: string;\n  location?: string;\n  customerId?: string;\n  transactionId?: string;\n}\n```\n\n---\n\n## API Endpoints\n\n```http\n# Menu Engineering Analysis\nGET /api/menu-engineering/performance\nGET /api/menu-engineering/portfolio\nGET /api/menu-engineering/classification\n\n# Individual Recipe Performance\nGET /api/menu-engineering/recipes/:id/performance\nGET /api/menu-engineering/recipes/:id/trends\n\n# Cost Alerts\nGET /api/menu-engineering/alerts\nPOST /api/menu-engineering/alerts\nPUT /api/menu-engineering/alerts/:id\nDELETE /api/menu-engineering/alerts/:id\nGET /api/menu-engineering/alerts/stats\n\n# Sales Data Import\nPOST /api/menu-engineering/import/sales\nGET /api/menu-engineering/import/history\nGET /api/menu-engineering/import/:id/status\nPOST /api/menu-engineering/import/validate\n\n# Configuration\nGET /api/menu-engineering/config\nPUT /api/menu-engineering/config/thresholds\nPUT /api/menu-engineering/config/targets\n```\n\n---\n\n## Business Rules\n\n### Performance Analysis\n1. **Minimum Data**: Requires 30 days sales data for accurate classification\n2. **Update Frequency**: Metrics recalculated daily at midnight\n3. **Seasonal Adjustment**: Option to exclude seasonal items from comparisons\n4. **New Item Grace Period**: Items <30 days excluded from Dog classification\n\n### Alert Rules\n1. **Alert Threshold**: Configurable per alert type\n2. **Escalation**: Auto-escalate critical alerts after 24 hours\n3. **Auto-Resolve**: Alerts auto-resolve when conditions normalized\n4. **Notification Limits**: Max 3 alerts per recipe per day\n\n### Data Import\n1. **Historical Limit**: Import data up to 2 years historical\n2. **Duplicate Prevention**: Same date range prevents re-import\n3. **Data Quality**: Requires >80% valid records to process\n4. **Reconciliation**: Daily reconciliation with POS systems\n\n---\n\n## Integration Points\n\n### Recipe Management\n- Real-time cost data\n- Recipe changes trigger recalculation\n- Ingredient cost updates\n- Margin impact analysis\n\n### POS Systems\n- Sales data synchronization\n- Menu item mapping\n- Transaction details\n- Customer preferences\n\n### Inventory Management\n- Cost tracking\n- Wastage reporting\n- Stock availability\n- Par level optimization\n\n### Finance\n- Revenue reporting\n- Profitability analysis\n- Cost accounting\n- Budget variance\n\n---\n\n## User Guide\n\n### Analyzing Menu Performance\n\n1. Navigate to Menu Engineering dashboard\n2. Select date range for analysis\n3. Apply category/location filters\n4. Review performance matrix:\n   - Identify items in each quadrant\n   - Click on data points for details\n5. Check portfolio composition\n6. Review top performers\n7. Take strategic actions based on classification\n\n### Setting Up Cost Alerts\n\n1. Go to Cost Alerts tab\n2. Click \"Create Alert\"\n3. Select alert type\n4. Set threshold value\n5. Choose severity level\n6. Add notification recipients\n7. Save alert configuration\n\n### Importing Sales Data\n\n1. Go to Data Import tab\n2. Click \"Upload File\" or \"Connect POS\"\n3. Select file or configure API\n4. Map fields to system fields\n5. Preview and validate data\n6. Confirm and process import\n7. Review import results\n\n---\n\n## Troubleshooting\n\n### Issue: Items Not Classified\n**Cause**: Insufficient sales data\n**Solution**: Ensure minimum 30 days of sales data imported\n\n### Issue: Portfolio Health Score Low\n**Cause**: Imbalanced menu composition\n**Solution**: Review Dogs and Plow Horses for optimization opportunities\n\n### Issue: Import Fails\n**Cause**: Field mapping errors or data format issues\n**Solution**: Download template, verify data format, check field mappings\n\n### Issue: Cost Alerts Not Triggering\n**Cause**: Threshold too high or data not syncing\n**Solution**: Verify alert configuration and data import status\n\n---\n\n## Performance Optimization\n\n**Best Practices:**\n- Cache performance calculations (24hr TTL)\n- Pre-calculate scores during nightly batch\n- Index sales data by date and recipe\n- Paginate large datasets\n- Lazy load charts and visualizations\n\n**Data Volume Handling:**\n- Archive data >2 years old\n- Aggregate daily sales to weekly/monthly\n- Limit concurrent imports to 3\n- Process imports in background jobs\n\n---\n\n## Reports & Analytics\n\n### Available Reports\n\n1. **Menu Performance Summary**\n   - Classification breakdown\n   - Top/bottom performers\n   - Trend analysis\n   - Recommendations\n\n2. **Profitability Report**\n   - Margin analysis by category\n   - Contribution ranking\n   - Cost variance tracking\n   - Pricing recommendations\n\n3. **Portfolio Health Report**\n   - Current vs ideal composition\n   - Rebalancing recommendations\n   - Historical trends\n   - Action items\n\n4. **Alert Summary Report**\n   - Active alerts by type\n   - Resolution metrics\n   - Cost impact analysis\n   - Trend analysis\n\n### Export Options\n- PDF (formatted reports)\n- Excel (raw data)\n- CSV (data export)\n- JSON (API integration)\n\n---\n\n## Future Enhancements\n\n**Planned Features:**\n- Machine learning predictions\n- Seasonal trend analysis\n- Competitor benchmarking\n- Customer sentiment integration\n- Dynamic pricing recommendations\n- A/B testing framework\n- Menu optimization simulator\n- Mobile app for alerts\n\n---\n\n**Last Updated:** 2025-01-17\n**Version:** 1.0.0\n";

        // Configure marked
        marked.setOptions({
            highlight: function(code, lang) {
                return code;
            },
            breaks: true,
            gfm: true
        });

        // Render markdown
        const contentDiv = document.getElementById('markdown-content');
        contentDiv.innerHTML = marked.parse(markdownContent);

        // Function to render Mermaid diagrams
        function renderMermaidDiagrams() {
            if (!window.mermaid) {
                console.log('Mermaid not loaded yet, waiting...');
                return;
            }

            // Find all code blocks with mermaid language
            const mermaidBlocks = contentDiv.querySelectorAll('pre code.language-mermaid, pre code[class*="mermaid"]');

            if (mermaidBlocks.length === 0) {
                console.log('No mermaid blocks found');
                return;
            }

            console.log('Found', mermaidBlocks.length, 'mermaid blocks');

            mermaidBlocks.forEach((block, index) => {
                const mermaidCode = block.textContent;
                const pre = block.parentElement;

                // Create a div for mermaid diagram
                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.textContent = mermaidCode;
                mermaidDiv.id = 'mermaid-diagram-' + index;

                // Replace the pre block with mermaid div
                pre.replaceWith(mermaidDiv);
            });

            // Run mermaid rendering
            window.mermaid.run({
                querySelector: '.mermaid'
            }).then(() => {
                console.log('Mermaid diagrams rendered successfully');
            }).catch(err => {
                console.error('Mermaid rendering error:', err);
            });
        }

        // Wait for mermaid to load before rendering
        if (window.mermaidReady) {
            renderMermaidDiagrams();
        } else {
            window.addEventListener('mermaidLoaded', renderMermaidDiagrams);
            // Fallback timeout
            setTimeout(renderMermaidDiagrams, 1000);
        }

        // Generate TOC from headings
        const tocList = document.getElementById('toc-list');
        const headings = contentDiv.querySelectorAll('h2, h3, h4');

        headings.forEach((heading, index) => {
            const id = 'heading-' + index;
            heading.id = id;

            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + id;
            a.textContent = heading.textContent;
            a.className = 'toc-' + heading.tagName.toLowerCase();

            li.appendChild(a);
            tocList.appendChild(li);
        });

        // Highlight active TOC item on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.id;
                    tocList.querySelectorAll('a').forEach(a => {
                        a.style.color = a.getAttribute('href') === '#' + id ? 'var(--primary)' : 'var(--text-secondary)';
                        a.style.fontWeight = a.getAttribute('href') === '#' + id ? '600' : '400';
                    });
                }
            });
        }, { threshold: 1.0 });

        headings.forEach(heading => observer.observe(heading));
    </script>
</body>
</html>