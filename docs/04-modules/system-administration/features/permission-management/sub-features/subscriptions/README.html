<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subscriptions Management - Carmen ERP Documentation</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/marked-mermaid@latest/dist/css/marked-mermaid.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked@latest/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@latest/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--bg-light);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: var(--primary);
            color: white;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .breadcrumb {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .breadcrumb a {
            color: var(--primary);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .back-link {
            display: inline-block;
            color: var(--primary);
            text-decoration: none;
            margin-bottom: 1rem;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .content {
            background: var(--bg-white);
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        h2 {
            font-size: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
            color: var(--text-primary);
        }

        h3 {
            font-size: 1.25rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        h4 {
            font-size: 1.125rem;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        p {
            margin-bottom: 1rem;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        code {
            background: var(--bg-light);
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-size: 0.875em;
            font-family: 'Monaco', 'Courier New', monospace;
        }

        pre {
            background: var(--text-primary);
            color: #f8fafc;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        pre code {
            background: none;
            padding: 0;
            color: inherit;
        }

        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
        }

        li {
            margin: 0.5rem 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border: 1px solid var(--border);
        }

        th {
            background: var(--bg-light);
            font-weight: 600;
        }

        blockquote {
            border-left: 4px solid var(--primary);
            padding-left: 1rem;
            margin: 1rem 0;
            color: var(--text-secondary);
        }

        img {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        .mermaid {
            margin: 1.5rem 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="section-badge">Application Modules</div>
        <div class="breadcrumb"><a href="../../index.html">Documentation</a> / <a href="../index.html">Application Modules</a> / System Administration / Features</div>
        <a href="../../index.html" class="back-link">← Back to Documentation Home</a>
        <div class="content" id="markdown-content"></div>
    </div>
    <script>
        const markdownContent = "# Subscriptions Management\n\n> **Feature:** Permission Management > Subscriptions\n> **Pages:** 2\n> **Status:** ✅ Production Ready\n\n---\n\n## Overview\n\nThe Subscriptions Management sub-feature provides comprehensive control over Carmen ERP subscription packages, feature activation, resource limits, billing information, and usage analytics. This system enables organizations to manage their subscription tier, activate/deactivate specific features, monitor resource usage, and handle billing seamlessly.\n\n### Key Features\n\n1. **Package Management** - Compare and switch between subscription tiers\n2. **Resource Activation** - Enable/disable individual features within subscription limits\n3. **Usage Monitoring** - Real-time tracking of resource consumption\n4. **Billing Management** - Payment methods, invoices, and billing information\n5. **Usage Analytics** - Historical usage data and trend analysis\n6. **Limit Enforcement** - Automatic feature gating based on subscription limits\n\n---\n\n## Page Structure\n\n### 1. Subscription Management Main Page\n**Route:** `/system-administration/permission-management/subscription`\n\n#### Layout\nThe page uses a tabbed interface with 4 main sections:\n- Packages\n- Resources\n- Billing\n- Analytics\n\n#### Tab 1: Packages\n\n**Purpose**: Compare subscription tiers and manage package selection\n\n**Components**:\n- **Current Subscription Card**\n  - Package name and tier\n  - Billing cycle (monthly/annual)\n  - Renewal date\n  - Status badge\n  - Usage summary\n\n- **Package Comparison Grid**\n  - 3-4 package cards (Starter, Professional, Enterprise, Custom)\n  - Feature comparison matrix\n  - Pricing information\n  - Highlight differences from current plan\n\n- **Package Selector**\n  - Interactive package cards\n  - Feature lists with checkmarks\n  - \"Upgrade\" / \"Downgrade\" buttons\n  - Custom package inquiry option\n\n**Features**:\n- Side-by-side package comparison\n- Upgrade/downgrade flows\n- Proration calculation\n- Trial period information\n- Contact sales for custom plans\n\n**User Actions**:\n- View package details\n- Compare features\n- Upgrade to higher tier\n- Downgrade to lower tier (with confirmation)\n- Request custom quote\n- View pricing details\n\n**Package Tiers**:\n\n```typescript\ninterface Package {\n  type: 'starter' | 'professional' | 'enterprise' | 'custom';\n  name: string;\n  price: {\n    monthly: number;\n    annual: number;\n    currency: string;\n  };\n  limits: {\n    users: number;\n    locations: number;\n    storage: number; // GB\n    apiCalls: number; // per month\n    transactions: number; // per month\n  };\n  features: string[];\n  support: {\n    level: string;\n    responseTime: string;\n    channels: string[];\n  };\n  highlighted?: boolean; // Recommended\n}\n```\n\n**Example Packages**:\n\n**Starter**:\n- Up to 10 users\n- 2 locations\n- 50 GB storage\n- 10,000 API calls/month\n- Basic features\n- Email support\n- $99/month or $950/year\n\n**Professional**:\n- Up to 50 users\n- 10 locations\n- 500 GB storage\n- 100,000 API calls/month\n- Advanced features\n- Priority support\n- $499/month or $4,800/year\n\n**Enterprise**:\n- Unlimited users\n- Unlimited locations\n- 5 TB storage\n- 1M API calls/month\n- All features\n- 24/7 dedicated support\n- Custom pricing\n\n#### Tab 2: Resources\n\n**Purpose**: Manage feature activation and resource limits\n\n**Components**:\n- **Resource Categories**\n  - Core Features\n  - Advanced Features\n  - Integrations\n  - Add-ons\n\n- **Resource Activation Cards**\n  - Feature name and description\n  - Toggle switch (enabled/disabled)\n  - Usage indicator\n  - Limit settings (if applicable)\n  - Availability in current package\n\n- **Resource Limits Configuration**\n  - User limit slider\n  - Storage limit slider\n  - API call limit input\n  - Transaction limit input\n  - Custom limits (if allowed)\n\n- **Usage Overview**\n  - Current usage vs. limits\n  - Progress bars for each resource\n  - Warning indicators (approaching limit)\n  - Upgrade prompts (if over limit)\n\n**Features**:\n- Enable/disable individual features\n- Adjust resource limits (within package constraints)\n- View feature dependencies\n- Monitor real-time usage\n- Upgrade prompts for premium features\n\n**User Actions**:\n- Toggle feature on/off\n- Adjust limits (if package allows)\n- View feature documentation\n- Check feature dependencies\n- Request limit increase\n\n**Resource Types**:\n\n```typescript\ninterface Resource {\n  id: string;\n  name: string;\n  description: string;\n  category: 'core' | 'advanced' | 'integration' | 'addon';\n  enabled: boolean;\n  availableIn: PackageType[];\n  limits?: {\n    type: 'users' | 'storage' | 'api_calls' | 'custom';\n    current: number;\n    max: number;\n    unit: string;\n  };\n  dependencies?: string[]; // Other resource IDs\n}\n```\n\n**Example Resources**:\n- **Core**: User Management, Inventory Management, Purchase Requests\n- **Advanced**: ABAC Policies, Workflow Automation, Advanced Analytics\n- **Integrations**: POS Integration, Accounting Software, Payment Gateways\n- **Add-ons**: Mobile App, API Access, Custom Reports\n\n#### Tab 3: Billing\n\n**Purpose**: Manage payment methods and billing information\n\n**Sections**:\n\n**Billing Information**\n- Company name\n- Billing email\n- Billing address\n- Tax ID / VAT number\n- Currency preference\n\n**Payment Methods**\n- Credit/debit card details\n  - Card type (Visa, Mastercard, Amex)\n  - Last 4 digits\n  - Expiry date\n  - Set as default option\n- Bank transfer information\n- Invoice payment option\n\n**Invoice Settings**\n- Invoice frequency (monthly, annual)\n- Invoice delivery (email, download)\n- Invoice format (PDF, CSV)\n- Auto-download enabled\n\n**Invoice History**\n- Table of past invoices\n- Columns: Invoice #, Date, Amount, Status, Actions\n- Download PDF\n- View details\n- Payment status (Paid, Pending, Overdue)\n\n**Features**:\n- Add/edit payment methods\n- Update billing address\n- Set default payment method\n- Manage invoice preferences\n- View payment history\n- Download invoices\n- Set up auto-payment\n\n**User Actions**:\n- Update billing information\n- Add new payment method\n- Remove payment method\n- Download invoice\n- View invoice details\n- Update invoice settings\n- Contact billing support\n\n**Data Models**:\n\n```typescript\ninterface BillingInformation {\n  company: string;\n  email: string;\n  address: {\n    line1: string;\n    line2?: string;\n    city: string;\n    state: string;\n    postalCode: string;\n    country: string;\n  };\n  taxId?: string;\n  currency: string;\n}\n\ninterface PaymentMethod {\n  id: string;\n  type: 'card' | 'bank_transfer' | 'invoice';\n  isDefault: boolean;\n  // Card specific\n  cardBrand?: string;\n  cardLast4?: string;\n  expiryMonth?: number;\n  expiryYear?: number;\n  // Bank transfer specific\n  accountNumber?: string;\n  routingNumber?: string;\n}\n\ninterface Invoice {\n  id: string;\n  number: string;\n  date: Date;\n  dueDate: Date;\n  amount: number;\n  currency: string;\n  status: 'paid' | 'pending' | 'overdue' | 'cancelled';\n  items: InvoiceItem[];\n  pdfUrl: string;\n}\n```\n\n#### Tab 4: Analytics\n\n**Purpose**: Monitor resource usage and analyze trends\n\n**Components**:\n\n**Usage Summary Cards**\n- Users (active users vs. limit)\n- Storage (used vs. total)\n- API Calls (this month)\n- Transactions (this month)\n- Locations (active vs. limit)\n\n**Usage Charts**\n- **User Growth**: Line chart showing active users over time\n- **Storage Consumption**: Area chart of storage usage\n- **API Usage**: Bar chart of API calls per day/week\n- **Feature Usage**: Pie chart of most-used features\n- **Location Activity**: Bar chart of activity per location\n\n**Usage Breakdown**\n- By module (which modules use most resources)\n- By user (top resource consumers)\n- By location (resource usage per location)\n- By feature (most/least used features)\n\n**Export Options**\n- Export data to CSV/Excel\n- Generate PDF report\n- Email report\n- Schedule automated reports\n\n**Time Period Selector**\n- Last 7 days\n- Last 30 days\n- Last 90 days\n- Custom date range\n\n**Features**:\n- Real-time usage monitoring\n- Historical usage trends\n- Usage forecasting\n- Anomaly detection\n- Usage alerts\n- Comparative analysis (period over period)\n\n**User Actions**:\n- Select time period\n- Filter by resource type\n- Export usage data\n- Schedule reports\n- Set usage alerts\n- View detailed breakdowns\n\n**Data Models**:\n\n```typescript\ninterface UsageMetrics {\n  period: {\n    start: Date;\n    end: Date;\n  };\n  users: {\n    total: number;\n    active: number;\n    limit: number;\n  };\n  storage: {\n    used: number; // GB\n    limit: number; // GB\n  };\n  apiCalls: {\n    count: number;\n    limit: number;\n  };\n  transactions: {\n    count: number;\n    limit: number;\n  };\n  byModule: Record<string, number>;\n  byLocation: Record<string, number>;\n  byFeature: Record<string, number>;\n}\n```\n\n### 2. Multiple Subscriptions Page\n**Route:** `/system-administration/permission-management/subscriptions`\n\n#### Purpose\nFor organizations managing multiple subscriptions (e.g., different divisions, subsidiaries)\n\n**Features**:\n- List of all subscriptions\n- Switch between subscriptions\n- Compare subscriptions\n- Consolidated billing\n- Cross-subscription analytics\n\n**Layout**:\n- Subscription cards grid\n- Quick filters (by status, package, division)\n- Consolidated usage summary\n- Bulk operations\n\n**Use Cases**:\n- Multi-division organizations\n- Franchise management\n- Holding companies\n- Agency managing client subscriptions\n\n---\n\n## Component Architecture\n\n### PackageSelector Component\n**File:** `components/permissions/subscription/package-selector.tsx`\n\n**Props**:\n- `packages`: Array of available packages\n- `currentSubscription`: Current subscription details\n- `onPackageSelect`: Callback when package selected\n- `onUpgrade`, `onDowngrade`: Callbacks for tier changes\n\n**Features**:\n- Package comparison grid\n- Feature highlights\n- Pricing display\n- Upgrade/downgrade buttons\n- Trial information\n\n### ResourceActivation Component\n**File:** `components/permissions/subscription/resource-activation.tsx`\n\n**Props**:\n- `package`: Current package details\n- `subscription`: Current subscription\n- `showAnalytics`: Show usage analytics\n- `onResourceToggle`: Callback for feature toggle\n- `onLimitUpdate`: Callback for limit changes\n\n**Features**:\n- Resource category organization\n- Toggle switches\n- Limit sliders\n- Usage progress bars\n- Dependency warnings\n\n### BillingPaymentInfo Component\n**File:** `components/permissions/subscription/billing-payment-info.tsx`\n\n**Props**:\n- `subscription`: Current subscription\n- `onPaymentMethodUpdate`: Callback for payment updates\n- `onBillingAddressUpdate`: Callback for address updates\n- `onInvoiceSettingsUpdate`: Callback for invoice settings\n- `onDownloadInvoice`: Callback for invoice download\n\n**Features**:\n- Billing form\n- Payment method management\n- Invoice list\n- Download functionality\n\n### UsageAnalytics Component\n**File:** `components/permissions/subscription/usage-analytics.tsx`\n\n**Props**:\n- `subscription`: Current subscription\n- `onExportData`: Callback for data export\n\n**Features**:\n- Usage charts (Recharts library)\n- Time period selector\n- Export functionality\n- Usage breakdown tables\n\n---\n\n## State Management\n\n### useSubscriptionStore (Zustand)\n\n```typescript\ninterface SubscriptionStore {\n  // State\n  subscription: Subscription | null;\n  packages: Package[];\n  usage: UsageMetrics | null;\n  isLoading: boolean;\n\n  // Actions\n  fetchSubscription: () => Promise<void>;\n  updatePackage: (packageType: PackageType) => Promise<void>;\n  toggleResource: (resourceId: string, enabled: boolean) => Promise<void>;\n  updateBilling: (billing: BillingInformation) => Promise<void>;\n  fetchUsage: (period: DateRange) => Promise<void>;\n\n  // Computed\n  getRemainingQuota: (resourceType: string) => number;\n  isFeatureAvailable: (featureId: string) => boolean;\n  isLimitExceeded: (resourceType: string) => boolean;\n}\n```\n\n---\n\n## API Integration\n\n### GET /api/subscriptions\nGet current subscription details\n\n**Response**:\n```json\n{\n  \"subscription\": Subscription,\n  \"availablePackages\": Package[],\n  \"usage\": UsageMetrics\n}\n```\n\n### PUT /api/subscriptions/package\nUpdate subscription package\n\n**Request**:\n```json\n{\n  \"packageType\": \"professional\",\n  \"billingCycle\": \"annual\"\n}\n```\n\n**Response**:\n```json\n{\n  \"subscription\": Subscription,\n  \"prorationAmount\": 150.00,\n  \"effectiveDate\": \"2025-02-01\"\n}\n```\n\n### POST /api/subscriptions/resources\nToggle resource activation\n\n**Request**:\n```json\n{\n  \"resourceId\": \"pos-integration\",\n  \"enabled\": true\n}\n```\n\n### PUT /api/subscriptions/billing\nUpdate billing information\n\n**Request**: `BillingInformation`\n\n### GET /api/subscriptions/usage\nGet usage metrics\n\n**Query**: `period=last_30_days`\n\n**Response**: `UsageMetrics`\n\n### GET /api/subscriptions/invoices\nList invoices\n\n**Response**: `Invoice[]`\n\n### GET /api/subscriptions/invoices/:id/download\nDownload invoice PDF\n\n---\n\n## Business Rules\n\n### Package Changes\n\n1. **Upgrade Immediate**: Upgrades take effect immediately with prorated charges\n2. **Downgrade Delayed**: Downgrades take effect at next renewal date\n3. **Feature Retention**: Downgrading disables features not in new package\n4. **Data Retention**: All data preserved during downgrade (but may be inaccessible)\n5. **Trial Period**: 14-day trial for Professional/Enterprise packages\n\n### Resource Limits\n\n1. **Soft Limits**: Warning at 80% usage\n2. **Hard Limits**: Features disabled at 100% usage\n3. **Grace Period**: 7-day grace period for billing failures\n4. **Overage Charges**: Some resources allow overage with additional charges\n5. **Custom Limits**: Enterprise plans can request custom limits\n\n### Billing\n\n1. **Auto-Renewal**: Subscriptions auto-renew unless cancelled\n2. **Cancellation**: 30-day notice required for annual plans\n3. **Refund Policy**: Pro-rated refunds for annual plans\n4. **Payment Retry**: 3 automatic retry attempts for failed payments\n5. **Suspension**: Account suspended after 7 days of unpaid invoices\n\n---\n\n## User Guide\n\n### Upgrading Package\n\n1. Navigate to Subscription → Packages\n2. Review available packages\n3. Click \"Upgrade\" on desired package\n4. Review changes and pricing\n5. Confirm upgrade\n6. Payment processed immediately\n7. New features activated\n\n### Managing Resources\n\n1. Navigate to Subscription → Resources\n2. Browse resource categories\n3. Toggle features on/off\n4. Adjust limits (if allowed)\n5. Save changes\n6. Features activate immediately\n\n### Updating Billing Information\n\n1. Navigate to Subscription → Billing\n2. Click \"Edit Billing Information\"\n3. Update company details\n4. Update billing address\n5. Save changes\n6. Confirmation email sent\n\n### Viewing Usage Analytics\n\n1. Navigate to Subscription → Analytics\n2. Select time period\n3. View usage charts\n4. Export data if needed\n5. Set up usage alerts\n6. Schedule automated reports\n\n---\n\n## Troubleshooting\n\n### Issue: Feature not activating\n\n**Solutions**:\n- Check if feature available in current package\n- Verify subscription status is active\n- Check if limit has been reached\n- Clear cache and retry\n- Contact support if issue persists\n\n### Issue: Payment failed\n\n**Solutions**:\n- Verify payment method is valid\n- Check card expiry date\n- Ensure sufficient funds\n- Update billing address\n- Try alternative payment method\n- Contact billing support\n\n### Issue: Usage exceeds limit\n\n**Solutions**:\n- Review usage analytics\n- Identify high-usage areas\n- Optimize resource consumption\n- Upgrade to higher tier\n- Request temporary limit increase\n- Enable overage charges\n\n---\n\n## Screenshots\n\nSee [screenshots directory](./screenshots/) for visual examples.\n\n---\n\n**Last Updated:** 2025-01-17\n**Version:** 1.0.0\n";

        // Initialize mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });

        // Configure marked
        marked.setOptions({
            highlight: function(code, lang) {
                return code;
            },
            breaks: true,
            gfm: true
        });

        // Render markdown
        document.getElementById('markdown-content').innerHTML = marked.parse(markdownContent);

        // Render mermaid diagrams
        mermaid.contentLoaded();
    </script>
</body>
</html>