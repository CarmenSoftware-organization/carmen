<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Currency Management & Exchange Rates - Carmen ERP Documentation</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/marked-mermaid@latest/dist/css/marked-mermaid.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked@latest/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@latest/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--bg-light);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: var(--primary);
            color: white;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .breadcrumb {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .breadcrumb a {
            color: var(--primary);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .back-link {
            display: inline-block;
            color: var(--primary);
            text-decoration: none;
            margin-bottom: 1rem;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .content {
            background: var(--bg-white);
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        h2 {
            font-size: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
            color: var(--text-primary);
        }

        h3 {
            font-size: 1.25rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        h4 {
            font-size: 1.125rem;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        p {
            margin-bottom: 1rem;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        code {
            background: var(--bg-light);
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-size: 0.875em;
            font-family: 'Monaco', 'Courier New', monospace;
        }

        pre {
            background: var(--text-primary);
            color: #f8fafc;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        pre code {
            background: none;
            padding: 0;
            color: inherit;
        }

        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
        }

        li {
            margin: 0.5rem 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border: 1px solid var(--border);
        }

        th {
            background: var(--bg-light);
            font-weight: 600;
        }

        blockquote {
            border-left: 4px solid var(--primary);
            padding-left: 1rem;
            margin: 1rem 0;
            color: var(--text-secondary);
        }

        img {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        .mermaid {
            margin: 1.5rem 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="section-badge">Application Modules</div>
        <div class="breadcrumb"><a href="../../index.html">Documentation</a> / <a href="../index.html">Application Modules</a> / Finance / Features</div>
        <a href="../../index.html" class="back-link">← Back to Documentation Home</a>
        <div class="content" id="markdown-content"></div>
    </div>
    <script>
        const markdownContent = "# Currency Management & Exchange Rates\n\n> **Features:** Finance > Currency Management & Exchange Rates\n> **Pages:** 4 (2 Currency + 2 Exchange Rates)\n> **Status:** ✅ Production Ready\n\n---\n\n## Overview\n\nCurrency Management and Exchange Rates provide comprehensive multi-currency support for Carmen ERP, enabling international operations with automatic currency conversion, real-time exchange rate tracking, and accurate financial reporting across multiple currencies.\n\n---\n\n# Currency Management\n\n## Overview\n\nConfigure and manage all currencies used in the system, including activation controls, currency descriptions, and integration with transactions across all modules.\n\n### Page Structure\n\n**Route:** `/finance/currency-management`\n\n---\n\n## Data Model\n\n```typescript\ninterface Currency {\n  // Identity\n  code: string; // ISO 4217 (3-letter code: USD, EUR, GBP)\n  description: string; // Full currency name\n  symbol?: string; // Currency symbol ($, €, £)\n\n  // Configuration\n  active: boolean; // Enable/disable for transactions\n  decimalPlaces?: number; // Decimal precision (default: 2)\n\n  // Metadata\n  createdAt: string;\n  updatedAt: string;\n  createdBy: string;\n  lastModifiedBy: string;\n}\n\n// Example Currencies\nconst currencies: Currency[] = [\n  {\n    code: 'USD',\n    description: 'United States Dollar',\n    symbol: '$',\n    active: true,\n    decimalPlaces: 2\n  },\n  {\n    code: 'EUR',\n    description: 'Euro',\n    symbol: '€',\n    active: true,\n    decimalPlaces: 2\n  },\n  {\n    code: 'JPY',\n    description: 'Japanese Yen',\n    symbol: '¥',\n    active: true,\n    decimalPlaces: 0\n  },\n  {\n    code: 'GBP',\n    description: 'British Pound Sterling',\n    symbol: '£',\n    active: true,\n    decimalPlaces: 2\n  }\n];\n```\n\n---\n\n## Features & Functionality\n\n### 1. Currency List View\n\n**Columns:**\n- Selection checkbox (for bulk operations)\n- **Currency Code**: ISO 4217 code\n- **Currency Description**: Full name\n- **Active**: Status toggle checkbox\n- **Actions**: Edit/Delete options\n\n**Features:**\n- Sortable columns\n- Multi-select for bulk operations\n- Inline activation toggle\n- Real-time search filtering\n- Active-only filter\n\n### 2. Search & Filter\n\n**Search:**\n- Search by currency code\n- Search by description\n- Real-time filtering\n- Case-insensitive\n\n**Filter:**\n- \"Show Active\" checkbox\n- Filter active/inactive currencies\n- Combined with search\n\n### 3. Currency Operations\n\n**Create Currency:**\n1. Click \"Create\" button\n2. Enter currency code (ISO 4217)\n3. Enter description\n4. Set active status\n5. Save\n\n**Activate/Deactivate:**\n- Toggle checkbox in Active column\n- Immediate update\n- Confirmation for deactivation if currency in use\n\n**Delete Currency:**\n1. Select currencies via checkbox\n2. Click \"Delete\" button\n3. Confirmation dialog\n4. Delete if no transactions exist\n\n### 4. Bulk Operations\n\n**Actions:**\n- Bulk activate\n- Bulk deactivate\n- Bulk delete\n- Bulk export\n\n**Print:**\n- Print currency list\n- PDF export\n- Filtered results\n\n---\n\n## Business Rules\n\n### Currency Validation\n\n1. **ISO 4217 Compliance**: Currency code must be valid ISO 4217 code\n2. **Unique Codes**: No duplicate currency codes allowed\n3. **Active Check**: At least one currency must be active (typically base currency)\n4. **Delete Protection**: Cannot delete currency with existing transactions\n5. **Deactivation Warning**: Warn if deactivating currency with pending transactions\n\n### Currency Configuration\n\n1. **Base Currency**: System designates one base currency (often USD)\n2. **Decimal Places**: Configurable per currency (JPY = 0, most others = 2)\n3. **Symbol Display**: Optional currency symbol for UI display\n4. **Description Required**: Full currency name mandatory\n\n### System Integration\n\n1. **Default Currency**: New transactions default to base currency\n2. **Multi-Currency Transactions**: Can create transactions in any active currency\n3. **Reporting**: All reports can display in base currency or transaction currency\n4. **Exchange Rate Linkage**: Active currencies require exchange rates\n\n---\n\n# Exchange Rate Management\n\n## Overview\n\nManage exchange rates for currency conversion, supporting both manual entry and automated updates from external sources.\n\n### Page Structure\n\n**Route:** `/finance/exchange-rates`\n\n---\n\n## Data Model\n\n```typescript\ninterface ExchangeRate {\n  // Identity\n  code: string; // Currency code (foreign currency)\n  name: string; // Currency full name\n\n  // Rate Information\n  rate: number; // Exchange rate (6 decimal precision)\n  baseCurrency: string; // Base currency (e.g., 'USD')\n  rateType: 'manual' | 'automatic' | 'api';\n\n  // Temporal\n  effectiveDate: string; // When rate becomes active\n  expiryDate?: string; // When rate expires (optional)\n  lastUpdated: string; // Last update timestamp\n\n  // Source\n  source?: string; // Rate provider (e.g., 'Central Bank', 'XE.com')\n  updatedBy?: string; // User who updated (for manual)\n\n  // Metadata\n  historical: boolean; // Is this a historical rate?\n}\n\n// Example Exchange Rates\nconst exchangeRates: ExchangeRate[] = [\n  {\n    code: \"USD\",\n    name: \"United States Dollar\",\n    rate: 1.000000,\n    baseCurrency: \"USD\",\n    rateType: \"manual\",\n    effectiveDate: \"2023-07-01\",\n    lastUpdated: \"2023-07-01\",\n    historical: false\n  },\n  {\n    code: \"EUR\",\n    name: \"Euro\",\n    rate: 0.920000,\n    baseCurrency: \"USD\",\n    rateType: \"api\",\n    effectiveDate: \"2023-07-01\",\n    lastUpdated: \"2023-07-01\",\n    source: \"ECB\",\n    historical: false\n  },\n  {\n    code: \"JPY\",\n    name: \"Japanese Yen\",\n    rate: 144.500000,\n    baseCurrency: \"USD\",\n    rateType: \"api\",\n    effectiveDate: \"2023-07-01\",\n    lastUpdated: \"2023-07-01\",\n    source: \"BOJ\",\n    historical: false\n  }\n];\n```\n\n---\n\n## Features & Functionality\n\n### 1. Exchange Rate Viewer\n\n**Columns:**\n- **Currency Code**: ISO code\n- **Currency Name**: Full name\n- **Rate**: Exchange rate (6 decimals)\n- **Last Updated**: Timestamp\n- **Actions**: Edit/Delete/History\n\n**Display Features:**\n- Current rates only (default)\n- Historical rates view (optional)\n- Color-coded rate changes (increase/decrease)\n- Sortable by any column\n\n### 2. Rate Entry Methods\n\n**Method 1: Manual Entry**\n1. Click \"Add Rate\" button\n2. Select currency\n3. Enter rate (6 decimal places)\n4. Set effective date\n5. Optional: Add source/notes\n6. Save\n\n**Method 2: CSV Import**\n1. Click \"Import CSV\" button\n2. Download template (optional)\n3. Prepare CSV file:\n   ```csv\n   Currency Code,Rate,Effective Date,Source\n   EUR,0.920000,2023-07-01,ECB\n   JPY,144.500000,2023-07-01,BOJ\n   GBP,0.790000,2023-07-01,BoE\n   ```\n4. Upload file\n5. Validate and preview\n6. Confirm import\n\n**Method 3: API Integration (Future)**\n- Configure API provider\n- Schedule automatic updates\n- Real-time rate fetching\n\n### 3. Search & Filter\n\n**Search:**\n- Currency code\n- Currency name\n- Quick lookup\n\n**Filter:**\n- Date range\n- Rate type (manual/automatic/api)\n- Currency group (e.g., European, Asian)\n- Active currencies only\n\n### 4. Rate History\n\n**Historical Tracking:**\n- View all historical rates for a currency\n- Compare rates over time\n- Rate change percentage\n- Trend visualization\n\n**History Table:**\n- Effective date\n- Rate value\n- Rate change (%)\n- Source\n- Updated by\n- Timestamp\n\n---\n\n## Currency Conversion\n\n### Conversion Logic\n\n```typescript\nfunction convertCurrency(\n  amount: number,\n  fromCurrency: string,\n  toCurrency: string,\n  exchangeRates: ExchangeRate[]\n): number {\n  // Both currencies are the same\n  if (fromCurrency === toCurrency) {\n    return amount;\n  }\n\n  // Get exchange rates\n  const fromRate = exchangeRates.find(r => r.code === fromCurrency)?.rate || 1;\n  const toRate = exchangeRates.find(r => r.code === toCurrency)?.rate || 1;\n\n  // Convert to base currency first, then to target currency\n  const baseAmount = amount / fromRate;\n  const convertedAmount = baseAmount * toRate;\n\n  return convertedAmount;\n}\n\n// Example usage\nconst usdAmount = 100;\nconst eurRate = 0.92; // 1 USD = 0.92 EUR\nconst eurAmount = convertCurrency(usdAmount, 'USD', 'EUR', exchangeRates);\n// Result: 92.00 EUR\n```\n\n### Conversion Rules\n\n1. **Base Currency**: All conversions go through base currency\n2. **Rate Precision**: Maintain 6 decimal precision during calculation\n3. **Rounding**: Round final result to currency decimal places\n4. **Rate Date**: Use rate effective on transaction date\n5. **Missing Rate**: Error if no rate available for transaction date\n\n---\n\n## Business Rules\n\n### Exchange Rate Management\n\n1. **Base Currency Rate**: Base currency always has rate of 1.000000\n2. **Rate Precision**: All rates stored with 6 decimal places\n3. **Effective Date Required**: Every rate must have effective date\n4. **Rate History**: System maintains complete rate history\n5. **No Retroactive Changes**: Cannot modify historical rates (create new rate instead)\n\n### Rate Updates\n\n1. **Manual Override**: Manual rates take precedence over automatic\n2. **Update Frequency**:\n   - Manual: On-demand\n   - API: Configurable (hourly, daily, weekly)\n3. **Rate Validation**: Warn if rate change exceeds threshold (e.g., >10%)\n4. **Source Tracking**: Record source of all rate updates\n\n### Transaction Impact\n\n1. **Transaction Currency**: Transactions store original currency amount\n2. **Base Currency Equivalent**: Also store base currency amount at transaction time\n3. **Rate Locking**: Transaction uses rate from transaction date\n4. **Recalculation**: Can recalculate base amounts if rate corrected\n\n---\n\n## Integration Points\n\n### Multi-Currency Transactions\n\n**Purchase Orders:**\n```\nPO in EUR → Exchange Rate (EUR to USD) → USD Equivalent\n```\n\n**Vendor Invoices:**\n```\nInvoice in GBP → Exchange Rate (GBP to USD) → USD Posting\n```\n\n**Sales:**\n```\nSale in JPY → Exchange Rate (JPY to USD) → USD Revenue\n```\n\n### Financial Reporting\n\n**Currency Presentation:**\n- Transactional Currency (original)\n- Base Currency (converted)\n- Reporting Currency (optional third currency)\n\n**Exchange Gain/Loss:**\n- Track realized gains/losses on settlement\n- Track unrealized gains/losses on open items\n- Automatic GL posting for gains/losses\n\n---\n\n## API Endpoints\n\n```http\n# Currency Management\nGET /api/finance/currencies\nPOST /api/finance/currencies\nPUT /api/finance/currencies/:code\nDELETE /api/finance/currencies/:code\nPATCH /api/finance/currencies/:code/activate\nPATCH /api/finance/currencies/:code/deactivate\n\n# Exchange Rates\nGET /api/finance/exchange-rates\nPOST /api/finance/exchange-rates\nPUT /api/finance/exchange-rates/:id\nDELETE /api/finance/exchange-rates/:id\n\n# Rate Lookup\nGET /api/finance/exchange-rates/current\nGET /api/finance/exchange-rates/history/:code\nGET /api/finance/exchange-rates/on-date?date=YYYY-MM-DD\nPOST /api/finance/exchange-rates/convert\n\n# Bulk Operations\nPOST /api/finance/exchange-rates/import\nGET /api/finance/exchange-rates/export\nPOST /api/finance/exchange-rates/update-all\n```\n\n---\n\n## User Guide\n\n### Adding a Currency\n\n1. Navigate to Currency Management\n2. Click \"Create\" button\n3. Enter currency code (e.g., CAD)\n4. Enter description (e.g., Canadian Dollar)\n5. Check \"Active\" checkbox\n6. Save\n\n### Updating Exchange Rates\n\n**Single Rate:**\n1. Navigate to Exchange Rates\n2. Find currency row\n3. Click edit icon\n4. Enter new rate\n5. Save\n\n**Bulk Update via CSV:**\n1. Click \"Import CSV\"\n2. Download template\n3. Fill in rates\n4. Upload file\n5. Review preview\n6. Confirm\n\n### Viewing Rate History\n\n1. Navigate to Exchange Rates\n2. Click on currency row\n3. Select \"View History\"\n4. Browse historical rates\n5. Export history if needed\n\n---\n\n## Troubleshooting\n\n### Issue: Currency Won't Delete\n**Cause**: Currency has associated transactions\n**Solution**: Deactivate currency instead of deleting\n\n### Issue: Exchange Rate Not Found\n**Cause**: No rate configured for transaction date\n**Solution**: Add historical rate for that date or use current rate\n\n### Issue: CSV Import Fails\n**Cause**: Invalid format or missing required fields\n**Solution**: Download template, verify data format, check currency codes\n\n### Issue: Rate Conversion Incorrect\n**Cause**: Using wrong base currency or outdated rate\n**Solution**: Verify base currency setting, check rate effective dates\n\n---\n\n## Best Practices\n\n### Currency Setup\n\n1. **Complete Setup First**: Configure all currencies before transactions\n2. **ISO Compliance**: Always use ISO 4217 codes\n3. **Descriptive Names**: Use full currency names\n4. **Active Management**: Keep inactive list clean\n\n### Exchange Rate Management\n\n1. **Daily Updates**: Update rates daily for accuracy\n2. **Rate Validation**: Cross-check rates with official sources\n3. **Historical Preservation**: Never delete historical rates\n4. **Audit Trail**: Review rate changes regularly\n5. **Backup**: Export rates weekly for backup\n\n### Multi-Currency Operations\n\n1. **Consistent Base**: Use one base currency across organization\n2. **Rate Documentation**: Document rate sources and methodology\n3. **Threshold Alerts**: Set alerts for significant rate changes\n4. **Reconciliation**: Regular forex reconciliation\n5. **Reporting**: Use consistent currency for executive reports\n\n---\n\n## Future Enhancements\n\n**Planned Features:**\n- Real-time API integration with forex providers\n- Automatic rate alerts for significant changes\n- Currency basket support\n- Forward contract management\n- Hedging recommendations\n- Multi-base currency support\n- Custom conversion rules\n- Advanced analytics and trending\n\n---\n\n**Last Updated:** 2025-01-17\n**Version:** 1.0.0\n";

        // Initialize mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });

        // Configure marked
        marked.setOptions({
            highlight: function(code, lang) {
                return code;
            },
            breaks: true,
            gfm: true
        });

        // Render markdown
        document.getElementById('markdown-content').innerHTML = marked.parse(markdownContent);

        // Render mermaid diagrams
        mermaid.contentLoaded();
    </script>
</body>
</html>