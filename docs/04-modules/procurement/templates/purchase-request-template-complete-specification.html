<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purchase Request Template - Complete Technical Specification - Carmen ERP Documentation</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/marked-mermaid@latest/dist/css/marked-mermaid.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked@latest/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@latest/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--bg-light);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: var(--primary);
            color: white;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .breadcrumb {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .breadcrumb a {
            color: var(--primary);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .back-link {
            display: inline-block;
            color: var(--primary);
            text-decoration: none;
            margin-bottom: 1rem;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .content {
            background: var(--bg-white);
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow);
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        h2 {
            font-size: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
            color: var(--text-primary);
        }

        h3 {
            font-size: 1.25rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        h4 {
            font-size: 1.125rem;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        p {
            margin-bottom: 1rem;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        code {
            background: var(--bg-light);
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-size: 0.875em;
            font-family: 'Monaco', 'Courier New', monospace;
        }

        pre {
            background: var(--text-primary);
            color: #f8fafc;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        pre code {
            background: none;
            padding: 0;
            color: inherit;
        }

        ul, ol {
            margin: 1rem 0;
            padding-left: 2rem;
        }

        li {
            margin: 0.5rem 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border: 1px solid var(--border);
        }

        th {
            background: var(--bg-light);
            font-weight: 600;
        }

        blockquote {
            border-left: 4px solid var(--primary);
            padding-left: 1rem;
            margin: 1rem 0;
            color: var(--text-secondary);
        }

        img {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem;
            margin: 1rem 0;
        }

        .mermaid {
            margin: 1.5rem 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="section-badge">Application Modules</div>
        <div class="breadcrumb"><a href="../../index.html">Documentation</a> / <a href="../index.html">Application Modules</a> / Procurement / Templates</div>
        <a href="../../index.html" class="back-link">← Back to Documentation Home</a>
        <div class="content" id="markdown-content"></div>
    </div>
    <script>
        const markdownContent = "# Purchase Request Template - Complete Technical Specification\n\n## Table of Contents\n1. [Module Overview](#module-overview)\n2. [System Architecture](#system-architecture)\n3. [Site Map & Navigation](#site-map--navigation)\n4. [Component Documentation](#component-documentation)\n5. [Page Specifications](#page-specifications)\n6. [Data Models & Types](#data-models--types)\n7. [Business Logic](#business-logic)\n8. [Integration Points](#integration-points)\n9. [User Workflows](#user-workflows)\n\n## Module Overview\n\n### Purpose\nThe Purchase Request Template (PRT) module provides a streamlined way to create, manage, and utilize reusable templates for purchase requests. This module enhances operational efficiency by allowing users to pre-configure standard purchase requests with predefined items, quantities, pricing, and approval workflows.\n\n### Key Features\n- **Template Management**: Create, edit, clone, and delete purchase request templates\n- **Item Management**: Add, modify, and organize template items with detailed specifications\n- **Multi-view Interface**: Switch between table and card views for optimal workflow\n- **Advanced Filtering**: Search and filter templates by various criteria\n- **Bulk Operations**: Clone, delete, and set default templates in batch\n- **Pricing Calculations**: Automatic calculation of taxes, discounts, and totals\n- **Department-specific Templates**: Organize templates by department and budget codes\n- **Workflow Integration**: Templates inherit approval workflows and department settings\n\n### Technology Stack\n- **Framework**: Next.js 14 with App Router\n- **Language**: TypeScript with strict mode\n- **Styling**: Tailwind CSS + Shadcn/ui components\n- **State Management**: React useState for local state\n- **Form Handling**: React Hook Form + Zod validation\n- **Data Structure**: Mock data with future API readiness\n\n## System Architecture\n\n### Route Structure\n```\n/procurement/purchase-request-templates/\n├── page.tsx                    # Main template list page\n├── [id]/page.tsx              # Template detail/edit page\n├── components/\n│   ├── ItemsTab.tsx           # Items management tab\n│   ├── template-items-table.tsx   # Items table component\n│   └── item-form-dialog.tsx   # Item add/edit dialog\n└── types/\n    └── template-items.ts      # Type definitions and mock data\n```\n\n### Component Hierarchy\n```\nPurchaseRequestTemplatesPage\n├── PRListTemplate (shared component)\n│   ├── Search & Filter Controls\n│   ├── Action Buttons\n│   ├── View Toggle (Table/Card)\n│   ├── Table View\n│   │   └── TemplateItemsTable\n│   └── Card View\n│       └── Template Cards\n└── AlertDialog (Delete Confirmation)\n\nPurchaseRequestTemplateDetailPage\n├── PRDetailTemplate (shared component)\n│   ├── Header with Actions\n│   ├── Form Fields\n│   └── Tab Container\n│       ├── ItemsTab\n│       │   ├── TemplateItemsTable\n│       │   └── ItemFormDialog\n│       ├── BudgetsTab (placeholder)\n│       └── ActivityTab (placeholder)\n```\n\n## Site Map & Navigation\n\n```mermaid\ngraph TD\n    A[Purchase Request Templates Landing] --> B[PRT List View - Table]\n    A --> C[PRT List View - Card]\n\n    B --> D[New Template Creation]\n    C --> D\n\n    D --> E[Template Detail Page]\n\n    B --> F[Template Detail View]\n    C --> F\n    F --> E\n\n    E --> G[Items Tab]\n    E --> H[Budgets Tab]\n    E --> I[Activity Tab]\n\n    G --> J[Add Item Dialog]\n    G --> K[Edit Item Dialog]\n    G --> L[Delete Item Confirmation]\n\n    E --> M[Clone Template]\n    E --> N[Set as Default]\n    E --> O[Delete Template]\n\n    F --> P[Edit Mode]\n    P --> Q[Save Changes]\n    P --> R[Cancel Changes]\n\n    B --> S[Bulk Operations]\n    C --> S\n    S --> T[Bulk Delete]\n    S --> U[Bulk Clone]\n    S --> V[Set Default]\n```\n\n## Component Documentation\n\n### Main Pages\n\n#### 1. PurchaseRequestTemplatesPage (`page.tsx`)\n**Purpose**: Main landing page for template management\n**Features**:\n- Dual view modes (table/card)\n- Search and filtering\n- Bulk operations\n- Template CRUD operations\n\n**Key State Variables**:\n```typescript\nconst [viewMode, setViewMode] = useState<'table' | 'card'>('table')\nconst [selectedItems, setSelectedItems] = useState<string[]>([])\nconst [templates, setTemplates] = useState<PurchaseRequest[]>(templateData)\nconst [deleteDialogOpen, setDeleteDialogOpen] = useState(false)\n```\n\n**Core Functions**:\n- `handleView(id)`: Navigate to template detail view\n- `handleEdit(id)`: Navigate to template edit mode\n- `handleDelete(id)`: Trigger delete confirmation\n- `handleCreateNew()`: Navigate to new template creation\n- `handleSelectItem(id)`: Toggle item selection\n- `handleSelectAll(checked)`: Select/deselect all items\n\n#### 2. PurchaseRequestTemplateDetailPage (`[id]/page.tsx`)\n**Purpose**: Template detail view and editing interface\n**Features**:\n- Multi-mode operation (view/edit/add)\n- Tab-based interface\n- Template cloning and default setting\n- Breadcrumb navigation\n\n**URL Patterns**:\n- View: `/purchase-request-templates/{id}?mode=view`\n- Edit: `/purchase-request-templates/{id}?mode=edit`\n- New: `/purchase-request-templates/new?mode=add`\n\n**Tab Structure**:\n```typescript\nconst tabs = [\n  { value: \"items\", label: \"Items\", content: <ItemsTab /> },\n  { value: \"budgets\", label: \"Budgets\", content: <BudgetsTab /> },\n  { value: \"activity\", label: \"Activity\", content: <ActivityTab /> }\n]\n```\n\n### Component Library\n\n#### 3. ItemsTab (`components/ItemsTab.tsx`)\n**Purpose**: Manages template items within the detail page\n**Features**:\n- Item CRUD operations\n- Mode-aware display (view/edit)\n- Delete confirmations\n- Integration with item table and dialog\n\n**State Management**:\n```typescript\nconst [items, setItems] = useState<TemplateItem[]>(initialItems)\nconst [formOpen, setFormOpen] = useState(false)\nconst [selectedItem, setSelectedItem] = useState<TemplateItem | null>(null)\n```\n\n#### 4. TemplateItemsTable (`components/template-items-table.tsx`)\n**Purpose**: Displays template items in tabular format\n**Features**:\n- Responsive table layout\n- Action buttons per row\n- Mode-aware display\n- Sorting and data presentation\n\n**Column Structure**:\n- Item Code\n- Description\n- UOM (Unit of Measure)\n- Quantity\n- Unit Price\n- Total Amount\n- Budget Code\n- Account Code\n- Department\n- Actions (Edit/Delete)\n\n#### 5. ItemFormDialog (`components/item-form-dialog.tsx`)\n**Purpose**: Add/edit individual template items\n\n![Add Item Dialog](./screenshots/prt-add-item-dialog.png)\n\n**Features**:\n- Comprehensive form validation\n- Real-time calculations\n- Multi-section layout\n- Currency and tax handling\n\n**Form Sections**:\n1. **Basic Information**: Item code, description\n2. **Quantity and UOM**: Measurements and units\n3. **Pricing**: Currency, rates, calculations\n4. **Additional Information**: Budget codes, departments\n\n**Validation Schema**:\n```typescript\nconst formSchema = z.object({\n  itemCode: z.string().min(1, \"Item code is required\"),\n  description: z.string().min(1, \"Description is required\"),\n  uom: z.string().min(1, \"UOM is required\"),\n  quantity: z.number().min(0, \"Quantity must be positive\"),\n  unitPrice: z.number().min(0, \"Unit price must be positive\"),\n  // ... additional fields\n})\n```\n\n## Page Specifications\n\n### Template List Page\n\n![Purchase Request Templates List - Table View](./screenshots/prt-list-page-table-view.png)\n\n![Purchase Request Templates List - Card View](./screenshots/prt-list-page-card-view.png)\n\n#### Layout Structure\n```\nHeader Section\n├── Page Title: \"Purchase Request Templates\"\n├── Action Buttons: [New Template] [Export] [Print]\n└── View Toggle: [Table] [Card]\n\nFilter Section\n├── Search Bar: \"Search templates...\"\n├── Type Filter: Dropdown\n├── Status Filter: Dropdown\n└── Advanced Filter: Modal\n\nContent Section\n├── Selection Controls: [Select All] [Bulk Actions]\n├── Table View\n│   ├── Headers: Checkbox, Template, Type, Department, Requestor, Amount, Status, Actions\n│   └── Rows: Template data with action buttons\n└── Card View\n    ├── Template Cards (3-column grid)\n    └── Card Actions: View, Edit, Delete\n\nPagination Section\n├── Page Info: \"Showing X of Y\"\n├── Navigation: [First] [Previous] [Next] [Last]\n└── Items per page selector\n```\n\n#### Filter Options\n- **Type Filter**: All Types, General Purchase, Asset Purchase\n- **Status Filter**: All Statuses, Draft, In Progress, Completed\n- **Advanced Filters**: Custom field-based filtering\n\n#### Bulk Operations\n- Delete Selected\n- Clone Selected\n- Set as Default\n\n### Template Detail Page\n\n![Purchase Request Template Detail - Items Tab](./screenshots/prt-detail-page-items-tab.png)\n\n![Purchase Request Template Detail - Edit Mode](./screenshots/prt-detail-page-edit-mode.png)\n\n#### Header Section\n```\nNavigation: [Back to Templates]\nTitle: Template Name + Badge (Template Number)\nMetadata: Last modified date\nActions: [Set as Default] [Clone Template]\nMode Toggle: [View] [Edit]\n```\n\n#### Form Fields (Header)\n- Template Name/Description\n- Reference Number (auto-generated)\n- Type (General Purchase/Asset Purchase)\n- Department\n- Requestor\n- Date Created/Modified\n\n#### Tab Interface\n\n**Items Tab**:\n- Template Items Table\n- Add Item Button (edit mode)\n- Item Actions: View, Edit, Delete\n\n**Budgets Tab**: (Placeholder)\n- Budget allocation display\n- Budget code management\n\n**Activity Tab**: (Placeholder)\n- Template usage history\n- Modification log\n\n## Data Models & Types\n\n### TemplateItem Interface\n```typescript\nexport interface TemplateItem {\n  id: string\n  itemCode: string\n  description: string\n  uom: string // Unit of Measure\n  quantity: number\n  unitPrice: number\n  totalAmount: number\n  budgetCode: string\n  accountCode: string\n  department: string\n  taxCode: string\n  currency: CurrencyCode\n}\n```\n\n### Extended Item Properties (Form)\n```typescript\ninterface ItemFormData {\n  // Basic fields from TemplateItem\n  ...TemplateItem\n\n  // Additional form fields\n  currencyRate: number\n  taxIncluded: boolean\n  discountRate: number\n  taxRate: number\n  adjustments: {\n    discount: boolean\n    tax: boolean\n  }\n}\n```\n\n### Template Structure\nTemplates inherit from the base `PurchaseRequest` type:\n```typescript\ninterface Template extends PurchaseRequest {\n  // Inherited fields:\n  // id, refNumber, description, type, status\n  // requestor, department, date, totalAmount\n\n  // Template-specific behavior:\n  // - Used as basis for new purchase requests\n  // - Can be set as default for departments\n  // - Contains predefined items and approval workflows\n}\n```\n\n## Business Logic\n\n### Template Operations\n\n#### Create Template\n1. Navigate to new template page\n2. Fill template header information\n3. Add template items via Items tab\n4. Configure budget and account codes\n5. Save template (generates reference number)\n\n#### Clone Template\n1. Select existing template\n2. Click \"Clone Template\" action\n3. System creates copy with new ID\n4. User can modify cloned template\n5. Save with new reference number\n\n#### Set as Default\n1. Select template for department\n2. Mark as default template\n3. New purchase requests in department auto-populate from default template\n\n### Item Calculations\n\n#### Price Calculations\n```typescript\nconst baseAmount = quantity * unitPrice\nconst discountAmount = baseAmount * (discountRate / 100)\nconst netAmount = baseAmount - discountAmount\nconst taxAmount = netAmount * (taxRate / 100)\nconst totalAmount = netAmount + taxAmount\n```\n\n#### Multi-Currency Support\n- Templates support multiple currencies\n- Exchange rates applied at item level\n- Base currency conversion for reporting\n\n### Validation Rules\n\n#### Template Validation\n- Template name required and unique\n- Must have at least one item\n- Department and requestor required\n- Valid budget codes for all items\n\n#### Item Validation\n- Item code required and unique within template\n- Positive quantities and prices\n- Valid UOM from predefined list\n- Budget code must exist in system\n\n## Integration Points\n\n### Shared Components\n- **PRListTemplate**: Reusable list component for PR-related modules\n- **PRDetailTemplate**: Reusable detail component for PR-related modules\n- **StatusBadge**: Consistent status display across modules\n- **AdvancedFilter**: Common filtering interface\n\n### Navigation Integration\n- Sidebar: Procurement → Purchase Request Templates\n- Breadcrumb: Dashboard → Procurement → Purchase Request Templates\n- Cross-module: Templates can generate Purchase Requests\n\n### Data Integration\n- **Mock Data**: Currently uses sample data\n- **Types**: Shares type definitions with Purchase Request module\n- **Validation**: Common validation patterns with other procurement modules\n\n### Future API Integration\nTemplates are designed for future API integration:\n- CRUD operations prepared for REST endpoints\n- State management ready for server synchronization\n- Error handling patterns established\n\n## User Workflows\n\n### Primary Workflows\n\n#### 1. Create New Template\n1. **Entry**: Click \"New Template\" from list page\n2. **Template Setup**: Fill basic template information\n3. **Add Items**: Use Items tab to configure template items\n4. **Configure Items**: Set quantities, prices, budget codes\n5. **Save Template**: Template becomes available for use\n\n#### 2. Use Template for Purchase Request\n1. **Template Selection**: Choose template from list\n2. **Generate PR**: Convert template to purchase request\n3. **Customize**: Modify quantities or items as needed\n4. **Submit**: Submit purchase request for approval\n\n#### 3. Template Management\n1. **Browse Templates**: View available templates in table/card format\n2. **Filter Templates**: Use search and filters to find specific templates\n3. **Edit Templates**: Modify existing templates as needed\n4. **Clone Templates**: Create variations of existing templates\n\n#### 4. Department Template Setup\n1. **Default Template**: Set department-specific default templates\n2. **Budget Integration**: Link templates to budget codes\n3. **Approval Workflow**: Configure approval paths for template-based PRs\n\n### Advanced Features\n\n#### Bulk Operations\n- Select multiple templates\n- Delete, clone, or modify in batch\n- Set multiple templates as defaults for different departments\n\n#### Template Analytics\n- Track template usage frequency\n- Monitor budget utilization\n- Identify optimization opportunities\n\n#### Template Sharing\n- Share templates across departments\n- Export/import template configurations\n- Template version management\n\n---\n\n*Documentation generated on: 2025-09-23*\n*Module Version: 1.0*\n*Carmen ERP - Hospitality Supply Chain Management*";

        // Initialize mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });

        // Configure marked
        marked.setOptions({
            highlight: function(code, lang) {
                return code;
            },
            breaks: true,
            gfm: true
        });

        // Render markdown
        document.getElementById('markdown-content').innerHTML = marked.parse(markdownContent);

        // Render mermaid diagrams
        mermaid.contentLoaded();
    </script>
</body>
</html>